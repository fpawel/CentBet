(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;$.Define($$,{CentBet:{Client:{Admin:{RecordType:$.Class({},{get_color:function(){return function(_0){return _0.$==1?["lightgrey","red"]:_0.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var _1;_1=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],_1)),g.RenderRecords()]));},RenderCommandPrompt:function(){var _2;_2=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(_2);},RenderRecords:function(){var _3,_7;_3=function(_4){var _5,_6;_6=$.New(h,{$:0});_5=d.ofArray([(g.renderRecord())(_4),(g.op_SpliceUntyped())(c.Element("br",[],_6))]);return c.Concat(_5);};_7=g.varConsole().get_View();return c.ConvertSeq(_3,_7);},addRecord:function(_8,_9){return g.varConsole().Add({Id:k.Fresh(),Text:_9,RecordType:_8});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(_){return _.Id;},doc:function(ba){return ba;},op_SpliceUntyped:$.Field(function(){return function(ba){return g.doc(ba);};}),recordKey:function(bb){return bb.Id;},renderInput:function(){var bc,bd,be,bf,bi,bl,bp,bq,bG;bc=l.Create("");bd=l.Create(null);be=l.Create(false);bf=m.Delay(function(){n.Set(be,true);return m.Bind(g.send(n.Get(bc)),function(){n.Set(be,false);n.Set(bc,"");return m.Return(null);});});bi=function(bj){var bk;bk={$:1,$0:bj};g.varCmd=function(){return bk;};return n.Set(bc,bj.Text);};bl=function(bm){var bn,bo;bn=g.tryGetCommandFromHistory(bm);bo=o.map(bi,bn);return;};bp=be.get_View();bq=function(br){var bs;bs=d.ofArray([c.Input(p.toList(p.delay(function(){return p.append([j.Create("id",g["cmd-input"]())],p.delay(function(){return p.append(br?[j.Create("disabled","disabled")]:p.empty(),p.delay(function(){return p.append([i.Style("width","80%")],p.delay(function(){return p.append([i.CustomVar(bd,function(bx){return function(){return bx.focus();};},function(){return{$:0};})],p.delay(function(){return[i.Handler("keydown",function(){return function(bC){var bD,bE,bF;bD=bC.keyCode;if(bD===13){bF=n.Get(bc).toLowerCase();bE=bF==="-clear-output"?g.varConsole().Clear():bF==="-clear-hist"?g.varCommandsHistory().Clear():m.Start(bf,{$:0});}else{bE=bD===38?bl(true):bD===40?bl(false):null;}return bE;};})];}));}));}));}));})),bc)]);return c.Concat(bs);};bG=q.Map(bq,bp);return c.EmbedView(bG);},renderRecord:$.Field(function(){var bH;bH=function(bI){var bJ,bK,bL,bM,bN;try{bK=(r.get_color())(bI.RecordType);bL=bK[1];bM=bK[0];bJ=(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bL),i.Style("background",bM)]),d.ofArray([c.TextNode(bI.Text)])));}catch(bN){g.varCommandsHistory().Clear();g.varConsole().Clear();bJ=c.get_Empty();}return bJ;};return function(bO){var bP;bP=q.Map(bH,bO);return c.EmbedView(bP);};}),send:function(bQ){return m.Delay(function(){var bS,bT,bU,bV,bW,bX;bS=s.Trim(bQ);g.addRecord($.New(r,{$:2}),bS);bU=n.Get(g.varCommandsHistory().Var);if(p.isEmpty(bU)){bV=true;}else{bW=t.last(bU);bV=bW.Text!==bS;}if(bV){g.varCommandsHistory().Add({Id:k.Fresh(),Text:bS});bX=m.Return(null);}else{bX=m.Return(null);}bT=bX;return m.Combine(bT,m.Delay(function(){return m.TryWith(m.Delay(function(){var b0;b0=v.Async("WebFace:1",[bS]);return m.Bind(b0,function(b1){var b2,b3,b4;if(b1.$==1){b3=b1.$0;g.addRecord($.New(r,{$:1}),b3);b2=m.Return(null);}else{b4=b1.$0;g.addRecord($.New(r,{$:0}),b4);b2=m.Return(null);}return b2;});}),function(b5){g.addRecord($.New(r,{$:1}),b5.message);return m.Return(null);});}));});},tryGetCommandFromHistory:function(b6){var b7,b8,b9,b_,b$,ca,cb,ce,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;b7=n.Get(g.varCommandsHistory().Var);b8=p.length(b7);if(b8===0){b9={$:0};}else{if(g.varCmd().$==1){ca=g.varCmd().$0.Id;cb=function(cc){return function(cd){return[cd,cc];};};ce=function(cf){var cg,ch;cg=cf[0];cf[1];ch=cg.Id;return w.Equals(ch,ca);};ci=n.Get(g.varCommandsHistory().Var);cj=p.mapi(cb,ci);ck=p.tryFind(ce,cj);cl=[ck,b6];if(cl[0].$==1){if(cl[1]){cl[0].$0[0];co=cl[0].$0[1];if(b8>0?co<b8-1:false){cq=cl[0].$0[1];cl[0].$0[0];cp=cq+1;}else{if(cl[0].$==1){if(cl[1]){cs=cl[1]?b8-1:0;}else{cl[0].$0[0];ct=cl[0].$0[1];if(b8>0?ct>0:false){cv=cl[0].$0[1];cl[0].$0[0];cu=cv-1;}else{cu=cl[1]?b8-1:0;}cs=cu;}cr=cs;}else{cr=cl[1]?b8-1:0;}cp=cr;}cn=cp;}else{if(cl[0].$==1){if(cl[1]){cx=cl[1]?b8-1:0;}else{cl[0].$0[0];cy=cl[0].$0[1];if(b8>0?cy>0:false){cA=cl[0].$0[1];cl[0].$0[0];cz=cA-1;}else{cz=cl[1]?b8-1:0;}cx=cz;}cw=cx;}else{cw=cl[1]?b8-1:0;}cn=cw;}cm=cn;}else{if(cl[0].$==1){if(cl[1]){cC=cl[1]?b8-1:0;}else{cl[0].$0[0];cD=cl[0].$0[1];if(b8>0?cD>0:false){cF=cl[0].$0[1];cl[0].$0[0];cE=cF-1;}else{cE=cl[1]?b8-1:0;}cC=cE;}cB=cC;}else{cB=cl[1]?b8-1:0;}cm=cB;}b$=cm;}else{b$=b8-1;}b_=b$;cG=p.nth(b_,b7);b9={$:1,$0:cG};}return b9;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cH,cI,cJ,cM,cO,cP,cQ,cU,cV,cZ,c1;try{cJ=function(cK){var cL;cL="restoring list - "+x.prettyPrint(cK);return y?y.log(cL):undefined;};cJ("CentBetConsoleCommandsHistory");cM=function(cN){return g.cmdKey(cN);};cO=z.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))()});cP=D.CreateWithStorage(cM,cO);cQ=function(cR){return function(cS){var cT;cT=x.prettyPrint(cR)+" - "+$$.String(cS);return y?y.log(cT):undefined;};};(cQ("CentBetConsoleCommandsHistory"))(cP.get_Length());cI=cP;}catch(cU){cV=function(cW){return function(cX){var cY;cY="error when restoring "+x.prettyPrint(cW)+" - "+x.prettyPrint(cX);return y?y.log(cY):undefined;};};(cV("CentBetConsoleCommandsHistory"))(cU);cZ=function(c0){return g.cmdKey(c0);};c1=$.New(h,{$:0});cI=D.Create(cZ,c1);}cH=cI;return cH;}),varConsole:$.Field(function(){var c2,c3,c4,c7,c9,c_,c$,dd,de,di,dk;try{c4=function(c5){var c6;c6="restoring list - "+x.prettyPrint(c5);return y?y.log(c6):undefined;};c4("CentBetConsole");c7=function(c8){return g.recordKey(c8);};c9=z.LocalStorage("CentBetConsole",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["RecordType",B.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["RecordType",B.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});c_=D.CreateWithStorage(c7,c9);c$=function(da){return function(db){var dc;dc=x.prettyPrint(da)+" - "+$$.String(db);return y?y.log(dc):undefined;};};(c$("CentBetConsole"))(c_.get_Length());c3=c_;}catch(dd){de=function(df){return function(dg){var dh;dh="error when restoring "+x.prettyPrint(df)+" - "+x.prettyPrint(dg);return y?y.log(dh):undefined;};};(de("CentBetConsole"))(dd);di=function(dj){return g.recordKey(dj);};dk=$.New(h,{$:0});c3=D.Create(di,dk);}c2=c3;return c2;})},Coupon:{PageLen:{get:function(){return F.validateValue(n.Get(F["var"]()));},localStorageKey:$.Field(function(){return"pageLen";}),set:function(dl){var dm,dn;dm=F.validateValue(dl);if(dm!==n.Get(F["var"]())){n.Set(F["var"](),dm);dn=H.set(F.localStorageKey(),dm);}else{dn=null;}return dn;},validateValue:function(_do){return _do<10?30:_do>40?40:_do;},"var":$.Field(function(){var dp,dq;dp=H.getWithDef(F.localStorageKey(),30);dq=F.validateValue(dp);return l.Create(dq);}),view:$.Field(function(){return F["var"]().get_View();})},Render:function(){var dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dV,dW;dr=l.Create(false);ds=["COUPON",0,0];dt=ds[0];du=ds[1];dv=ds[2];dw=E.processCoupon(dr);I["new"](dt,du,dv,dw);dx=["CHECK-SERVER-BETFAIRS-SESSION",0,0];dy=dx[0];dz=dx[1];dA=dx[2];dB=J.check();I["new"](dy,dz,dA,dB);dC=["EVENTS-CATALOGUE",0,0];dD=dC[0];dE=dC[1];dF=dC[2];dG=E.processEvents();I["new"](dD,dE,dF,dG);dH=["MARKETS-CATALOGUE",0,0];dI=dH[0];dJ=dH[1];dK=dH[2];dL=E.processMarkets();I["new"](dI,dJ,dK,dL);dM=["TOTAL-MATCHED",0,0];dN=dM[0];dO=dM[1];dP=dM[2];dQ=E.processTotalMatched();I["new"](dN,dO,dP,dQ);dR=function(dS){var dT,dU;if(dS){dT=E["render\u0421oupon"]();}else{dU=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);dT=c.Element("h1",[],dU);}return dT;};dV=dr.get_View();dW=q.Map(dR,dV);return c.EmbedView(dW);},ServerBetfairsSession:{check:$.Field(function(){return m.Delay(function(){return m.Bind(v.Async("WebFace:2",[]),function(dY){J.hasServerBetfairsSession=function(){return dY;};return m.Return(null);});});}),has:function(){return J.hasServerBetfairsSession();},hasNot:function(){return!J.hasServerBetfairsSession();},hasServerBetfairsSession:$.Field(function(){return true;})},SettingsDialog:{buttonDoc:function(dZ){var d0,d1,d5;d0=F.view();d1=function(d2){var d3,d4;if((dZ?d2===40:false)?true:!dZ?d2===10:false){d3=c.get_Empty();}else{d4=K.buttonElt(dZ,d2);d3=E.doc(d4);}return d3;};d5=q.Map(d1,d0);return c.EmbedView(d5);},buttonElt:function(d6,d7){var ee;ee=d6?"+":"-";return c.Element("button",d.ofArray([K.op_SpliceUntyped("w3-btn w3-teal"),j.Create("style","margin: 10px; width: 50px; height: 50px;"),i.Handler("click",function(){return function(){var d_,d$,ea,eb,ec,ed;d_=[d6,d7];if(d_[0]){if(d_[1]===40){ea=null;}else{eb=d7+(d6?1:-1);ea=F.set(eb);}d$=ea;}else{if(d_[1]===10){ec=null;}else{ed=d7+(d6?1:-1);ec=F.set(ed);}d$=ec;}return d$;};})]),d.ofArray([c.TextNode(ee)]));},"id'":$.Field(function(){return"id-settings-dialog";}),op_SpliceUntyped:function(ef){return j.Create("class",ef);},render:$.Field(function(){var eg,eh,ei,ej,ek,el,en;eg=d.ofArray([K.op_SpliceUntyped("w3-modal"),j.Create("id",K["id'"]())]);eh=d.ofArray([K.op_SpliceUntyped("w3-modal-content w3-animate-zoom w3-card-8")]);ei=d.ofArray([K.op_SpliceUntyped("w3-container w3-teal")]);ej="document.getElementById('"+x.toSafe(K["id'"]())+"').style.display='none'";ek=d.ofArray([c.TextNode("\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0430\u0442\u0447\u0435\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435")]);el=function(em){return $$.String(em);};en=F.view();return c.Element("div",eg,d.ofArray([c.Element("div",eh,d.ofArray([c.Element("header",ei,d.ofArray([c.Element("span",d.ofArray([K.op_SpliceUntyped("w3-closebtn"),j.Create("onclick",ej)]),d.ofArray([c.TextNode("Ã—")])),c.Element("h2",[],ek)])),c.Element("div",d.ofArray([K.op_SpliceUntyped("w3-xxlarge"),j.Create("style","margin : 10px; float : left;")]),d.ofArray([c.TextView(q.Map(el,en))])),K.buttonDoc(true),K.buttonDoc(false)]))]));})},Work:$.Class({},{loop:function(eo){return m.Delay(function(){var eq;eq=m.Delay(function(){return m.Bind(eo.work,function(){return m.Bind(m.Sleep(eo.sleepInterval),function(){return m.Return(null);});});});return m.Combine(m.TryWith(eq,function(eu){var ev,ez;ev=function(ew){return function(ex){var ey;ey="task error "+x.prettyPrint(ew)+" : "+x.prettyPrint(ex);return y?y.log(ey):undefined;};};ez=eo.what;(ev(ez))(eu);return m.Bind(m.Sleep(eo.sleepErrorInterval),function(){return m.Return(null);});}),m.Delay(function(){return I.loop(eo);}));});},"new":function(eC,eD,eE,eF){var eG;eG=$.New(I,{what:eC,sleepInterval:eD,sleepErrorInterval:eE,work:eF});return I.run(eG);},run:function(eH){var eI;eI=m.Delay(function(){var eK,eN;eK=function(eL){var eM;eM="task "+x.prettyPrint(eL)+" : started";return y?y.log(eM):undefined;};eN=eH.what;eK(eN);return m.Bind(I.loop(eH),function(){var eP,eS;eP=function(eQ){var eR;eR="task "+x.prettyPrint(eQ)+" : terminated";return y?y.log(eR):undefined;};eS=eH.what;eP(eS);return m.Return(null);});});return m.Start(eI,{$:0});}}),addNewGames:function(eT){var eU,eV,eW,fh,fj,fl,fm,fn;eU=n.Get(E.meetups().Var);eV=p.toList(eU);E.meetups().Clear();eW=function(eX){var eY,eZ,e0,e1,e2,e3,e4,e5,e6,e7,e8,e9,e_,e$,fa,fb,fc,fd,fe,ff,fg;eY=eX[0];eZ=eX[1];e0=eX[2];e1=eY.gameId;e2=e1[0];e3=e1[1];e4=E.tryGetCountry(e2,e3);e5=l.Create(eZ.playMinute);e6=l.Create(eZ.status);e7=l.Create(eZ.summary);e8=l.Create(eZ.order);e9=l.Create(eZ.winBack);e_=l.Create(eZ.winLay);e$=l.Create(eZ.drawBack);fa=l.Create(eZ.drawLay);fb=l.Create(eZ.loseBack);fc=l.Create(eZ.loseLay);fd=eY.gameId;fe=fd[0];ff=fd[1];fg=E.getLastTotakMatched(fe,ff);return $.New(M,{game:eY,playMinute:e5,status:e6,summary:e7,order:e8,winBack:e9,winLay:e_,drawBack:e$,drawLay:fa,loseBack:fb,loseLay:fc,country:l.Create(e4),totalMatched:l.Create(fg),hash:e0});};fh=function(fi){return n.Get(fi.order);};fj=function(fk){return E.meetups().Add(fk);};fl=d.map(eW,eT);fm=p.append(eV,fl);fn=p.sortBy(fh,fm);return p.iter(fj,fn);},doc:function(fo){return fo;},eventsCatalogue:$.Field(function(){var fp,fq,fr,fs,fu,fv,fw,fx,fB,fD,fE;fp=H.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");try{fs=function(ft){return N.id(ft);};fv=(B.get_Default().EncodeRecord(N,[["gameId",B.get_Default().EncodeTuple([C,C]),0],["country",C,1],["markets",B.get_Default().EncodeList(B.get_Default().EncodeRecord(undefined,[["marketId",C,0],["marketName",C,0],["totalMatched",C,1],["runners",B.get_Default().EncodeList(B.get_Default().EncodeRecord(undefined,[["selectionId",C,0],["runnerName",C,0]])),0]])),0]]))();fu=z.LocalStorage("CentBetEventsCatalogue",{Encode:fv,Decode:(B.get_Default().DecodeRecord(N,[["gameId",B.get_Default().DecodeTuple([C,C]),0],["country",C,1],["markets",B.get_Default().DecodeList(B.get_Default().DecodeRecord(undefined,[["marketId",C,0],["marketName",C,0],["totalMatched",C,1],["runners",B.get_Default().DecodeList(B.get_Default().DecodeRecord(undefined,[["selectionId",C,0],["runnerName",C,0]])),0]])),0]]))()});fr=D.CreateWithStorage(fs,fu);}catch(fw){fx=function(fy){return function(fz){var fA;fA="error when restoring "+x.prettyPrint(fy)+" - "+x.prettyPrint(fz);return y?y.log(fA):undefined;};};(fx("CentBetEventsCatalogue"))(fw);fB=function(fC){return N.id(fC);};fD=$.New(h,{$:0});fr=D.Create(fB,fD);}fq=fr;fE=function(fF){return function(fG){return function(fH){var fI;fI=x.prettyPrint(fF)+" - "+$$.String(fG)+", "+x.prettyPrint(fH);return y?y.log(fI):undefined;};};};((fE("CentBetEventsCatalogue"))(fq.get_Length()))(fp);return fq;}),getGamesEvents:function(){var fJ,fK,fO,fP;fJ=n.Get(E.eventsCatalogue().Var);fK=function(fL){var fM;fM=function(fN){return w.Equals(fN.gameId,fL.game.gameId);};return[fL.game.gameId,p.tryFind(fM,fJ)];};fO=n.Get(E.meetups().Var);fP=p.map(fK,fO);return p.toList(fP);},getLastTotakMatched:function(fQ,fR){var fS,fT,f1;fS=[fQ,fR];fT=function(fU){var fV,fX,fY,fZ,f0;fV=function(fW){return fW.totalMatched;};fX=fU.markets;fY=d.choose(fV,fX);if(fY.$==0){fZ={$:0};}else{f0=p.sum(fY);fZ={$:1,$0:f0};}return fZ;};f1=E.eventsCatalogue().TryFindByKey(fS);return o.bind(fT,f1);},meetups:$.Field(function(){var f2,f4;f2=function(f3){return M.id(f3);};f4=$.New(h,{$:0});return D.Create(f2,f4);}),processCoupon:function(f5){return m.Delay(function(){var f7,f9,f_,f$,ga,gb;f7=function(f8){return[f8.game.gameId,f8.hash];};f9=n.Get(E.meetups().Var);f_=p.map(f7,f9);f$=p.toList(f_);ga=F.get();gb=v.Async("WebFace:0",[f$,n.Get(E.varTargetPageNumber()),ga]);return m.Bind(gb,function(gc){var gd,ge,gf,gg,gh,gi,gj;gd=gc[1];ge=gc[2];gf=gc[0];gg=gc[3];gh=(gg/ga>>0)+(gg%ga===0?0:1);if(n.Get(E.varPagesCount())!==gh){n.Set(E.varPagesCount(),gh);gj=m.Return(null);}else{gj=m.Return(null);}gi=gj;return m.Combine(gi,m.Delay(function(){var gl,gm;if(n.Get(E.varTargetPageNumber())>gh){n.Set(E.varTargetPageNumber(),0);gm=m.Return(null);}else{gm=m.Return(null);}gl=gm;return m.Combine(gl,m.Delay(function(){var go,gp,gq;gp=n.Get(f5);if(!gp){n.Set(f5,true);gq=m.Return(null);}else{gq=m.Return(null);}go=gq;return m.Combine(go,m.Delay(function(){var gs;if(n.Get(E.varCurrentPageNumber())!==n.Get(E.varTargetPageNumber())){n.Set(E.varCurrentPageNumber(),n.Get(E.varTargetPageNumber()));gs=m.Return(null);}else{gs=m.Return(null);}return m.Combine(gs,m.Delay(function(){E.updateCoupon(gf,gd,ge);return m.Return(null);}));}));}));}));});});},processEvents:$.Field(function(){return m.Delay(function(){var gv,gz,gA,gB,gC;E.updateColumnCountryVisible();gv=function(gw){var gx,gy;if(gw[1].$==0){gy=gw[0];gx={$:1,$0:gy};}else{gx={$:0};}return gx;};gz=E.getGamesEvents();gA=d.choose(gv,gz);if(gA.$==0?true:J.hasNot()){gB=m.Return(null);}else{gC=v.Async("WebFace:3",[gA]);gB=m.Bind(gC,function(gD){var gE;gE=m.For(gD,function(gF){var gG,gH;gF[1];gG=gF[0];gH=gF[2];E.eventsCatalogue().Add($.New(N,{gameId:gG,country:gH,markets:$.New(h,{$:0})}));return m.Return(null);});return m.Combine(gE,m.Delay(function(){return m.For(n.Get(E.meetups().Var),function(gJ){var gK,gL,gM;gK=gJ.game.gameId;gL=gK[0];gM=gK[1];n.Set(gJ.country,E.tryGetCountry(gL,gM));return m.Return(null);});}));});}return gB;});}),processMarkets:$.Field(function(){return m.Delay(function(){var gO,gT,gU;gO=function(gP){var gQ,gR,gS;if(gP[1].$==1){if(gP[1].$0.markets.$==0){gS=gP[0];gR={$:1,$0:gS};}else{gR={$:0};}gQ=gR;}else{gQ={$:0};}return gQ;};gT=E.getGamesEvents();gU=d.choose(gO,gT);return(gU.$==0?true:J.hasNot())?m.Return(null):m.For(gU,function(gV){var gW,gX;gW=gV[0];gX=gV[1];return m.Bind(v.Async("WebFace:4",[gW,gX]),function(gY){var gZ,g0,g1,g2;if(gY.$==1){g0=gY.$0;g1=gV[0];g2=gV[1];E.setMarket(g1,g2,g0);gZ=m.Return(null);}else{gZ=m.Return(null);}return gZ;});});});}),processTotalMatched:$.Field(function(){return m.Delay(function(){var g4,g9,g_;E.updateColumnGpbVisible();g4=function(g5){var g6,g7,g8;if(g5[1].$==1){if(g5[1].$0.markets.$==1){g8=g5[0];g7={$:1,$0:g8};}else{g7={$:0};}g6=g7;}else{g6={$:0};}return g6;};g9=E.getGamesEvents();g_=d.choose(g4,g9);return(g_.$==0?true:J.hasNot())?m.Return(null):m.For(g_,function(g$){var ha,hb,hc;ha=g$[0];hb=g$[1];hc=v.Async("WebFace:5",[ha,hb]);return m.Bind(hc,function(hd){var he,hf,hj,hk,hl;if(hd.get_IsEmpty()){he=m.Return(null);}else{hf=function(hg){return function(){return function(hi){return hg+hi;};};};hj=g$[0];hk=g$[1];hl=P.Fold(hf,0,hd);E.updateTotalMatched(hj,hk,hl);he=m.Return(null);}return he;});});});}),renderMeetup:$.Field(function(){var hm,hn,ho;hm=[E.varColumnGpbVisible().get_View(),E.varColumnCountryVisible().get_View()];hn=hm[0];ho=hm[1];return function(hp){return Q.renderMeetup(hn,ho,hp);};}),renderPagination:$.Field(function(){var hq,hr,hs;hq=q.get_Do();hr=E.varPagesCount().get_View();hs=R.Bind(function(ht){var hu;hu=E.varCurrentPageNumber().get_View();return R.Bind(function(hv){var hw,hx,hy,hL;hw="document.getElementById('"+x.toSafe(K["id'"]())+"').style.display='block'";hx=j.Create("onclick",hw);hy=p.toList(p.delay(function(){return p.append(p.map(function(hA){var hB,hH,hI;hB=p.toList(p.delay(function(){return p.append([j.Create("href","#")],p.delay(function(){return p.append([i.Handler("click",function(){return function(){return n.Set(E.varTargetPageNumber(),hA);};})],p.delay(function(){return hA===hv?[j.Create("class","w3-teal")]:p.empty();}));}));}));hI=$$.String(hA+1);hH=d.ofArray([c.Element("a",hB,d.ofArray([c.TextNode(hI)]))]);return c.Element("li",[],hH);},S.range(0,ht-1)),p.delay(function(){var hK;hK=d.ofArray([c.Element("a",d.ofArray([j.Create("href","#"),hx]),d.ofArray([c.TextNode("...")]))]);return[c.Element("li",[],hK)];}));}));hL=d.map(function(hM){return E.doc(hM);},hy);return R.Const(c.Concat(hL));},hu);},hr);return c.EmbedView(hs);}),"render\u0421oupon":$.Field(function(){var hN,hO,hP,hQ,hR,hS,hT,hU,hX,h0,h1,h2,h3,h4,h5;hN=d.ofArray([j.Create("class","w3-responsive")]);hP=d.ofArray([j.Create("class","w3-table w3-bordered w3-striped w3-hoverable")]);hQ=d.ofArray([c.Element("tr",d.ofArray([i.Class("coupon-header-row w3-teal")]),Q.renderGamesHeaderRow(E.varColumnGpbVisible().get_View()))]);hS=E.meetups().get_View();hT=E.renderMeetup();hU=function(hV){var hW;hW=hT(hV);return E.doc(hW);};hX=function(hY){var hZ;hZ=p.map(hU,hY);return c.Concat(hZ);};h0=q.Map(hX,hS);hR=d.ofArray([c.EmbedView(h0)]);hO=d.ofArray([c.Element("table",hP,d.ofArray([c.Element("thead",[],hQ),c.Element("tbody",[],hR)]))]);h1=c.Element("div",hN,hO);h2=d.ofArray([j.Create("class","w3-container")]);h3=q.get_Do();h4=E.varCurrentPageNumber().get_View();h5=R.Bind(function(h6){return R.Bind(function(h7){var h8,h9,h_,h$;if(h6===h7){h9=h1;}else{h$="\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u2116 "+$$.String(h7+1)+"...";h_=d.ofArray([c.TextNode(h$)]);h9=c.Element("h1",[],h_);}h8=h9;return R.Const(E.doc(h8));},E.varTargetPageNumber().get_View());},h4);return c.Element("div",h2,d.ofArray([c.Element("div",d.ofArray([j.Create("class","w3-center")]),d.ofArray([c.Element("ul",d.ofArray([j.Create("class","w3-pagination w3-border w3-round")]),d.ofArray([E.renderPagination()]))])),c.EmbedView(h5),K.render()]));}),setMarket:function(ia,ib,ic){var id,ie,ih,ik,il,im,_in,io,iy,iz;id=[ia,ib];ie=function(_if){var ig;_if[0];_if[1];_if[2];ig=_if[3];return ig;};ih=function(ii){return function(ij){return ii+ij;};};ik=id[0];il=id[1];im=d.choose(ie,ic);_in=p.fold(ih,0,im);E.updateTotalMatched(ik,il,_in);io=function(ip){var iq,ir,is,it,iu;iq=ip[0];ir=ip[1];is=ip[2];it=ip[3];iu=function(iv){var iw,ix;iw=iv[0];ix=iv[1];return{selectionId:ix,runnerName:iw};};return{marketId:iq,marketName:ir,totalMatched:it,runners:d.map(iu,is)};};iy=d.map(io,ic);iz=function(iA){return{$:1,$0:$.New(N,{gameId:iA.gameId,country:iA.country,markets:iy})};};return E.eventsCatalogue().UpdateBy(iz,id);},stvr:function(iB,iC){return!w.Equals(n.Get(iB),iC)?n.Set(iB,iC):null;},tryGetCountry:function(iD,iE){var iF,iG,iH,iI,iJ,iK,iL;iF=[iD,iE];iG=iF[0];iH=iF[1];iI=E.tryGetEvent(iG,iH);if(iI.$==1){if(iI.$0.country.$==1){iL=iI.$0.country.$0;iK=iL;}else{iK="";}iJ=iK;}else{iJ="";}return iJ;},tryGetEvent:function(iM,iN){var iO,iP,iS;iO=[iM,iN];iP=function(iQ){var iR;iR=iQ.gameId;return w.Equals(iO,iR);};iS=n.Get(E.eventsCatalogue().Var);return p.tryFind(iP,iS);},updateColumnCountryVisible:function(){var iT,iV,iW;iT=function(iU){return n.Get(iU.country)!=="";};iV=n.Get(E.meetups().Var);iW=p.exists(iT,iV);return!w.Equals(n.Get(E.varColumnCountryVisible()),iW)?n.Set(E.varColumnCountryVisible(),iW):null;},updateColumnGpbVisible:function(){var iX,iZ,i0;iX=function(iY){return n.Get(iY.totalMatched).$==1;};iZ=n.Get(E.meetups().Var);i0=p.exists(iX,iZ);return!w.Equals(n.Get(E.varColumnGpbVisible()),i0)?n.Set(E.varColumnGpbVisible(),i0):null;},updateCoupon:function(i1,i2,i3){var i4,i5,i6,i7,i9;i4=i1.$==0;!i4?E.addNewGames(i1):null;i5=p.isEmpty(i3);if(!i5){i7=function(i8){return E.meetups().RemoveByKey(i8);};i6=p.iter(i7,i3);}else{i6=null;}i9=function(i_){var i$,ja,jb,jc,jd,je,jf,jg;i$=i_[0];ja=i_[1];jb=i_[2];jc=E.meetups().TryFindByKey(i$);if(jc.$==1){je=jc.$0;if(je.hash!==jb){jg=jc.$0;jg.hash=jb;E.stvr(jg.playMinute,ja.playMinute);E.stvr(jg.status,ja.status);E.stvr(jg.summary,ja.summary);E.stvr(jg.order,ja.order);E.stvr(jg.winBack,ja.winBack);E.stvr(jg.winLay,ja.winLay);E.stvr(jg.drawBack,ja.drawBack);E.stvr(jg.drawLay,ja.drawLay);E.stvr(jg.loseBack,ja.loseBack);jf=E.stvr(jg.loseLay,ja.loseLay);}else{jf=null;}jd=jf;}else{jd=null;}return jd;};p.iter(i9,i2);E.updateColumnCountryVisible();return E.updateColumnGpbVisible();},updateTotalMatched:function(jh,ji,jj){var jk,jl,jm,jn;jk=[jh,ji];jl=E.meetups().TryFindByKey(jk);if(jl.$==1){jn=jl.$0;jm=n.Set(jn.totalMatched,{$:1,$0:jj});}else{jm=null;}return jm;},varColumnCountryVisible:$.Field(function(){return l.Create(false);}),varColumnGpbVisible:$.Field(function(){return l.Create(false);}),varCurrentPageNumber:$.Field(function(){return l.Create(0);}),varPagesCount:$.Field(function(){return l.Create(1);}),varTargetPageNumber:$.Field(function(){return l.Create(0);})},Football:{EventCatalogue:$.Class({},{id:function(jo){return jo.gameId;}}),Meetup:$.Class({},{id:function(jp){return jp.game.gameId;}})},Meetup:{doc:function(jq){return jq;},renderGamesHeaderRow:function(jr){return p.toList(p.delay(function(){var jt,ju,jv,jw,jx,jy;ju=d.ofArray([c.TextNode("\u2116")]);jv=d.ofArray([c.TextNode("\u0414\u043e\u043c\u0430")]);jw=$.New(h,{$:0});jx=d.ofArray([c.TextNode("\u0412 \u0433\u043e\u0441\u0442\u044f\u0445")]);jy=$.New(h,{$:0});jt=d.ofArray([c.Element("th",[],ju),c.Element("th",[],jv),c.Element("th",[],jw),c.Element("th",[],jx),c.Element("th",[],jy),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041f\u043e\u0431\u0435\u0434\u0430")])),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041d\u0438\u0447\u044c\u044f")])),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435")]))]);return p.append(d.map(function(jz){return Q.doc(jz);},jt),p.delay(function(){var jB,jG;jB=function(jC){var jD,jE,jF;if(jC){jE=d.ofArray([c.TextNode("GPB")]);jF=c.Element("th",[],jE);jD=Q.doc(jF);}else{jD=c.get_Empty();}return jD;};jG=q.Map(jB,jr);return p.append([c.EmbedView(jG)],p.delay(function(){var jI,jJ;jI=$.New(h,{$:0});jJ=c.Element("th",[],jI);return[Q.doc(jJ)];}));}));}));},renderMeetup:function(jK,jL,jM){var jN,jY,jZ,j0,j1,j2,j6,j7,j8,j9,j_,j$,ka,kp,kq,kr,ku,kD,kE,kH,kL;jN=function(jO){return function(jP){return function(jQ){var jR,jS,jT,jU,jW,jX;jS=jO?"back":"lay";jT="kef "+x.toSafe(jP)+" "+x.toSafe(jS);jU=function(jV){return G.formatDecimalOption(jV);};jW=jQ.get_View();jX=q.Map(jU,jW);jR=c.Element("td",d.ofArray([j.Create("class",jT)]),d.ofArray([c.TextView(jX)]));return Q.doc(jR);};};};jY=jN(true);jZ=jN(false);j2=function(j3){var j4,j5;j4=j3[0];j5=j3[1];return $$.String(j4)+"."+$$.String(j5);};j6=jM.order.get_View();j7=q.Map(j2,j6);j1=d.ofArray([c.TextView(j7)]);j8=c.Element("td",[],j1);j9=c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(jM.game.home)]));j_=q.get_Do();j$=jM.playMinute.get_View();ka=R.Bind(function(kb){var kc;kc=jM.summary.get_View();return R.Bind(function(kd){var ke,kf,kg,kh,ki,kj,kk,kl,km,kn,ko;if(kb.$==1){if(kd!==""){kg=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(kd)]));kf=Q.doc(kg);}else{if(kd!==""){ki=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(kd)]));kh=Q.doc(ki);}else{kj=$.New(h,{$:0});kk=c.Element("td",[],kj);kh=Q.doc(kk);}kf=kh;}ke=kf;}else{if(kd!==""){km=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(kd)]));kl=Q.doc(km);}else{kn=$.New(h,{$:0});ko=c.Element("td",[],kn);kl=Q.doc(ko);}ke=kl;}return R.Const(ke);},kc);},j$);kp=c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(jM.game.away)]));kq=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextView(jM.status.get_View())]));q.get_Do();kr=R.Bind(function(ks){return R.Bind(function(kt){return R.Const([ks,kt]);},jK);},jM.totalMatched.get_View());ku=function(kv){var kw,kx,ky,kz,kA,kB,kC;if(kv[1]){if(kv[0].$==1){ky=kv[0].$0;kA=$$.String(ky);kz=c.Element("td",d.ofArray([j.Create("class","game-gpb")]),d.ofArray([c.TextNode(kA)]));kx=Q.doc(kz);}else{kB=$.New(h,{$:0});kC=c.Element("td",[],kB);kx=Q.doc(kC);}kw=kx;}else{kw=c.get_Empty();}return kw;};kD=q.Map(ku,kr);q.get_Do();kE=R.Bind(function(kF){return R.Bind(function(kG){return R.Const([kF,kG]);},jL);},jM.country.get_View());kH=function(kI){var kJ,kK;if(kI[1]){kI[0];kK=c.Element("td",d.ofArray([j.Create("class","game-country")]),d.ofArray([c.TextView(jM.country.get_View())]));kJ=Q.doc(kK);}else{kJ=c.get_Empty();}return kJ;};kL=q.Map(kH,kE);j0=d.ofArray([Q.doc(j8),Q.doc(j9),c.EmbedView(ka),Q.doc(kp),Q.doc(kq),(jY("win"))(jM.winBack),(jZ("win"))(jM.winLay),(jY("draw"))(jM.drawBack),(jZ("draw"))(jM.drawLay),(jY("lose"))(jM.loseBack),(jZ("lose"))(jM.loseLay),c.EmbedView(kD),c.EmbedView(kL)]);return c.Element("tr",[],j0);}},Utils:{Left:function(kM){return{$:0,$0:kM};},LocalStorage:{checkTodayKey:function(kN,kO){var kP,kQ,kR,kS;kP=T.now();kQ=H.getWithDef(kN,kP);if(kP-kQ>1*86400000){H.clear(kO);H.set(kN,T.now());kS=function(kT){return function(kU){var kV;kV="local storage "+x.prettyPrint(kT)+" of "+x.prettyPrint(kU)+" is inspired";return y?y.log(kV):undefined;};};(kS(kO))(kQ);kR=kP;}else{kR=kQ;}return kR;},clear:function(kW){return H.strg().removeItem(kW);},get:function(kX){var kY,kZ,k0,k1,k2;try{kZ=H.strg().getItem(kX);k0=U.parse(kZ);kY={$:1,$0:k0};}catch(k1){k2=function(k3){return function(k4){var k5;k5="error getting from local storage, key "+x.prettyPrint(k3)+" : "+x.prettyPrint(k4);return y?y.log(k5):undefined;};};(k2(kX))(k1);kY={$:0};}return kY;},getWithDef:function(k6,k7){var k8,k9,k_;k8=H.get(k6);if(k8.$==1){k_=k8.$0;k9=k_;}else{k9=k7;}return k9;},set:function(k$,la){var lb,lc,ld,le;try{lc=U.stringify(la);lb=H.strg().setItem(k$,lc);}catch(ld){le=function(lf){return function(lg){return function(lh){return S.FailWith("error setting to local storage, key "+x.prettyPrint(lf)+", value "+x.prettyPrint(lg)+" : "+x.prettyPrint(lh));};};};lb=((le(k$))(la))(ld);}return lb;},strg:$.Field(function(){return V.localStorage;})},Right:function(li){return{$:1,$0:li};},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(lj){return G.trimEnd(lj.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(lk){var ll,lm;if(lk.$==1){lm=lk.$0;ll=G.formatDecimal(lm);}else{ll="";}return ll;},getDatePart:function(ln){var lo;lo=new T(ln.getTime());lo.setHours(0,0,0,0);return lo;},mkids:function(lp,lq){var lr,lt,lu,lv,lw;lr=function(ls){return[lq(ls),ls];};lt=d.map(lr,lp);lu=P.OfArray(p.toArray(lt));lv=d.map(lq,lp);lw=W.New1(X.OfSeq(lv));return[lw,lu];},trimEnd:function(lx,ly){var lz,lA,lB,lC,lD,lE,lF,lG,lH,lI,lJ,lK;lz=[lx,ly];if(lz[0]===""){lA="";}else{if(lz[1].$==1){lC=lz[0];lz[1];lD=lz[1].$0;if(lC.charCodeAt(lC.length-1)===lD){lz[1].$0;lF=lz[1];lG=lz[0];lE=G.trimEnd(Y.string(lG,{$:0},{$:1,$0:lG.length-2}),lF);}else{if(lz[1].$==1){lI=lz[0];lJ=lz[1].$1;lH=G.trimEnd(lI,lJ);}else{lH=S.Raise(Z.New("E:\\User\\Docs\\Visual Studio 2015\\Projects\\CentBet\\CentBet\\WebFace\\ClientUtils.fs",8,18));}lE=lH;}lB=lE;}else{lK=lz[0];lB=lK;}lA=lB;}return lA;},"|Left|Right|":function(lL){var lM,lN,lO;if(lL.$==1){lN=lL.$0;lM={$:1,$0:lN};}else{lO=lL.$0;lM={$:0,$0:lO};}return lM;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe(b.Key);l=$.Safe(b.Var);m=$.Safe($$.WebSharper.Concurrency);n=$.Safe(b.Var1);o=$.Safe($$.WebSharper.Option);p=$.Safe($$.WebSharper.Seq);q=$.Safe(b.View);r=$.Safe(g.RecordType);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe($$.WebSharper.PrintfHelpers);y=$.Safe($$.console);z=$.Safe(b.Storage1);A=$.Safe($$.WebSharper.Json);B=$.Safe(A.Provider);C=$.Safe(B.Id);D=$.Safe(b.ListModel);E=$.Safe(f.Coupon);F=$.Safe(E.PageLen);G=$.Safe(f.Utils);H=$.Safe(G.LocalStorage);I=$.Safe(E.Work);J=$.Safe(E.ServerBetfairsSession);K=$.Safe(E.SettingsDialog);L=$.Safe(f.Football);M=$.Safe(L.Meetup);N=$.Safe(L.EventCatalogue);O=$.Safe($$.WebSharper.Collections);P=$.Safe(O.MapModule);Q=$.Safe(f.Meetup);R=$.Safe(b.View1);S=$.Safe($$.WebSharper.Operators);T=$.Safe($$.Date);U=$.Safe($$.JSON);V=$.Safe($$.window);W=$.Safe(O.FSharpSet);X=$.Safe(O.BalancedTree);Y=$.Safe($$.WebSharper.Slice);return Z=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){H.strg();E.varTargetPageNumber();E.varPagesCount();E.varCurrentPageNumber();E.varColumnGpbVisible();E.varColumnCountryVisible();E["render\u0421oupon"]();E.renderPagination();E.renderMeetup();E.processTotalMatched();E.processMarkets();E.processEvents();E.meetups();E.eventsCatalogue();K.render();K["id'"]();J.hasServerBetfairsSession();J.check();F.view();F["var"]();F.localStorageKey();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
