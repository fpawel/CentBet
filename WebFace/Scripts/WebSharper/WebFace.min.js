(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({get_s1:function(){return this.$==2?">":"<";}},{get_color:function(){return function(S){return S.$==1?["lightgrey","red"]:S.$==2?["lightgrey","green"]:["white","navy"];};}}),LocalStorage:$.Class({Get:function(T){var U,V,W,X,Y;try{V=this.strg.getItem(T);W=a.parse(V);U={$:0,$0:W};}catch(X){Y=this.strg;U={$:1,$0:"local storage get item "+b.prettyPrint(T)+" error : "+b.prettyPrint(X)+", storage "+b.prettyPrint(Y)};}return U;},Set:function(Z,_0){var _1,_2,_3,_4;try{_2=a.stringify(_0);_1={$:0,$0:this.strg.setItem(Z,_2)};}catch(_3){_4=this.strg;_1={$:1,$0:"local storage set item "+b.prettyPrint(Z)+" error : "+b.prettyPrint(_3)+", value "+b.prettyPrint(_0)+", storage "+b.prettyPrint(_4)};}return _1;}},{New:function(){var _6;_6=$.New(this,{});_6.strg=c.localStorage;return _6;}}),RenderCommandPrompt:function(){var _7;_7=d.ofArray([(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("margin-left","10px")]),$.New(l,{$:0}))),(g.op_SpliceUntyped())(j.Element("label",d.ofArray([m.Create("for",g["cmd-input"]())]),d.ofArray([j.TextNode("Input here:")]))),g.renderInput()]);return j.Concat(_7);},RenderConsole:function(){var _8,bb;_8=function(_9){var _,ba;ba=$.New(l,{$:0});_=d.ofArray([(g.renderRecord())(_9),(g.op_SpliceUntyped())(j.Element("br",[],ba))]);return j.Concat(_);};bb=g.varConsole().get_View();return j.ConvertSeq(_8,bb);},RenderMenu:function(){return j.Concat(d.map(function(bb){return bb;},d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([j.TextNode("Clear console")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([j.TextNode("Clear history")]))])));},addRecord:function(bk,bl){return g.varConsole().Add({Id:o.Fresh(),Text:bl,Level:bk});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bm){return bm.Id;},doc:function(bn){return bn;},getCommandFromHistory:function(bo){var bp,bq,br,bs,bt,bu,bv,by,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0;bp=p.Get(g.varCommandsHistory().Var);bq=n.length(bp);if(bq===0){br={$:0};}else{if(g.varCmd().$==1){bu=g.varCmd().$0.Id;bv=function(bw){return function(bx){return[bx,bw];};};by=function(bz){var bA,bB;bA=bz[0];bz[1];bB=bA.Id;return q.Equals(bB,bu);};bC=p.Get(g.varCommandsHistory().Var);bD=n.mapi(bv,bC);bE=n.tryFind(by,bD);bF=[bE,bo];if(bF[0].$==1){if(bF[1]){bF[0].$0[0];bI=bF[0].$0[1];if(bq>0?bI<bq-1:false){bK=bF[0].$0[1];bF[0].$0[0];bJ=bK+1;}else{if(bF[0].$==1){if(bF[1]){bM=bF[1]?bq-1:0;}else{bF[0].$0[0];bN=bF[0].$0[1];if(bq>0?bN>0:false){bP=bF[0].$0[1];bF[0].$0[0];bO=bP-1;}else{bO=bF[1]?bq-1:0;}bM=bO;}bL=bM;}else{bL=bF[1]?bq-1:0;}bJ=bL;}bH=bJ;}else{if(bF[0].$==1){if(bF[1]){bR=bF[1]?bq-1:0;}else{bF[0].$0[0];bS=bF[0].$0[1];if(bq>0?bS>0:false){bU=bF[0].$0[1];bF[0].$0[0];bT=bU-1;}else{bT=bF[1]?bq-1:0;}bR=bT;}bQ=bR;}else{bQ=bF[1]?bq-1:0;}bH=bQ;}bG=bH;}else{if(bF[0].$==1){if(bF[1]){bW=bF[1]?bq-1:0;}else{bF[0].$0[0];bX=bF[0].$0[1];if(bq>0?bX>0:false){bZ=bF[0].$0[1];bF[0].$0[0];bY=bZ-1;}else{bY=bF[1]?bq-1:0;}bW=bY;}bV=bW;}else{bV=bF[1]?bq-1:0;}bG=bV;}bt=bG;}else{bt=bq-1;}bs=bt;b0=n.nth(bs,bp);br={$:1,$0:b0};}return br;},op_SpliceUntyped:$.Field(function(){return function(b1){return g.doc(b1);};}),recordKey:function(b2){return b2.Id;},renderInput:function(){var b3,b4,b5,b6,b9,b_,cz;b3=r.Create("");b4=r.Create(null);b5=r.Create(false);b6=s.Delay(function(){p.Set(b5,true);return s.Bind(g.send(p.Get(b3)),function(){p.Set(b5,false);p.Set(b3,"");return s.Return(null);});});b9=b5.get_View();b_=function(b$){var ca,ci,cj;ca=n.toList(n.delay(function(){return n.append([m.Create("id",g["cmd-input"]())],n.delay(function(){return n.append(b$?[m.Create("disabled","disabled")]:n.empty(),n.delay(function(){return n.append([k.Style("width","80%")],n.delay(function(){return[k.CustomVar(b4,function(cf){return function(){return cf.focus();};},function(){return{$:0};})];}));}));}));}));ci=j.Input(ca,b3);cj=function(){var cl;cl=t("#"+g["cmd-input"]());return cl.keydown(function(cm){var cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy;cn=cm.which;if(cn===13){co=s.Start(b6,{$:0});}else{if(cn===38){cq=g.getCommandFromHistory(cm.which===40);if(cq.$==1){cs=cq.$0;ct={$:1,$0:cs};g.varCmd=function(){return ct;};cr=p.Set(b3,cs.Text);}else{cr=null;}cp=cr;}else{if(cn===40){cv=g.getCommandFromHistory(cm.which===40);if(cv.$==1){cx=cv.$0;cy={$:1,$0:cx};g.varCmd=function(){return cy;};cw=p.Set(b3,cx.Text);}else{cw=null;}cu=cw;}else{cu=null;}cp=cu;}co=cp;}return co;});};return ci.OnAfterRender(cj);};cz=u.Map(b_,b9);return j.EmbedView(cz);},renderRecord:$.Field(function(){var cA;cA=function(cB){var cC,cD,cE;cC=(v.get_color())(cB.Level);cD=cC[1];cE=cC[0];return(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("color",cD),k.Style("background",cE)]),d.ofArray([j.TextNode(cB.Level.get_s1()+" "+cB.Text)])));};return function(cF){var cG;cG=u.Map(cA,cF);return j.EmbedView(cG);};}),send:function(cH){return s.Delay(function(){var cJ,cK,cL,cM,cN,cO;cJ=w.Trim(cH);g.addRecord($.New(v,{$:2}),cJ);cL=p.Get(g.varCommandsHistory().Var);if(n.isEmpty(cL)){cM=true;}else{cN=x.last(cL);cM=cN.Text!==cJ;}if(cM){g.varCommandsHistory().Add({Id:o.Fresh(),Text:cJ});cO=s.Return(null);}else{cO=s.Return(null);}cK=cO;return s.Combine(cK,s.Delay(function(){return s.TryWith(s.Delay(function(){return s.Bind(z.Async("WebFace:1",[cJ]),function(cR){var cS;cR[0];cS=cR[1];g.addRecord($.New(v,{$:0}),cS);return s.Return(null);});}),function(cT){g.addRecord($.New(v,{$:1}),cT.message);return s.Return(null);});}));});},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cU,cW;cU=function(cV){return g.cmdKey(cV);};cW=A.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(C.get_Default().EncodeRecord(undefined,[["Id",C.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",D,0]]]]),0],["Text",D,0]]))(),Decode:(C.get_Default().DecodeRecord(undefined,[["Id",C.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",D,0]]]]),0],["Text",D,0]]))()});return E.CreateWithStorage(cU,cW);}),varConsole:$.Field(function(){var cX,cZ;cX=function(cY){return g.recordKey(cY);};cZ=A.LocalStorage("CentBetConsole",{Encode:(C.get_Default().EncodeRecord(undefined,[["Id",C.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",D,0]]]]),0],["Text",D,0],["Level",C.get_Default().EncodeUnion(v,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(C.get_Default().DecodeRecord(undefined,[["Id",C.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",D,0]]]]),0],["Text",D,0],["Level",C.get_Default().DecodeUnion(v,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return E.CreateWithStorage(cX,cZ);})},Coupon:{Main:function(){var c0,c5,c6,c7,df,_do;c0=s.Delay(function(){return s.While(function(){return true;},s.Delay(function(){return s.Bind(F.processCoupon(p.Get(F.varInplayOnly())),function(){return s.Return(null);});}));});s.Start(c0,{$:0});c5=u.get_Do();c6=F.varInplayOnly().get_View();c7=G.Bind(function(c8){return G.Bind(function(c9){var c_,c$,da,dc,dd,de;c_=n.isEmpty(c9);c$=!c_;da=function(db){return H.inplay(db);};dc=n.filter(da,c9);dd=n.isEmpty(dc);de=!dd;return G.Const([c$,de,c8]);},F.meetups().get_View());},c6);df=function(dg){var dh,di,dj,dk,dl,dm,dn;if(dg[0]){if(dg[1]){dj=d.ofArray([F.table()]);di=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dj)]));}else{if(dg[2]){dl=d.ofArray([j.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);dk=j.Element("h1",[],dl);}else{dm=d.ofArray([F.table()]);dk=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dm)]));}di=dk;}dh=di;}else{dn=d.ofArray([j.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);dh=j.Element("h1",[],dn);}return dh;};_do=u.Map(df,c7);return j.EmbedView(_do);},Meetup:$.Class({},{id:function(dp){return dp.game.gameId;},inplay:function(dq){return p.Get(dq.gameInfo).playMinute.$==1;},notinplay:function(dr){return p.Get(dr.gameInfo).playMinute.$==0;},viewGameInfo:function(ds){return ds.gameInfo.get_View();}}),Menu:function(){var dt,du,dK;dt=F.varInplayOnly().get_View();du=function(dv){var dw,dy,dJ;dw=function(dx){return dx;};dy=d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return p.Set(F.varInplayOnly(),true);};})],n.delay(function(){return dv?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return p.Set(F.varInplayOnly(),false);};})],n.delay(function(){return!dv?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);dJ=d.map(dw,dy);return j.Concat(dJ);};dK=u.Map(du,dt);return j.EmbedView(dK);},MenuToday:function(){var dL,dM,dR;dL=F.varInplayOnly().get_View();dM=function(dN){return j.Element("li",n.toList(n.delay(function(){return!dN?[m.Create("class","active")]:n.empty();})),d.ofArray([j.Element("a",d.ofArray([m.Create("href","#"),k.Handler("click",function(){return function(){return p.Set(F.varInplayOnly(),false);};})]),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};dR=u.Map(dM,dL);return j.EmbedView(dR);},addNewGames:function(dS){var dT,dU,dV,d0,d2,d4,d5,d6;dT=p.Get(F.meetups().Var);dU=n.toList(dT);F.meetups().Clear();dV=function(dW){var dX,dY,dZ;dX=dW[0];dY=dW[1];dZ=dW[2];return $.New(H,{game:dX,gameInfo:r.Create(dY),hash:dZ});};d0=function(d1){return p.Get(d1.gameInfo).order;};d2=function(d3){return F.meetups().Add(d3);};d4=d.map(dV,dS);d5=n.append(dU,d4);d6=n.sortBy(d0,d5);return n.iter(d2,d6);},downloadCoupon:function(d7,d8){return z.Async("WebFace:0",[d8,d7]);},meetups:$.Field(function(){var d9,d$;d9=function(d_){return H.id(d_);};d$=$.New(l,{$:0});return E.Create(d9,d$);}),processCoupon:function(ea){return s.Delay(function(){var ec,ee,ef,eg;ec=function(ed){return[ed.game.gameId,ed.hash];};ee=p.Get(F.meetups().Var);ef=n.map(ec,ee);eg=n.toList(ef);return s.Bind(F.downloadCoupon(ea,eg),function(eh){var ei,ej,ek;ei=eh[1];ej=eh[2];ek=eh[0];F.updateCoupon(ek,ei,ej);return s.Return(null);});});},row:function(el,em){var en,eo,er,eu,ey,eA;if(em?p.Get(el.gameInfo).playMinute.$==0:false){en=j.get_Empty();}else{eo=function(ep){var eq;eq=d.ofArray([ep]);return j.Element("td",[],eq);};er=function(es){var et;et=d.ofArray([j.TextNode(es)]);return j.Element("td",[],et);};eu=function(ev){var ew,ex;ew=el.gameInfo.get_View();ex=u.Map(ev,ew);return eo(j.TextView(ex));};ey=function(ez){return I.formatDecimalOption(ez);};eA=$.New(l,{$:0});en=j.Element("tr",eA,d.ofArray([eu(function(eB){var eC,eD,eE;eC=eB.order;eD=eC[0];eE=eC[1];return $$.String(eD)+"."+$$.String(eE);}),er(el.game.home),er(el.game.away),eu(function(eF){return eF.status;}),eu(function(eG){return eG.summary;}),eu(function(eH){return ey(eH.winBack);}),eu(function(eI){return ey(eI.winLay);}),eu(function(eJ){return ey(eJ.drawBack);}),eu(function(eK){return ey(eK.drawLay);}),eu(function(eL){return ey(eL.loseBack);}),eu(function(eM){return ey(eM.loseLay);})]));}return en;},table:function(){var eN,eO;eN=F.meetups().get_View();eO=function(eP){var eQ,eU,eX;eQ=function(eR){var eS,eT;eS=eR[0];eT=eR[1];return F.row(eS,eT);};u.get_Do();eU=G.Bind(function(eV){return G.Bind(function(eW){return G.Const([eV,eW]);},F.varInplayOnly().get_View());},eP);eX=u.Map(eQ,eU);return j.EmbedView(eX);};return j.ConvertSeq(eO,eN);},updateCoupon:function(eY,eZ,e0){var e1,e2,e3,e6,e7,e8,e9,e$,fc,fd;e1=eY.$==0;if(!e1){e3=function(e4){var e5;e5="adding new games "+$$.String(e4);return J?J.log(e5):undefined;};e6=eY.get_Length();e3(e6);e2=F.addNewGames(eY);}else{e2=null;}e7=n.isEmpty(e0);if(!e7){e9=function(e_){return F.meetups().RemoveByKey(e_);};n.iter(e9,e0);e$=function(fa){var fb;fb="removing out games "+$$.String(fa);return J?J.log(fb):undefined;};fc=n.length(e0);e8=e$(fc);}else{e8=null;}fd=function(fe){var ff,fg,fh,fi,fj,fk;ff=fe[0];fg=fe[1];fh=fe[2];fi=F.meetups().TryFindByKey(ff);if(fi.$==1){fk=fi.$0;p.Set(fk.gameInfo,fg);fj=void(fk.hash=fh);}else{fj=null;}return fj;};return n.iter(fd,eZ);},varInplayOnly:$.Field(function(){return r.Create(true);})},Utils:{dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(fl){return I.trimEnd(fl.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(fm){var fn,fo;if(fm.$==1){fo=fm.$0;fn=I.formatDecimal(fo);}else{fn="";}return fn;},getDatePart:function(fp){var fq;fq=new K(fp.getTime());fq.setHours(0,0,0,0);return fq;},mkids:function(fr,fs){var ft,fv,fw,fx,fy;ft=function(fu){return[fs(fu),fu];};fv=d.map(ft,fr);fw=M.OfArray(n.toArray(fv));fx=d.map(fs,fr);fy=N.New1(O.OfSeq(fx));return[fy,fw];},trimEnd:function(fz,fA){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM;fB=[fz,fA];if(fB[0]===""){fC="";}else{if(fB[1].$==1){fE=fB[0];fB[1];fF=fB[1].$0;if(fE.charCodeAt(fE.length-1)===fF){fB[1].$0;fH=fB[1];fI=fB[0];fG=I.trimEnd(P.string(fI,{$:0},{$:1,$0:fI.length-2}),fH);}else{if(fB[1].$==1){fK=fB[0];fL=fB[1].$1;fJ=I.trimEnd(fK,fL);}else{fJ=Q.Raise(R.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}fG=fJ;}fD=fG;}else{fM=fB[0];fD=fM;}fC=fD;}return fC;}}}}});$.OnInit(function(){a=$.Safe($$.JSON);b=$.Safe($$.WebSharper.PrintfHelpers);c=$.Safe($$.window);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe($$.WebSharper.UI);i=$.Safe(h.Next);j=$.Safe(i.Doc);k=$.Safe(i.AttrModule);l=$.Safe(d.T);m=$.Safe(i.AttrProxy);n=$.Safe($$.WebSharper.Seq);o=$.Safe(i.Key);p=$.Safe(i.Var1);q=$.Safe($$.WebSharper.Unchecked);r=$.Safe(i.Var);s=$.Safe($$.WebSharper.Concurrency);t=$.Safe($$.jQuery);u=$.Safe(i.View);v=$.Safe(g.Level);w=$.Safe($$.WebSharper.Strings);x=$.Safe($$.Seq);y=$.Safe($$.WebSharper.Remoting);z=$.Safe(y.AjaxRemotingProvider);A=$.Safe(i.Storage1);B=$.Safe($$.WebSharper.Json);C=$.Safe(B.Provider);D=$.Safe(C.Id);E=$.Safe(i.ListModel);F=$.Safe(f.Coupon);G=$.Safe(i.View1);H=$.Safe(F.Meetup);I=$.Safe(f.Utils);J=$.Safe($$.console);K=$.Safe($$.Date);L=$.Safe($$.WebSharper.Collections);M=$.Safe(L.MapModule);N=$.Safe(L.FSharpSet);O=$.Safe(L.BalancedTree);P=$.Safe($$.WebSharper.Slice);Q=$.Safe($$.WebSharper.Operators);return R=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){F.varInplayOnly();F.meetups();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
