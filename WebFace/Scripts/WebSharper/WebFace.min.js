(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;$.Define($$,{CentBet:{Client:{Admin:{Br:$.Field(function(){var H;H=$.New(b,{$:0});return e.Element("br",[],H);}),Config:function(){var I,J,K,L,M;I=f.Create("");J=f.Create("");K=f.Create(false);L=f.Create([$.New(j,{$:1}),""]);M=function(){return k.Start(k.Delay(function(){l.Set(K,true);l.Set(L,[$.New(j,{$:1}),"logining betfair..."]);return k.Bind(n.Async("WebFace:0",[l.Get(I),l.Get(J)]),function(P){var Q,R;l.Set(K,true);if(P.$==1){R=P.$0;Q=[$.New(j,{$:3}),R];}else{Q=[$.New(j,{$:1}),"successed!"];}l.Set(L,Q);return k.Return(null);});}),{$:0});};return e.Concat(a.ofArray([e.TextNode("User"),o.Br(),e.PasswordBox($.New(b,{$:0}),I),o.Br(),e.TextNode("Pass"),o.Br(),e.PasswordBox($.New(b,{$:0}),J),o.Br(),o.Br(),e.EmbedView(p.Map(function(S){return e.Button("Login",q.toList(q.delay(function(){return S?[r.Create("class","hide")]:q.empty();})),M);},K.get_View())),e.EmbedView(p.Map(function(U){var V,W,X,Y;V=U[0];W=U[1];X=(j.get_color())(V);Y=X[1];return e.Element("p",a.ofArray([r.Create("style","background-color : "+s.toSafe(X[0])+"; color : "+s.toSafe(Y)+";")]),a.ofArray([e.TextNode(W)]));},L.get_View()))]));}},Coupon:{Main:function(){var Z,_4,_5,_6,bf,bo;Z=k.Delay(function(){return k.While(function(){return true;},k.Delay(function(){return k.Bind(t.processCoupon(l.Get(t.varInplayOnly())),function(){return k.Return(null);});}));});k.Start(Z,{$:0});_4=p.get_Do();_5=t.varInplayOnly().get_View();_6=u.Bind(function(_7){return u.Bind(function(_8){var _9,_,ba,bc,bd,be;_9=q.isEmpty(_8);_=!_9;ba=function(bb){return v.inplay(bb);};bc=q.filter(ba,_8);bd=q.isEmpty(bc);be=!bd;return u.Const([_,be,_7]);},t.meetups().get_View());},_5);bf=function(bg){var bh,bi,bj,bk,bl,bm,bn;if(bg[0]){if(bg[1]){bj=a.ofArray([t.table()]);bi=e.Element("table",$.New(b,{$:0}),a.ofArray([e.Element("tbody",[],bj)]));}else{if(bg[2]){bl=a.ofArray([e.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);bk=e.Element("h1",[],bl);}else{bm=a.ofArray([t.table()]);bk=e.Element("table",$.New(b,{$:0}),a.ofArray([e.Element("tbody",[],bm)]));}bi=bk;}bh=bi;}else{bn=a.ofArray([e.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);bh=e.Element("h1",[],bn);}return bh;};bo=p.Map(bf,_6);return e.EmbedView(bo);},Meetup:$.Class({},{id:function(bo){return bo.game.gameId;},inplay:function(bp){return l.Get(bp.gameInfo).playMinute.$==1;},notinplay:function(bq){return l.Get(bq.gameInfo).playMinute.$==0;},viewGameInfo:function(br){return br.gameInfo.get_View();}}),Menu:function(){var bs,bt,bJ;bs=t.varInplayOnly().get_View();bt=function(bu){var bv,bx,bI;bv=function(bw){return bw;};bx=a.ofArray([e.Element("a",q.toList(q.delay(function(){return q.append([r.Create("href","#")],q.delay(function(){return q.append([w.Handler("click",function(){return function(){return l.Set(t.varInplayOnly(),true);};})],q.delay(function(){return bu?[r.Create("class","active")]:q.empty();}));}));})),a.ofArray([e.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),e.Element("a",q.toList(q.delay(function(){return q.append([r.Create("href","#")],q.delay(function(){return q.append([w.Handler("click",function(){return function(){return l.Set(t.varInplayOnly(),false);};})],q.delay(function(){return!bu?[r.Create("class","active")]:q.empty();}));}));})),a.ofArray([e.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);bI=a.map(bv,bx);return e.Concat(bI);};bJ=p.Map(bt,bs);return e.EmbedView(bJ);},MenuToday:function(){var bK,bL,bQ;bK=t.varInplayOnly().get_View();bL=function(bM){return e.Element("li",q.toList(q.delay(function(){return!bM?[r.Create("class","active")]:q.empty();})),a.ofArray([e.Element("a",a.ofArray([r.Create("href","#"),w.Handler("click",function(){return function(){return l.Set(t.varInplayOnly(),false);};})]),a.ofArray([e.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};bQ=p.Map(bL,bK);return e.EmbedView(bQ);},addNewGames:function(bR){var bS,bT,bU,bZ,b1,b3,b4,b5;bS=l.Get(t.meetups().Var);bT=q.toList(bS);t.meetups().Clear();bU=function(bV){var bW,bX,bY;bW=bV[0];bX=bV[1];bY=bV[2];return $.New(v,{game:bW,gameInfo:f.Create(bX),hash:bY});};bZ=function(b0){return l.Get(b0.gameInfo).order;};b1=function(b2){return t.meetups().Add(b2);};b3=a.map(bU,bR);b4=q.append(bT,b3);b5=q.sortBy(bZ,b4);return q.iter(b1,b5);},downloadCoupon:function(b6,b7){return n.Async("WebFace:1",[b7,b6]);},meetups:$.Field(function(){var b8,b_;b8=function(b9){return v.id(b9);};b_=$.New(b,{$:0});return x.Create(b8,b_);}),processCoupon:function(b$){return k.Delay(function(){var cb,cd,ce,cf;cb=function(cc){return[cc.game.gameId,cc.hash];};cd=l.Get(t.meetups().Var);ce=q.map(cb,cd);cf=q.toList(ce);return k.Bind(t.downloadCoupon(b$,cf),function(cg){var ch,ci,cj;ch=cg[1];ci=cg[2];cj=cg[0];t.updateCoupon(cj,ch,ci);return k.Return(null);});});},row:function(ck,cl){var cm,cn,cq,ct,cx,cz;if(cl?l.Get(ck.gameInfo).playMinute.$==0:false){cm=e.get_Empty();}else{cn=function(co){var cp;cp=a.ofArray([co]);return e.Element("td",[],cp);};cq=function(cr){var cs;cs=a.ofArray([e.TextNode(cr)]);return e.Element("td",[],cs);};ct=function(cu){var cv,cw;cv=ck.gameInfo.get_View();cw=p.Map(cu,cv);return cn(e.TextView(cw));};cx=function(cy){return i.formatDecimalOption(cy);};cz=$.New(b,{$:0});cm=e.Element("tr",cz,a.ofArray([ct(function(cA){var cB,cC,cD;cB=cA.order;cC=cB[0];cD=cB[1];return $$.String(cC)+"."+$$.String(cD);}),cq(ck.game.home),cq(ck.game.away),ct(function(cE){return cE.status;}),ct(function(cF){return cF.summary;}),ct(function(cG){return cx(cG.winBack);}),ct(function(cH){return cx(cH.winLay);}),ct(function(cI){return cx(cI.drawBack);}),ct(function(cJ){return cx(cJ.drawLay);}),ct(function(cK){return cx(cK.loseBack);}),ct(function(cL){return cx(cL.loseLay);})]));}return cm;},table:function(){var cM,cN;cM=t.meetups().get_View();cN=function(cO){var cP,cT,cW;cP=function(cQ){var cR,cS;cR=cQ[0];cS=cQ[1];return t.row(cR,cS);};p.get_Do();cT=u.Bind(function(cU){return u.Bind(function(cV){return u.Const([cU,cV]);},t.varInplayOnly().get_View());},cO);cW=p.Map(cP,cT);return e.EmbedView(cW);};return e.ConvertSeq(cN,cM);},updateCoupon:function(cX,cY,cZ){var c0,c1,c2,c5,c6,c7,c8,c_,db,dc;c0=cX.$==0;if(!c0){c2=function(c3){var c4;c4="adding new games "+$$.String(c3);return y?y.log(c4):undefined;};c5=cX.get_Length();c2(c5);c1=t.addNewGames(cX);}else{c1=null;}c6=q.isEmpty(cZ);if(!c6){c8=function(c9){return t.meetups().RemoveByKey(c9);};q.iter(c8,cZ);c_=function(c$){var da;da="removing out games "+$$.String(c$);return y?y.log(da):undefined;};db=q.length(cZ);c7=c_(db);}else{c7=null;}dc=function(dd){var de,df,dg,dh,di,dj;de=dd[0];df=dd[1];dg=dd[2];dh=t.meetups().TryFindByKey(de);if(dh.$==1){dj=dh.$0;l.Set(dj.gameInfo,df);di=void(dj.hash=dg);}else{di=null;}return di;};return q.iter(dc,cY);},varInplayOnly:$.Field(function(){return f.Create(true);})},Utils:{Level:$.Class({},{get_color:function(){return function(dk){return dk.$==3?["lightgrey","red"]:dk.$==2?["white","green"]:dk.$==4?["black","yellow"]:dk.$==0?["lightgrey","gray"]:["white","navy"];};}}),dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(dl){return i.trimEnd(dl.toFixed(6),a.ofArray([48,46]));},formatDecimalOption:function(dm){var dn,_do;if(dm.$==1){_do=dm.$0;dn=i.formatDecimal(_do);}else{dn="";}return dn;},getDatePart:function(dp){var dq;dq=new z(dp.getTime());dq.setHours(0,0,0,0);return dq;},mkids:function(dr,ds){var dt,dv,dw,dx,dy;dt=function(du){return[ds(du),du];};dv=a.map(dt,dr);dw=B.OfArray(q.toArray(dv));dx=a.map(ds,dr);dy=C.New1(D.OfSeq(dx));return[dy,dw];},trimEnd:function(dz,dA){var dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM;dB=[dz,dA];if(dB[0]===""){dC="";}else{if(dB[1].$==1){dE=dB[0];dB[1];dF=dB[1].$0;if(dE.charCodeAt(dE.length-1)===dF){dB[1].$0;dH=dB[1];dI=dB[0];dG=i.trimEnd(E.string(dI,{$:0},{$:1,$0:dI.length-2}),dH);}else{if(dB[1].$==1){dK=dB[0];dL=dB[1].$1;dJ=i.trimEnd(dK,dL);}else{dJ=F.Raise(G.New("E:\\User\\Docs\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,22));}dG=dJ;}dD=dG;}else{dM=dB[0];dD=dM;}dC=dD;}return dC;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.List);b=$.Safe(a.T);c=$.Safe($$.WebSharper.UI);d=$.Safe(c.Next);e=$.Safe(d.Doc);f=$.Safe(d.Var);g=$.Safe($$.CentBet);h=$.Safe(g.Client);i=$.Safe(h.Utils);j=$.Safe(i.Level);k=$.Safe($$.WebSharper.Concurrency);l=$.Safe(d.Var1);m=$.Safe($$.WebSharper.Remoting);n=$.Safe(m.AjaxRemotingProvider);o=$.Safe(h.Admin);p=$.Safe(d.View);q=$.Safe($$.WebSharper.Seq);r=$.Safe(d.AttrProxy);s=$.Safe($$.WebSharper.PrintfHelpers);t=$.Safe(h.Coupon);u=$.Safe(d.View1);v=$.Safe(t.Meetup);w=$.Safe(d.AttrModule);x=$.Safe(d.ListModel);y=$.Safe($$.console);z=$.Safe($$.Date);A=$.Safe($$.WebSharper.Collections);B=$.Safe(A.MapModule);C=$.Safe(A.FSharpSet);D=$.Safe(A.BalancedTree);E=$.Safe($$.WebSharper.Slice);F=$.Safe($$.WebSharper.Operators);return G=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){t.varInplayOnly();t.meetups();o.Br();return;});}());
