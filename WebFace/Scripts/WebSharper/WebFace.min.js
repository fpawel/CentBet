(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;$.Define($$,{CentBet:{Client:{Admin:{RecordType:$.Class({},{get_color:function(){return function(V){return V.$==1?["lightgrey","red"]:V.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var W;W=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],W)),g.RenderRecords()]));},RenderCommandPrompt:function(){var X;X=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(X);},RenderMenu:function(){var Y,_0,_9;Y=function(Z){return Z;};_0=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([c.TextNode("Clear console")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([c.TextNode("Clear history")]))]);_9=d.map(Y,_0);return c.Concat(_9);},RenderRecords:function(){var _,bd;_=function(ba){var bb,bc;bc=$.New(h,{$:0});bb=d.ofArray([(g.renderRecord())(ba),(g.op_SpliceUntyped())(c.Element("br",[],bc))]);return c.Concat(bb);};bd=g.varConsole().get_View();return c.ConvertSeq(_,bd);},addRecord:function(bd,be){return g.varConsole().Add({Id:l.Fresh(),Text:be,RecordType:bd});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bf){return bf.Id;},doc:function(bg){return bg;},op_SpliceUntyped:$.Field(function(){return function(bh){return g.doc(bh);};}),recordKey:function(bi){return bi.Id;},renderInput:function(){var bj,bk,bl,bm,bp,bs,bw,bx,bL;bj=m.Create("");bk=m.Create(null);bl=m.Create(false);bm=n.Delay(function(){o.Set(bl,true);return n.Bind(g.send(o.Get(bj)),function(){o.Set(bl,false);o.Set(bj,"");return n.Return(null);});});bp=function(bq){var br;br={$:1,$0:bq};g.varCmd=function(){return br;};return o.Set(bj,bq.Text);};bs=function(bt){var bu,bv;bu=g.tryGetCommandFromHistory(bt);bv=p.map(bp,bu);return;};bw=bl.get_View();bx=function(by){var bz;bz=d.ofArray([c.Input(k.toList(k.delay(function(){return k.append([j.Create("id",g["cmd-input"]())],k.delay(function(){return k.append(by?[j.Create("disabled","disabled")]:k.empty(),k.delay(function(){return k.append([i.Style("width","80%")],k.delay(function(){return k.append([i.CustomVar(bk,function(bE){return function(){return bE.focus();};},function(){return{$:0};})],k.delay(function(){return[i.Handler("keydown",function(){return function(bJ){var bK;bK=bJ.keyCode;return bK===13?n.Start(bm,{$:0}):bK===38?bs(true):bK===40?bs(false):null;};})];}));}));}));}));})),bj)]);return c.Concat(bz);};bL=q.Map(bx,bw);return c.EmbedView(bL);},renderRecord:$.Field(function(){var bM;bM=function(bN){var bO,bP,bQ;bO=(r.get_color())(bN.RecordType);bP=bO[1];bQ=bO[0];return(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bP),i.Style("background",bQ)]),d.ofArray([c.TextNode(bN.Text)])));};return function(bR){var bS;bS=q.Map(bM,bR);return c.EmbedView(bS);};}),send:function(bT){return n.Delay(function(){var bV,bW,bX,bY,bZ,b0;bV=s.Trim(bT);g.addRecord($.New(r,{$:2}),bV);bX=o.Get(g.varCommandsHistory().Var);if(k.isEmpty(bX)){bY=true;}else{bZ=t.last(bX);bY=bZ.Text!==bV;}if(bY){g.varCommandsHistory().Add({Id:l.Fresh(),Text:bV});b0=n.Return(null);}else{b0=n.Return(null);}bW=b0;return n.Combine(bW,n.Delay(function(){return n.TryWith(n.Delay(function(){var b3;b3=v.Async("WebFace:1",[bV]);return n.Bind(b3,function(b4){var b5,b6,b7;if(b4.$==1){b6=b4.$0;g.addRecord($.New(r,{$:1}),b6);b5=n.Return(null);}else{b7=b4.$0;g.addRecord($.New(r,{$:0}),b7);b5=n.Return(null);}return b5;});}),function(b8){g.addRecord($.New(r,{$:1}),b8.message);return n.Return(null);});}));});},tryGetCommandFromHistory:function(b9){var b_,b$,ca,cb,cc,cd,ce,ch,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ;b_=o.Get(g.varCommandsHistory().Var);b$=k.length(b_);if(b$===0){ca={$:0};}else{if(g.varCmd().$==1){cd=g.varCmd().$0.Id;ce=function(cf){return function(cg){return[cg,cf];};};ch=function(ci){var cj,ck;cj=ci[0];ci[1];ck=cj.Id;return w.Equals(ck,cd);};cl=o.Get(g.varCommandsHistory().Var);cm=k.mapi(ce,cl);cn=k.tryFind(ch,cm);co=[cn,b9];if(co[0].$==1){if(co[1]){co[0].$0[0];cr=co[0].$0[1];if(b$>0?cr<b$-1:false){ct=co[0].$0[1];co[0].$0[0];cs=ct+1;}else{if(co[0].$==1){if(co[1]){cv=co[1]?b$-1:0;}else{co[0].$0[0];cw=co[0].$0[1];if(b$>0?cw>0:false){cy=co[0].$0[1];co[0].$0[0];cx=cy-1;}else{cx=co[1]?b$-1:0;}cv=cx;}cu=cv;}else{cu=co[1]?b$-1:0;}cs=cu;}cq=cs;}else{if(co[0].$==1){if(co[1]){cA=co[1]?b$-1:0;}else{co[0].$0[0];cB=co[0].$0[1];if(b$>0?cB>0:false){cD=co[0].$0[1];co[0].$0[0];cC=cD-1;}else{cC=co[1]?b$-1:0;}cA=cC;}cz=cA;}else{cz=co[1]?b$-1:0;}cq=cz;}cp=cq;}else{if(co[0].$==1){if(co[1]){cF=co[1]?b$-1:0;}else{co[0].$0[0];cG=co[0].$0[1];if(b$>0?cG>0:false){cI=co[0].$0[1];co[0].$0[0];cH=cI-1;}else{cH=co[1]?b$-1:0;}cF=cH;}cE=cF;}else{cE=co[1]?b$-1:0;}cp=cE;}cc=cp;}else{cc=b$-1;}cb=cc;cJ=k.nth(cb,b_);ca={$:1,$0:cJ};}return ca;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cK,cM;cK=function(cL){return g.cmdKey(cL);};cM=x.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))()});return B.CreateWithStorage(cK,cM);}),varConsole:$.Field(function(){var cN,cP;cN=function(cO){return g.recordKey(cO);};cP=x.LocalStorage("CentBetConsole",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["RecordType",z.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["RecordType",z.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return B.CreateWithStorage(cN,cP);})},Coupon:{EventCatalogue:$.Class({},{id:function(cQ){return cQ.gameId;}}),Meetup:$.Class({},{hasGPB:function(cR){return o.Get(cR.totalMatched).$==1;},id:function(cS){return cS.game.gameId;},inplay:function(cT){return o.Get(cT.gameInfo).playMinute.$==1;},notinplay:function(cU){return o.Get(cU.gameInfo).playMinute.$==0;},viewGameInfo:function(cV){return cV.gameInfo.get_View();}}),Render:function(){var cW,cX,cY,cZ,c0,c2,c3,c4,c5,c6,c8,c9,c_,c$,da,dc,dd,de,df,dg,di,dj,dk,dq,dz;cW=["COUPON",5000,5000];cX=cW[0];cY=cW[1];cZ=cW[2];c0=function(){return C.processCoupon();};D["new"](cX,cY,cZ,c0);c2=["EVENTS-CATALOGUE",10000,5000];c3=c2[0];c4=c2[1];c5=c2[2];c6=function(){return C.processEvents();};D["new"](c3,c4,c5,c6);c8=["MARKETS-CATALOGUE",10000,5000];c9=c8[0];c_=c8[1];c$=c8[2];da=function(){return C.processMarkets();};D["new"](c9,c_,c$,da);dc=["TOTAL-MATCHED",10000,5000];dd=dc[0];de=dc[1];df=dc[2];dg=function(){return C.processTotalMatched();};D["new"](dd,de,df,dg);di=q.get_Do();dj=C.varInplayOnly().get_View();dk=E.Bind(function(dl){return E.Bind(function(dm){return E.Bind(function(dn){var _do,dp;_do=k.isEmpty(dn);dp=!_do;return E.Const([dp,dl,dm]);},C.meetups().get_View());},C.varDataRecived().get_View());},dj);dq=function(dr){var ds,dt,du,dv,dw,dx,dy;if(dr[2]){if(dr[0]){du=d.ofArray([C.renderMeetups()]);dt=c.Element("table",$.New(h,{$:0}),d.ofArray([c.Element("tbody",[],du)]));}else{if(dr[1]){dw=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0440\u0430\u0437\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445")]);dv=c.Element("h1",[],dw);}else{dx=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445 \u043d\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f")]);dv=c.Element("h1",[],dx);}dt=dv;}ds=dt;}else{dy=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);ds=c.Element("h1",[],dy);}return ds;};dz=q.Map(dq,dk);return c.EmbedView(dz);},RenderMenu:function(){var dA;dA=d.ofArray([C.renderMenusInplay(),C.renderMenuCountries()]);return c.Concat(dA);},Work:$.Class({},{loop:function(dB){return n.Delay(function(){var dD;dD=n.Delay(function(){return n.Bind(dB.work.call(null,null),function(){return n.Bind(n.Sleep(dB.sleepInterval),function(){return n.Return(null);});});});return n.Combine(n.TryWith(dD,function(dH){var dI,dM;dI=function(dJ){return function(dK){var dL;dL="task error "+F.prettyPrint(dJ)+" : "+F.prettyPrint(dK);return G?G.log(dL):undefined;};};dM=dB.what;(dI(dM))(dH);return n.Bind(n.Sleep(dB.sleepErrorInterval),function(){return n.Return(null);});}),n.Delay(function(){return D.loop(dB);}));});},"new":function(dP,dQ,dR,dS){var dT;dT=$.New(D,{what:dP,sleepInterval:dQ,sleepErrorInterval:dR,work:dS});return D.run(dT);},run:function(dU){var dV;dV=n.Delay(function(){var dX,d0;dX=function(dY){var dZ;dZ="task "+F.prettyPrint(dY)+" : started";return G?G.log(dZ):undefined;};d0=dU.what;dX(d0);return n.Bind(D.loop(dU),function(){var d2,d5;d2=function(d3){var d4;d4="task "+F.prettyPrint(d3)+" : terminated";return G?G.log(d4):undefined;};d5=dU.what;d2(d5);return n.Return(null);});});return n.Start(dV,{$:0});}}),addNewGames:function(d6){var d7,d8,d9,eh,ej,el,em,en;d7=o.Get(C.meetups().Var);d8=k.toList(d7);C.meetups().Clear();d9=function(d_){var d$,ea,eb,ec,ed,ee,ef,eg;d$=d_[0];ea=d_[1];eb=d_[2];ec=d$.gameId;ed=ec[0];ee=ec[1];ef=C.tryGetCountry(ed,ee);eg=m.Create(ea);return $.New(H,{game:d$,gameInfo:eg,country:m.Create(ef),totalMatched:m.Create({$:0}),hash:eb});};eh=function(ei){return o.Get(ei.gameInfo).order;};ej=function(ek){return C.meetups().Add(ek);};el=d.map(d9,d6);em=k.append(d8,el);en=k.sortBy(eh,em);return k.iter(ej,en);},doc:function(eo){return eo;},eventsCatalogue:$.Field(function(){var ep,eq,es,et,eu,ev;ep=J.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");eq=function(er){return K.id(er);};et=(z.get_Default().EncodeRecord(K,[["gameId",z.get_Default().EncodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))();es=x.LocalStorage("CentBetEventsCatalogue",{Encode:et,Decode:(z.get_Default().DecodeRecord(K,[["gameId",z.get_Default().DecodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))()});eu=B.CreateWithStorage(eq,es);ev=function(ew){return function(ex){return function(ey){var ez;ez=F.prettyPrint(ew)+" - "+$$.String(ex)+", "+F.prettyPrint(ey);return G?G.log(ez):undefined;};};};((ev("CentBetEventsCatalogue"))(eu.get_Length()))(ep);return eu;}),meetups:$.Field(function(){var eA,eC;eA=function(eB){return H.id(eB);};eC=$.New(h,{$:0});return B.Create(eA,eC);}),processCoupon:function(){return n.Delay(function(){var eE,eG,eH,eI,eJ;eE=function(eF){return[eF.game.gameId,eF.hash];};eG=o.Get(C.meetups().Var);eH=k.map(eE,eG);eI=k.toList(eH);eJ=v.Async("WebFace:0",[eI,o.Get(C.varInplayOnly())]);return n.Bind(eJ,function(eK){var eL,eM,eN,eO;eL=eK[1];eM=eK[2];eN=eK[0];if(!(eN.$==0)?true:!(eL.$==0)){o.Set(C.varDataRecived(),true);eO=n.Return(null);}else{eO=n.Return(null);}return n.Combine(eO,n.Delay(function(){C.updateCoupon(eN,eL,eM);return n.Return(null);}));});});},processEvents:function(){return n.Delay(function(){var eR,eS,eT,eY,eZ,e0,e1;eR=o.Get(C.eventsCatalogue().Var);eS=o.Get(C.meetups().Var);eT=function(eU){var eV,eX;eV=function(eW){return w.Equals(eW.gameId,eU.game.gameId);};eX=k.tryFind(eV,eR);return eX.$==0?{$:1,$0:eU.game.gameId}:{$:0};};eY=k.choose(eT,eS);eZ=k.toList(eY);if(eZ.$==0){e0=n.Return(null);}else{e1=v.Async("WebFace:2",[eZ]);e0=n.Bind(e1,function(e2){var e3;e3=n.For(e2,function(e4){var e5,e6;e4[1];e5=e4[0];e6=e4[2];C.eventsCatalogue().Add($.New(K,{gameId:e5,country:e6,markets:$.New(h,{$:0})}));return n.Return(null);});return n.Combine(e3,n.Delay(function(){return n.For(o.Get(C.meetups().Var),function(e8){var e9,e_,e$;e9=e8.game.gameId;e_=e9[0];e$=e9[1];o.Set(e8.country,C.tryGetCountry(e_,e$));return n.Return(null);});}));});}return e0;});},processMarkets:function(){return n.Delay(function(){var fb,fd,fe,ff;fb=function(fc){return fc.markets.$==0;};fd=o.Get(C.eventsCatalogue().Var);fe=k.filter(fb,fd);ff=k.toList(fe);return ff.$==0?n.Return(null):n.For(ff,function(fg){var fh,fi,fj,fk;fh=fg.gameId;fi=fh[0];fj=fh[1];fk=v.Async("WebFace:6",[fi,fj]);return n.Bind(fk,function(fl){var fm,fn,fo,fr,fs,ft,fu,fv,fw,fx,fy,fH,fI,fK,fL;if(fl.$==1){fn=fl.$0;fo=function(fp){var fq;fp[0];fp[1];fp[2];fq=fp[3];return fq;};fr=fg.gameId;fs=fr[0];ft=fr[1];fu=d.choose(fo,fn);if(fu.$==0){fw={$:0};}else{fx=k.sum(fu);fw={$:1,$0:fx};}fv=fw;C.updateTotalMatched(fs,ft,fv);fy=function(fz){var fA,fB,fC,fD;fA=fz[0];fB=fz[1];fC=fz[2];fz[3];fD=function(fE){var fF,fG;fF=fE[0];fG=fE[1];return{selectionId:fG,runnerName:fF};};return{marketId:fA,marketName:fB,runners:d.map(fD,fC)};};fH=d.map(fy,fn);fI=function(fJ){return{$:1,$0:$.New(K,{gameId:fJ.gameId,country:fJ.country,markets:fH})};};fK=fg.gameId;C.eventsCatalogue().UpdateBy(fI,fK);fm=n.Return(null);}else{fL=fl.$0;L.FailWith(fL);fm=n.Return(null);}return fm;});});});},processTotalMatched:function(){return n.Delay(function(){var fN,fP,fQ,fR;fN=function(fO){return fO.game.gameId;};fP=o.Get(C.meetups().Var);fQ=k.map(fN,fP);fR=k.toList(fQ);return fR.$==0?n.Return(null):n.For(fR,function(fS){var fT,fU,fV;fT=fS[0];fU=fS[1];fV=v.Async("WebFace:3",[fT,fU]);return n.Bind(fV,function(fW){var fX,fY,fZ,f0,f1;if(fW.$==1){fY=fW.$0;fZ=fS[0];f0=fS[1];C.updateTotalMatched(fZ,f0,fY);fX=n.Return(null);}else{f1=fW.$0;L.FailWith(f1);fX=n.Return(null);}return fX;});});});},renderGamesHeaderRow:function(f2){var f3,gr;f3=k.toList(k.delay(function(){var f5,f6;f5=d.ofArray([c.TextNode("\u2116")]);f6=c.Element("td",[],f5);return k.append([C.doc(f6)],k.delay(function(){var f8,f9;f8=d.ofArray([c.TextNode("1")]);f9=c.Element("td",[],f8);return k.append([C.doc(f9)],k.delay(function(){var f$,ga,gb;if(f2){ga=$.New(h,{$:0});gb=c.Element("td",[],ga);f$=[C.doc(gb)];}else{f$=k.empty();}return k.append(f$,k.delay(function(){var gd,ge;gd=d.ofArray([c.TextNode("2")]);ge=c.Element("td",[],gd);return k.append([C.doc(ge)],k.delay(function(){var gg,gh;gg=$.New(h,{$:0});gh=c.Element("td",[],gg);return k.append([C.doc(gh)],k.delay(function(){var gj;gj=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("1")]));return k.append([C.doc(gj)],k.delay(function(){var gl;gl=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("×")]));return k.append([C.doc(gl)],k.delay(function(){var gn;gn=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("2")]));return k.append([C.doc(gn)],k.delay(function(){var gp,gq;gp=d.ofArray([c.TextNode("GPB")]);gq=c.Element("td",[],gp);return[C.doc(gq)];}));}));}));}));}));}));}));}));}));gr=d.ofArray([i.Class("coupon-header-row")]);return c.Element("tr",gr,f3);},renderMeetup:function(gs,gt,gu,gv){var gw,gx,gy,gz,gA,gB,gC,gD,gL,gM,gN,gV,gW,gX,gY,gZ,g0,g8,g9,g_,hg;gw=[gs,o.Get(gv.gameInfo).playMinute,gt];if(gw[0]){if(gw[1].$==0){gy=c.get_Empty();}else{if(gw[2].$==1){gA=gw[2].$0;if(gA!==""?gA!==o.Get(gv.country):false){gw[2].$0;gB=c.get_Empty();}else{gC=gv.gameInfo.get_View();gD=function(gE){var gF,gH,gI,gJ,gK;gF=function(gG){return gG.$==1;};gH=d.ofArray([gE.drawBack,gE.drawLay,gE.winBack,gE.winLay,gE.loseBack,gE.loseLay]);if(k.exists(gF,gH)){gJ=C.renderMeetup1(gv,gt.$==1,gu);gK=c.Element("tr",[],gJ);gI=C.doc(gK);}else{gI=c.get_Empty();}return gI;};gL=q.Map(gD,gC);gB=c.EmbedView(gL);}gz=gB;}else{gM=gv.gameInfo.get_View();gN=function(gO){var gP,gR,gS,gT,gU;gP=function(gQ){return gQ.$==1;};gR=d.ofArray([gO.drawBack,gO.drawLay,gO.winBack,gO.winLay,gO.loseBack,gO.loseLay]);if(k.exists(gP,gR)){gT=C.renderMeetup1(gv,gt.$==1,gu);gU=c.Element("tr",[],gT);gS=C.doc(gU);}else{gS=c.get_Empty();}return gS;};gV=q.Map(gN,gM);gz=c.EmbedView(gV);}gy=gz;}gx=gy;}else{if(gw[2].$==1){gX=gw[2].$0;if(gX!==""?gX!==o.Get(gv.country):false){gw[2].$0;gY=c.get_Empty();}else{gZ=gv.gameInfo.get_View();g0=function(g1){var g2,g4,g5,g6,g7;g2=function(g3){return g3.$==1;};g4=d.ofArray([g1.drawBack,g1.drawLay,g1.winBack,g1.winLay,g1.loseBack,g1.loseLay]);if(k.exists(g2,g4)){g6=C.renderMeetup1(gv,gt.$==1,gu);g7=c.Element("tr",[],g6);g5=C.doc(g7);}else{g5=c.get_Empty();}return g5;};g8=q.Map(g0,gZ);gY=c.EmbedView(g8);}gW=gY;}else{g9=gv.gameInfo.get_View();g_=function(g$){var ha,hc,hd,he,hf;ha=function(hb){return hb.$==1;};hc=d.ofArray([g$.drawBack,g$.drawLay,g$.winBack,g$.winLay,g$.loseBack,g$.loseLay]);if(k.exists(ha,hc)){he=C.renderMeetup1(gv,gt.$==1,gu);hf=c.Element("tr",[],he);hd=C.doc(hf);}else{hd=c.get_Empty();}return hd;};hg=q.Map(g_,g9);gW=c.EmbedView(hg);}gx=gW;}return gx;},renderMeetup1:function(hh,hi,hj){var hk,ho;hk=function(hl){var hm,hn;hm=hh.gameInfo.get_View();hn=q.Map(hl,hm);return c.TextView(hn);};ho=function(hp,hq){var hr;hr=c.Element("td",d.ofArray([j.Create("class",hp?"kef kef-back":"kef kef-lay")]),d.ofArray([hk(hq)]));return C.doc(hr);};return k.toList(k.delay(function(){var ht,hy;ht=d.ofArray([hk(function(hu){var hv,hw,hx;hv=hu.order;hw=hv[0];hx=hv[1];return $$.String(hw)+"."+$$.String(hx);})]);hy=c.Element("td",[],ht);return k.append([C.doc(hy)],k.delay(function(){var hA;hA=c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(hh.game.home)]));return k.append([C.doc(hA)],k.delay(function(){var hC,hD,hE;if(hj){hD=hh.gameInfo.get_View();hE=q.Map(function(hF){var hG,hH,hI;if(hF.playMinute.$==1){hF.playMinute.$0;hH=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(hF.summary)]));}else{hI=$.New(h,{$:0});hH=c.Element("td",[],hI);}hG=hH;return C.doc(hG);},hD);hC=[c.EmbedView(hE)];}else{hC=k.empty();}return k.append(hC,k.delay(function(){var hK;hK=c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(hh.game.away)]));return k.append([C.doc(hK)],k.delay(function(){var hM;hM=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([hk(function(hN){return hN.status;})]));return k.append([C.doc(hM)],k.delay(function(){return k.append([ho(true,function(hP){return I.formatDecimalOption(hP.winBack);})],k.delay(function(){return k.append([ho(false,function(hR){return I.formatDecimalOption(hR.winLay);})],k.delay(function(){return k.append([ho(true,function(hT){return I.formatDecimalOption(hT.drawBack);})],k.delay(function(){return k.append([ho(false,function(hV){return I.formatDecimalOption(hV.drawLay);})],k.delay(function(){return k.append([ho(true,function(hX){return I.formatDecimalOption(hX.loseBack);})],k.delay(function(){return k.append([ho(false,function(hZ){return I.formatDecimalOption(hZ.loseLay);})],k.delay(function(){var h1,h2,h8;h1=hh.totalMatched.get_View();h2=function(h3){var h4,h5,h6,h7;if(h3.$==1){h5=h3.$0;h6=$$.String(h5);h4=c.Element("td",d.ofArray([j.Create("class","game-gpb")]),d.ofArray([c.TextNode(h6)]));}else{h7=$.New(h,{$:0});h4=c.Element("td",[],h7);}return h4;};h8=q.Map(h2,h1);return k.append([c.EmbedView(h8)],k.delay(function(){var h_,h$;if(!hi){h$=c.Element("td",d.ofArray([j.Create("class","game-country")]),d.ofArray([c.TextView(hh.country.get_View())]));h_=[C.doc(h$)];}else{h_=k.empty();}return h_;}));}));}));}));}));}));}));}));}));}));}));}));}));},renderMeetups:function(){var ia,ib,ic;ia=q.get_Do();ib=C.meetups().get_View();ic=E.Bind(function(id){var ie;ie=C.varInplayOnly().get_View();return E.Bind(function(_if){var ig;ig=C.varSelectedCountry().get_View();return E.Bind(function(ih){var ii,ik,il,im,_in,io,ip,iq,ir,is,iu;ii=function(ij){return H.inplay(ij);};ik=k.exists(ii,id);_in=C.renderGamesHeaderRow(ik);im=d.ofArray([C.doc(_in)]);io=[_if,ih,ik];ip=io[0];iq=io[1];ir=io[2];is=function(it){return C.renderMeetup(ip,iq,ir,it);};iu=k.map(is,id);il=d.ofArray([c.Element("thead",[],im),c.Element("tbody",[],iu)]);return E.Const(c.Element("table",[],il));},ig);},ie);},ib);return c.EmbedView(ic);},renderMenuCountries:function(){var iv,iy,iI;q.get_Do();iv=E.Bind(function(iw){return E.Bind(function(ix){return E.Const([iw,ix]);},C.varSelectedCountry().get_View());},C.viewCountries());iy=function(iz){var iA,iB,iC,iD,iF,iG,iH;iA=iz[0];iB=iz[1];if(k.isEmpty(iA)){iC=c.get_Empty();}else{iD=function(iE){return C.renderMenuItemCountry(iB,iE);};iF=k.map(iD,iA);iG=c.Concat(iF);iH=C.renderMenuItemAllCountries();iC=c.Append(iH,iG);}return iC;};iI=q.Map(iy,iv);return c.EmbedView(iI);},renderMenuItemAllCountries:function(){var iJ,iK,iU;iJ=C.varSelectedCountry().get_View();iK=function(iL){return c.Element("a",k.toList(k.delay(function(){var iN,iO,iP;if(iL.$==1){iO=iL.$0;if(iO!==""){iL.$0;iP=k.empty();}else{iP=[j.Create("class","active")];}iN=iP;}else{iN=[j.Create("class","active")];}return k.append(iN,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:0});};})];}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u0441\u0442\u0440\u0430\u043d\u044b")]));};iU=q.Map(iK,iJ);return c.EmbedView(iU);},renderMenuItemCountry:function(iV,iW){return c.Element("a",k.toList(k.delay(function(){var iY,iZ,i0;if(iV.$==1){iZ=iV.$0;if(iZ===iW){iV.$0;i0=[j.Create("class","active")];}else{i0=k.empty();}iY=i0;}else{iY=k.empty();}return k.append(iY,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:1,$0:iW});};})];}));}));})),d.ofArray([c.TextNode(iW)]));},renderMenusInplay:function(){var i5,i6,jk;i5=C.varInplayOnly().get_View();i6=function(i7){var i8,i_,jj;i8=function(i9){return i9;};i_=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),true);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return i7?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),false);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return!i7?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);jj=d.map(i8,i_);return c.Concat(jj);};jk=q.Map(i6,i5);return c.EmbedView(jk);},tryGetCountry:function(jl,jm){var jn,jo,jp,jq,jr,js,jt;jn=[jl,jm];jo=jn[0];jp=jn[1];jq=C.tryGetEvent(jo,jp);if(jq.$==1){if(jq.$0.country.$==1){jt=jq.$0.country.$0;js=jt;}else{js="";}jr=js;}else{jr="";}return jr;},tryGetEvent:function(ju,jv){var jw,jx,jA;jw=[ju,jv];jx=function(jy){var jz;jz=jy.gameId;return w.Equals(jw,jz);};jA=o.Get(C.eventsCatalogue().Var);return k.tryFind(jx,jA);},updateCoupon:function(jB,jC,jD){var jE,jF,jG,jJ,jK,jL,jM,jO,jR,jS;jE=jB.$==0;if(!jE){jG=function(jH){var jI;jI="adding new games "+$$.String(jH);return G?G.log(jI):undefined;};jJ=jB.get_Length();jG(jJ);jF=C.addNewGames(jB);}else{jF=null;}jK=k.isEmpty(jD);if(!jK){jM=function(jN){return C.meetups().RemoveByKey(jN);};k.iter(jM,jD);jO=function(jP){var jQ;jQ="removing out games "+$$.String(jP);return G?G.log(jQ):undefined;};jR=k.length(jD);jL=jO(jR);}else{jL=null;}jS=function(jT){var jU,jV,jW,jX,jY,jZ;jU=jT[0];jV=jT[1];jW=jT[2];jX=C.meetups().TryFindByKey(jU);if(jX.$==1){jZ=jX.$0;o.Set(jZ.gameInfo,jV);jY=void(jZ.hash=jW);}else{jY=null;}return jY;};return k.iter(jS,jC);},updateTotalMatched:function(j0,j1,j2){var j3,j4,j5,j6;j3=[j0,j1];j4=C.meetups().TryFindByKey(j3);if(j4.$==1){j6=j4.$0;j5=o.Set(j6.totalMatched,j2);}else{j5=null;}return j5;},varDataRecived:$.Field(function(){return m.Create(false);}),varInplayOnly:$.Field(function(){return m.Create(true);}),varSelectedCountry:$.Field(function(){return m.Create({$:0});}),viewCountries:function(){var j7,j8;j7=q.get_Do();j8=C.eventsCatalogue().get_View();return E.Bind(function(j9){var j_,ka,kb,kc;j_=function(j$){return[j$.gameId,j$];};ka=k.map(j_,j9);kb=N.OfArray(k.toArray(ka));kc=C.viewGames();return E.Bind(function(kd){var ke,kk,kl,km,ko,kp,kr,ks;ke=function(kf){var kg,kh,kj;kg=kf[0];kf[1];kh=function(ki){return ki.country;};kj=kb.TryFind(kg.gameId);return p.map(kh,kj);};kk=k.choose(ke,kd);kl={$:0};km=function(kn){return!w.Equals(kl,kn);};ko=k.filter(km,kk);kp=function(kq){return kq;};kr=k.choose(kp,ko);ks=t.distinct(kr);return E.Const(k.sort(ks));},kc);},j8);},viewGames:$.Field(function(){var kt,ku;kt=q.get_Do();ku=C.meetups().get_View();return E.Bind(function(kv){var kw,kx;if(k.isEmpty(kv)){kw=E.Const(k.empty());}else{kx=C.varInplayOnly().get_View();kw=E.Bind(function(ky){var kz,kB,kG,kH;kz=function(kA){return!ky?true:o.Get(kA.gameInfo).playMinute.$==1;};kB=function(kC){var kD,kF;kD=function(kE){return[kC.game,kE];};kF=kC.gameInfo.get_View();return q.Map(kD,kF);};kG=k.filter(kz,kv);kH=k.map(kB,kG);return E.Bind(function(kI){return E.Const(kI);},E.Sequence(kH));},kx);}return kw;},ku);})},Utils:{LocalStorage:{checkTodayKey:function(kJ,kK){var kL,kM,kN,kO;kL=O.now();kM=J.getWithDef(kJ,kL);if(kL-kM>1*86400000){J.clear(kK);J.set(kJ,O.now());kO=function(kP){return function(kQ){var kR;kR="local storage "+F.prettyPrint(kP)+" of "+F.prettyPrint(kQ)+" is inspired";return G?G.log(kR):undefined;};};(kO(kK))(kM);kN=kL;}else{kN=kM;}return kN;},clear:function(kS){return J.strg().removeItem(kS);},get:function(kT){var kU,kV,kW,kX,kY;try{kV=J.strg().getItem(kT);kW=P.parse(kV);kU={$:1,$0:kW};}catch(kX){kY=function(kZ){return function(k0){var k1;k1="error getting from local storage, key "+F.prettyPrint(kZ)+" : "+F.prettyPrint(k0);return G?G.log(k1):undefined;};};(kY(kT))(kX);kU={$:0};}return kU;},getWithDef:function(k2,k3){var k4,k5,k6;k4=J.get(k2);if(k4.$==1){k6=k4.$0;k5=k6;}else{k5=k3;}return k5;},set:function(k7,k8){var k9,k_,k$,la;try{k_=P.stringify(k8);k9=J.strg().setItem(k7,k_);}catch(k$){la=function(lb){return function(lc){return function(ld){return L.FailWith("error setting to local storage, key "+F.prettyPrint(lb)+", value "+F.prettyPrint(lc)+" : "+F.prettyPrint(ld));};};};k9=((la(k7))(k8))(k$);}return k9;},strg:$.Field(function(){return Q.localStorage;})},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(le){return I.trimEnd(le.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(lf){var lg,lh;if(lf.$==1){lh=lf.$0;lg=I.formatDecimal(lh);}else{lg="";}return lg;},getDatePart:function(li){var lj;lj=new O(li.getTime());lj.setHours(0,0,0,0);return lj;},mkids:function(lk,ll){var lm,lo,lp,lq,lr;lm=function(ln){return[ll(ln),ln];};lo=d.map(lm,lk);lp=N.OfArray(k.toArray(lo));lq=d.map(ll,lk);lr=R.New1(S.OfSeq(lq));return[lr,lp];},trimEnd:function(ls,lt){var lu,lv,lw,lx,ly,lz,lA,lB,lC,lD,lE,lF;lu=[ls,lt];if(lu[0]===""){lv="";}else{if(lu[1].$==1){lx=lu[0];lu[1];ly=lu[1].$0;if(lx.charCodeAt(lx.length-1)===ly){lu[1].$0;lA=lu[1];lB=lu[0];lz=I.trimEnd(T.string(lB,{$:0},{$:1,$0:lB.length-2}),lA);}else{if(lu[1].$==1){lD=lu[0];lE=lu[1].$1;lC=I.trimEnd(lD,lE);}else{lC=L.Raise(U.New("E:\\User\\Docs\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}lz=lC;}lw=lz;}else{lF=lu[0];lw=lF;}lv=lw;}return lv;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe($$.WebSharper.Seq);l=$.Safe(b.Key);m=$.Safe(b.Var);n=$.Safe($$.WebSharper.Concurrency);o=$.Safe(b.Var1);p=$.Safe($$.WebSharper.Option);q=$.Safe(b.View);r=$.Safe(g.RecordType);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe(b.Storage1);y=$.Safe($$.WebSharper.Json);z=$.Safe(y.Provider);A=$.Safe(z.Id);B=$.Safe(b.ListModel);C=$.Safe(f.Coupon);D=$.Safe(C.Work);E=$.Safe(b.View1);F=$.Safe($$.WebSharper.PrintfHelpers);G=$.Safe($$.console);H=$.Safe(C.Meetup);I=$.Safe(f.Utils);J=$.Safe(I.LocalStorage);K=$.Safe(C.EventCatalogue);L=$.Safe($$.WebSharper.Operators);M=$.Safe($$.WebSharper.Collections);N=$.Safe(M.MapModule);O=$.Safe($$.Date);P=$.Safe($$.JSON);Q=$.Safe($$.window);R=$.Safe(M.FSharpSet);S=$.Safe(M.BalancedTree);T=$.Safe($$.WebSharper.Slice);return U=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){J.strg();C.viewGames();C.varSelectedCountry();C.varInplayOnly();C.varDataRecived();C.meetups();C.eventsCatalogue();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
