(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({},{get_color:function(){return function(U){return U.$==1?["lightgrey","red"]:U.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var V;V=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],V)),g.RenderRecords()]));},RenderCommandPrompt:function(){var W;W=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(W);},RenderMenu:function(){var X,Z,_8;X=function(Y){return Y;};Z=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([c.TextNode("Clear console")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([c.TextNode("Clear history")]))]);_8=d.map(X,Z);return c.Concat(_8);},RenderRecords:function(){var _9,bc;_9=function(_){var ba,bb;bb=$.New(h,{$:0});ba=d.ofArray([(g.renderRecord())(_),(g.op_SpliceUntyped())(c.Element("br",[],bb))]);return c.Concat(ba);};bc=g.varConsole().get_View();return c.ConvertSeq(_9,bc);},addRecord:function(bc,bd){return g.varConsole().Add({Id:l.Fresh(),Text:bd,Level:bc});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(be){return be.Id;},doc:function(bf){return bf;},op_SpliceUntyped:$.Field(function(){return function(bg){return g.doc(bg);};}),recordKey:function(bh){return bh.Id;},renderInput:function(){var bi,bj,bk,bl,bo,br,bv,bw,bK;bi=m.Create("");bj=m.Create(null);bk=m.Create(false);bl=n.Delay(function(){o.Set(bk,true);return n.Bind(g.send(o.Get(bi)),function(){o.Set(bk,false);o.Set(bi,"");return n.Return(null);});});bo=function(bp){var bq;bq={$:1,$0:bp};g.varCmd=function(){return bq;};return o.Set(bi,bp.Text);};br=function(bs){var bt,bu;bt=g.tryGetCommandFromHistory(bs);bu=p.map(bo,bt);return;};bv=bk.get_View();bw=function(bx){var by;by=d.ofArray([c.Input(k.toList(k.delay(function(){return k.append([j.Create("id",g["cmd-input"]())],k.delay(function(){return k.append(bx?[j.Create("disabled","disabled")]:k.empty(),k.delay(function(){return k.append([i.Style("width","80%")],k.delay(function(){return k.append([i.CustomVar(bj,function(bD){return function(){return bD.focus();};},function(){return{$:0};})],k.delay(function(){return[i.Handler("keydown",function(){return function(bI){var bJ;bJ=bI.keyCode;return bJ===13?n.Start(bl,{$:0}):bJ===38?br(true):bJ===40?br(false):null;};})];}));}));}));}));})),bi)]);return c.Concat(by);};bK=q.Map(bw,bv);return c.EmbedView(bK);},renderRecord:$.Field(function(){var bL;bL=function(bM){var bN,bO,bP;bN=(r.get_color())(bM.Level);bO=bN[1];bP=bN[0];return(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bO),i.Style("background",bP)]),d.ofArray([c.TextNode(bM.Text)])));};return function(bQ){var bR;bR=q.Map(bL,bQ);return c.EmbedView(bR);};}),send:function(bS){return n.Delay(function(){var bU,bV,bW,bX,bY,bZ;bU=s.Trim(bS);g.addRecord($.New(r,{$:2}),bU);bW=o.Get(g.varCommandsHistory().Var);if(k.isEmpty(bW)){bX=true;}else{bY=t.last(bW);bX=bY.Text!==bU;}if(bX){g.varCommandsHistory().Add({Id:l.Fresh(),Text:bU});bZ=n.Return(null);}else{bZ=n.Return(null);}bV=bZ;return n.Combine(bV,n.Delay(function(){return n.TryWith(n.Delay(function(){return n.Bind(v.Async("WebFace:1",[bU]),function(b2){var b3;b2[0];b3=b2[1];g.addRecord($.New(r,{$:0}),b3);return n.Return(null);});}),function(b4){g.addRecord($.New(r,{$:1}),b4.message);return n.Return(null);});}));});},tryGetCommandFromHistory:function(b5){var b6,b7,b8,b9,b_,b$,ca,cd,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF;b6=o.Get(g.varCommandsHistory().Var);b7=k.length(b6);if(b7===0){b8={$:0};}else{if(g.varCmd().$==1){b$=g.varCmd().$0.Id;ca=function(cb){return function(cc){return[cc,cb];};};cd=function(ce){var cf,cg;cf=ce[0];ce[1];cg=cf.Id;return w.Equals(cg,b$);};ch=o.Get(g.varCommandsHistory().Var);ci=k.mapi(ca,ch);cj=k.tryFind(cd,ci);ck=[cj,b5];if(ck[0].$==1){if(ck[1]){ck[0].$0[0];cn=ck[0].$0[1];if(b7>0?cn<b7-1:false){cp=ck[0].$0[1];ck[0].$0[0];co=cp+1;}else{if(ck[0].$==1){if(ck[1]){cr=ck[1]?b7-1:0;}else{ck[0].$0[0];cs=ck[0].$0[1];if(b7>0?cs>0:false){cu=ck[0].$0[1];ck[0].$0[0];ct=cu-1;}else{ct=ck[1]?b7-1:0;}cr=ct;}cq=cr;}else{cq=ck[1]?b7-1:0;}co=cq;}cm=co;}else{if(ck[0].$==1){if(ck[1]){cw=ck[1]?b7-1:0;}else{ck[0].$0[0];cx=ck[0].$0[1];if(b7>0?cx>0:false){cz=ck[0].$0[1];ck[0].$0[0];cy=cz-1;}else{cy=ck[1]?b7-1:0;}cw=cy;}cv=cw;}else{cv=ck[1]?b7-1:0;}cm=cv;}cl=cm;}else{if(ck[0].$==1){if(ck[1]){cB=ck[1]?b7-1:0;}else{ck[0].$0[0];cC=ck[0].$0[1];if(b7>0?cC>0:false){cE=ck[0].$0[1];ck[0].$0[0];cD=cE-1;}else{cD=ck[1]?b7-1:0;}cB=cD;}cA=cB;}else{cA=ck[1]?b7-1:0;}cl=cA;}b_=cl;}else{b_=b7-1;}b9=b_;cF=k.nth(b9,b6);b8={$:1,$0:cF};}return b8;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cG,cI;cG=function(cH){return g.cmdKey(cH);};cI=x.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))()});return B.CreateWithStorage(cG,cI);}),varConsole:$.Field(function(){var cJ,cL;cJ=function(cK){return g.recordKey(cK);};cL=x.LocalStorage("CentBetConsole",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return B.CreateWithStorage(cJ,cL);})},Coupon:{EventCatalogue:$.Class({},{id:function(cM){return cM.gameId;}}),Meetup:$.Class({},{id:function(cN){return cN.game.gameId;},inplay:function(cO){return o.Get(cO.gameInfo).playMinute.$==1;},notinplay:function(cP){return o.Get(cP.gameInfo).playMinute.$==0;},viewGameInfo:function(cQ){return cQ.gameInfo.get_View();}}),Render:function(){var cR,cS,cT,cZ,c8;n.Start(C.workloop(),{$:0});cR=q.get_Do();cS=C.varInplayOnly().get_View();cT=D.Bind(function(cU){return D.Bind(function(cV){return D.Bind(function(cW){var cX,cY;cX=k.isEmpty(cW);cY=!cX;return D.Const([cY,cU,cV]);},C.meetups().get_View());},C.varDataRecived().get_View());},cS);cZ=function(c0){var c1,c2,c3,c4,c5,c6,c7;if(c0[2]){if(c0[0]){c3=d.ofArray([C.renderMeetups()]);c2=c.Element("table",$.New(h,{$:0}),d.ofArray([c.Element("tbody",[],c3)]));}else{if(c0[1]){c5=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0440\u0430\u0437\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445")]);c4=c.Element("h1",[],c5);}else{c6=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445 \u043d\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f")]);c4=c.Element("h1",[],c6);}c2=c4;}c1=c2;}else{c7=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);c1=c.Element("h1",[],c7);}return c1;};c8=q.Map(cZ,cT);return c.EmbedView(c8);},RenderMenu:function(){var c9;c9=d.ofArray([C.renderMenusInplay(),C.renderMenuCountries()]);return c.Concat(c9);},addNewGames:function(c_){var c$,da,db,dl,dn,dp,dq,dr;c$=o.Get(C.meetups().Var);da=k.toList(c$);C.meetups().Clear();db=function(dc){var dd,de,df,dg,dh,di,dj,dk;dd=dc[0];de=dc[1];df=dc[2];dg=dd.gameId;dh=dg[0];di=dg[1];dj=C.tryGetCountry(dh,di);dk=m.Create(de);return $.New(E,{game:dd,gameInfo:dk,country:m.Create(dj),totalMatched:m.Create({$:0}),hash:df});};dl=function(dm){return o.Get(dm.gameInfo).order;};dn=function(_do){return C.meetups().Add(_do);};dp=d.map(db,c_);dq=k.append(da,dp);dr=k.sortBy(dl,dq);return k.iter(dn,dr);},eventsCatalogue:$.Field(function(){var ds,dt,dv,dw,dx,dy;ds=G.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");dt=function(du){return H.id(du);};dw=(z.get_Default().EncodeRecord(H,[["gameId",z.get_Default().EncodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))();dv=x.LocalStorage("CentBetEventsCatalogue",{Encode:dw,Decode:(z.get_Default().DecodeRecord(H,[["gameId",z.get_Default().DecodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))()});dx=B.CreateWithStorage(dt,dv);dy=function(dz){return function(dA){return function(dB){var dC;dC=I.prettyPrint(dz)+" - "+$$.String(dA)+", "+I.prettyPrint(dB);return J?J.log(dC):undefined;};};};((dy("CentBetEventsCatalogue"))(dx.get_Length()))(ds);return dx;}),meetups:$.Field(function(){var dD,dF;dD=function(dE){return E.id(dE);};dF=$.New(h,{$:0});return B.Create(dD,dF);}),processCoupon:function(){return n.Delay(function(){var dH,dJ,dK,dL;dH=function(dI){return[dI.game.gameId,dI.hash];};dJ=o.Get(C.meetups().Var);dK=k.map(dH,dJ);dL=k.toList(dK);return n.Bind(v.Async("WebFace:0",[dL,o.Get(C.varInplayOnly())]),function(dM){var dN,dO,dP;dN=dM[1];dO=dM[2];dP=dM[0];C.updateCoupon(dP,dN,dO);return n.Return(null);});});},processEvents:function(){return n.Delay(function(){var dR,dS,dT,dY,dZ,d0,d2;dR=o.Get(C.eventsCatalogue().Var);dS=o.Get(C.meetups().Var);dT=function(dU){var dV,dX;dV=function(dW){return w.Equals(dW.gameId,dU.game.gameId);};dX=k.tryFind(dV,dR);return dX.$==0?{$:1,$0:dU.game.gameId}:{$:0};};dY=k.choose(dT,dS);dZ=k.toList(dY);if(dZ.$==0){d0=n.Bind(n.Sleep(5000),function(){return n.Return(null);});}else{d2=v.Async("WebFace:2",[dZ]);d0=n.Bind(d2,function(d3){var d4;d4=n.For(d3,function(d5){var d6,d7;d5[1];d6=d5[0];d7=d5[2];C.eventsCatalogue().Add($.New(H,{gameId:d6,country:d7,markets:$.New(h,{$:0})}));return n.Return(null);});return n.Combine(d4,n.Delay(function(){return n.For(o.Get(C.meetups().Var),function(d9){var d_,d$,ea;d_=d9.game.gameId;d$=d_[0];ea=d_[1];o.Set(d9.country,C.tryGetCountry(d$,ea));return n.Return(null);});}));});}return d0;});},processMarkets:function(){return n.Delay(function(){var ec,ee,ef,eg,eh,ei,ej,ek,el,em;ec=function(ed){return ed.markets.$==0;};ee=o.Get(C.eventsCatalogue().Var);ef=k.filter(ec,ee);eg=k.toList(ef);if(eg.$==0){eh=n.Return(null);}else{ei=eg.$0;ej=ei.gameId;ek=ej[0];el=ej[1];em=v.Async("WebFace:4",[ek,el]);eh=n.Bind(em,function(en){var eo,ep,eq,et,eu,ev,ew,ex,ey,ez,eA,eJ,eK,eM,eN,eO;if(en.$==1){ep=en.$0;eq=function(er){var es;er[0];er[1];er[2];es=er[3];return es;};et=ei.gameId;eu=et[0];ev=et[1];ew=d.choose(eq,ep);if(ew.$==0){ey={$:0};}else{ez=k.sum(ew);ey={$:1,$0:ez};}ex=ey;C.updateTotalMatched(eu,ev,ex);eA=function(eB){var eC,eD,eE,eF;eC=eB[0];eD=eB[1];eE=eB[2];eB[3];eF=function(eG){var eH,eI;eH=eG[0];eI=eG[1];return{selectionId:eI,runnerName:eH};};return{marketId:eC,marketName:eD,runners:d.map(eF,eE)};};eJ=d.map(eA,ep);eK=function(eL){return{$:1,$0:$.New(H,{gameId:eL.gameId,country:eL.country,markets:eJ})};};eM=ei.gameId;C.eventsCatalogue().UpdateBy(eK,eM);eo=n.Return(null);}else{eN=en.$0;eO=function(eP){var eQ;eQ="error of market catalog request : "+I.toSafe(eP);return J?J.log(eQ):undefined;};eO(eN);eo=n.Return(null);}return eo;});}return eh;});},processTotalMatched:function(){return n.Delay(function(){var eS,eU,eV,eW,eX,eY,eZ,e0,e1;eS=function(eT){return eT.game.gameId;};eU=o.Get(C.meetups().Var);eV=k.map(eS,eU);eW=k.toList(eV);if(eW.$==0){eX=n.Return(null);}else{eY=eW.$0;eZ=eY[0];e0=eY[1];e1=v.Async("WebFace:3",[eZ,e0]);eX=n.Bind(e1,function(e2){var e3,e4,e5,e6,e7,e8;if(e2.$==1){e4=e2.$0;e5=eY[0];e6=eY[1];C.updateTotalMatched(e5,e6,e4);e3=n.Return(null);}else{e7=e2.$0;e8=function(e9){var e_;e_="error of total matched request : "+I.toSafe(e9);return J?J.log(e_):undefined;};e8(e7);e3=n.Return(null);}return e3;});}return eX;});},renderMeetup:function(e$,fa,fb){var fc,fd,fe,ff,fg,fh,fi,fj,ft,fu,fv,fF,fG,fH,fI,fJ,fK,fU,fV,fW,f6;fc=[fa,o.Get(e$.gameInfo).playMinute,fb];if(fc[0]){if(fc[1].$==0){fe=c.get_Empty();}else{if(fc[2].$==1){fg=fc[2].$0;if(fg!==""?fg!==o.Get(e$.country):false){fc[2].$0;fh=c.get_Empty();}else{fi=e$.gameInfo.get_View();fj=function(fk){var fl,fn,fo,fp,fr,fs;fl=function(fm){return fm.$==1;};fn=d.ofArray([fk.drawBack,fk.drawLay,fk.winBack,fk.winLay,fk.loseBack,fk.loseLay]);if(k.exists(fl,fn)){fp=function(fq){return fq;};fr=C.renderMeetup1(e$,fb.$==1);fs=d.map(fp,fr);fo=c.Element("tr",[],fs);}else{fo=c.get_Empty();}return fo;};ft=q.Map(fj,fi);fh=c.EmbedView(ft);}ff=fh;}else{fu=e$.gameInfo.get_View();fv=function(fw){var fx,fz,fA,fB,fD,fE;fx=function(fy){return fy.$==1;};fz=d.ofArray([fw.drawBack,fw.drawLay,fw.winBack,fw.winLay,fw.loseBack,fw.loseLay]);if(k.exists(fx,fz)){fB=function(fC){return fC;};fD=C.renderMeetup1(e$,fb.$==1);fE=d.map(fB,fD);fA=c.Element("tr",[],fE);}else{fA=c.get_Empty();}return fA;};fF=q.Map(fv,fu);ff=c.EmbedView(fF);}fe=ff;}fd=fe;}else{if(fc[2].$==1){fH=fc[2].$0;if(fH!==""?fH!==o.Get(e$.country):false){fc[2].$0;fI=c.get_Empty();}else{fJ=e$.gameInfo.get_View();fK=function(fL){var fM,fO,fP,fQ,fS,fT;fM=function(fN){return fN.$==1;};fO=d.ofArray([fL.drawBack,fL.drawLay,fL.winBack,fL.winLay,fL.loseBack,fL.loseLay]);if(k.exists(fM,fO)){fQ=function(fR){return fR;};fS=C.renderMeetup1(e$,fb.$==1);fT=d.map(fQ,fS);fP=c.Element("tr",[],fT);}else{fP=c.get_Empty();}return fP;};fU=q.Map(fK,fJ);fI=c.EmbedView(fU);}fG=fI;}else{fV=e$.gameInfo.get_View();fW=function(fX){var fY,f0,f1,f2,f4,f5;fY=function(fZ){return fZ.$==1;};f0=d.ofArray([fX.drawBack,fX.drawLay,fX.winBack,fX.winLay,fX.loseBack,fX.loseLay]);if(k.exists(fY,f0)){f2=function(f3){return f3;};f4=C.renderMeetup1(e$,fb.$==1);f5=d.map(f2,f4);f1=c.Element("tr",[],f5);}else{f1=c.get_Empty();}return f1;};f6=q.Map(fW,fV);fG=c.EmbedView(f6);}fd=fG;}return fd;},renderMeetup1:function(f7,f8){var f9,gb,ge;f9=function(f_){var f$,ga;f$=f7.gameInfo.get_View();ga=q.Map(f_,f$);return c.TextView(ga);};gb=function(gc,gd){return c.Element("td",d.ofArray([j.Create("class",gc?"kef kef-back":"kef kef-lay")]),d.ofArray([f9(gd)]));};ge=function(gf){return F.formatDecimalOption(gf);};return k.toList(k.delay(function(){var gh;gh=d.ofArray([f9(function(gi){var gj,gk,gl;gj=gi.order;gk=gj[0];gl=gj[1];return $$.String(gk)+"."+$$.String(gl);})]);return k.append([c.Element("td",[],gh)],k.delay(function(){return k.append([c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(f7.game.home)]))],k.delay(function(){return k.append([c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([f9(function(go){return go.summary;})]))],k.delay(function(){return k.append([c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(f7.game.away)]))],k.delay(function(){return k.append([c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([f9(function(gr){return gr.status;})]))],k.delay(function(){var gt,gu,gz,gA;gu=function(gv){var gw,gx,gy;if(gv.$==1){gx=gv.$0;gy=s.PadLeft(gx.toFixed(2),2)+" GPB";gw=c.TextNode(gy);}else{gw=c.get_Empty();}return gw;};gz=f7.totalMatched.get_View();gA=q.Map(gu,gz);gt=d.ofArray([c.EmbedView(gA)]);return k.append([c.Element("td",[],gt)],k.delay(function(){return k.append([gb(true,function(gC){return ge(gC.winBack);})],k.delay(function(){return k.append([gb(false,function(gE){return ge(gE.winLay);})],k.delay(function(){return k.append([gb(true,function(gG){return ge(gG.drawBack);})],k.delay(function(){return k.append([gb(false,function(gI){return ge(gI.drawLay);})],k.delay(function(){return k.append([gb(true,function(gK){return ge(gK.loseBack);})],k.delay(function(){return k.append([gb(false,function(gM){return ge(gM.loseLay);})],k.delay(function(){var gO,gP,gQ;if(!f8){gQ=c.TextView(f7.country.get_View());gP=d.ofArray([c.Element("span",d.ofArray([j.Create("class","game-status")]),d.ofArray([gQ]))]);gO=[c.Element("td",[],gP)];}else{gO=k.empty();}return gO;}));}));}));}));}));}));}));}));}));}));}));}));}));},renderMeetups:function(){var gR,gS;gR=C.meetups().get_View();gS=function(gT){var gU,gZ,g3;gU=function(gV){var gW,gX,gY;gW=gV[0];gX=gV[1];gY=gV[2];return C.renderMeetup(gW,gX,gY);};q.get_Do();gZ=D.Bind(function(g0){return D.Bind(function(g1){return D.Bind(function(g2){return D.Const([g0,g1,g2]);},C.varSelectedCountry().get_View());},C.varInplayOnly().get_View());},gT);g3=q.Map(gU,gZ);return c.EmbedView(g3);};return c.ConvertSeq(gS,gR);},renderMenuCountries:function(){var g4,g7,hf;q.get_Do();g4=D.Bind(function(g5){return D.Bind(function(g6){return D.Const([g5,g6]);},C.varSelectedCountry().get_View());},C.viewCountries());g7=function(g8){var g9,g_,g$,ha,hc,hd,he;g9=g8[0];g_=g8[1];if(k.isEmpty(g9)){g$=c.get_Empty();}else{ha=function(hb){return C.renderMenuItemCountry(g_,hb);};hc=k.map(ha,g9);hd=c.Concat(hc);he=C.renderMenuItemAllCountries();g$=c.Append(he,hd);}return g$;};hf=q.Map(g7,g4);return c.EmbedView(hf);},renderMenuItemAllCountries:function(){var hg,hh,hr;hg=C.varSelectedCountry().get_View();hh=function(hi){return c.Element("a",k.toList(k.delay(function(){var hk,hl,hm;if(hi.$==1){hl=hi.$0;if(hl!==""){hi.$0;hm=k.empty();}else{hm=[j.Create("class","active")];}hk=hm;}else{hk=[j.Create("class","active")];}return k.append(hk,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:0});};})];}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u0441\u0442\u0440\u0430\u043d\u044b")]));};hr=q.Map(hh,hg);return c.EmbedView(hr);},renderMenuItemCountry:function(hs,ht){return c.Element("a",k.toList(k.delay(function(){var hv,hw,hx;if(hs.$==1){hw=hs.$0;if(hw===ht){hs.$0;hx=[j.Create("class","active")];}else{hx=k.empty();}hv=hx;}else{hv=k.empty();}return k.append(hv,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:1,$0:ht});};})];}));}));})),d.ofArray([c.TextNode(ht)]));},renderMenusInplay:function(){var hC,hD,hT;hC=C.varInplayOnly().get_View();hD=function(hE){var hF,hH,hS;hF=function(hG){return hG;};hH=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),true);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return hE?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),false);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return!hE?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);hS=d.map(hF,hH);return c.Concat(hS);};hT=q.Map(hD,hC);return c.EmbedView(hT);},tryGetCountry:function(hU,hV){var hW,hX,hY,hZ,h0,h1,h2;hW=[hU,hV];hX=hW[0];hY=hW[1];hZ=C.tryGetEvent(hX,hY);if(hZ.$==1){if(hZ.$0.country.$==1){h2=hZ.$0.country.$0;h1=h2;}else{h1="";}h0=h1;}else{h0="";}return h0;},tryGetEvent:function(h3,h4){var h5,h6,h9;h5=[h3,h4];h6=function(h7){var h8;h8=h7.gameId;return w.Equals(h5,h8);};h9=o.Get(C.eventsCatalogue().Var);return k.tryFind(h6,h9);},updateCoupon:function(h_,h$,ia){var ib,ic,id,ig,ih,ii,ij,il,io,ip;ib=h_.$==0;if(!ib){id=function(ie){var _if;_if="adding new games "+$$.String(ie);return J?J.log(_if):undefined;};ig=h_.get_Length();id(ig);ic=C.addNewGames(h_);}else{ic=null;}ih=k.isEmpty(ia);if(!ih){ij=function(ik){return C.meetups().RemoveByKey(ik);};k.iter(ij,ia);il=function(im){var _in;_in="removing out games "+$$.String(im);return J?J.log(_in):undefined;};io=k.length(ia);ii=il(io);}else{ii=null;}ip=function(iq){var ir,is,it,iu,iv,iw;ir=iq[0];is=iq[1];it=iq[2];iu=C.meetups().TryFindByKey(ir);if(iu.$==1){iw=iu.$0;o.Set(iw.gameInfo,is);iv=void(iw.hash=it);}else{iv=null;}return iv;};return k.iter(ip,h$);},updateTotalMatched:function(ix,iy,iz){var iA,iB,iC,iD;iA=[ix,iy];iB=C.meetups().TryFindByKey(iA);if(iB.$==1){iD=iB.$0;iC=o.Set(iD.totalMatched,iz);}else{iC=null;}return iC;},varDataRecived:$.Field(function(){return m.Create(false);}),varInplayOnly:$.Field(function(){return m.Create(true);}),varSelectedCountry:$.Field(function(){return m.Create({$:0});}),viewCountries:function(){var iE,iF;iE=q.get_Do();iF=C.eventsCatalogue().get_View();return D.Bind(function(iG){var iH,iJ,iK,iL;iH=function(iI){return[iI.gameId,iI];};iJ=k.map(iH,iG);iK=L.OfArray(k.toArray(iJ));iL=C.viewGames();return D.Bind(function(iM){var iN,iT,iU,iV,iX,iY,i0,i1;iN=function(iO){var iP,iQ,iS;iP=iO[0];iO[1];iQ=function(iR){return iR.country;};iS=iK.TryFind(iP.gameId);return p.map(iQ,iS);};iT=k.choose(iN,iM);iU={$:0};iV=function(iW){return!w.Equals(iU,iW);};iX=k.filter(iV,iT);iY=function(iZ){return iZ;};i0=k.choose(iY,iX);i1=t.distinct(i0);return D.Const(k.sort(i1));},iL);},iF);},viewGames:$.Field(function(){var i2,i3;i2=q.get_Do();i3=C.meetups().get_View();return D.Bind(function(i4){var i5,i6;if(k.isEmpty(i4)){i5=D.Const(k.empty());}else{i6=C.varInplayOnly().get_View();i5=D.Bind(function(i7){var i8,i_,jd,je;i8=function(i9){return!i7?true:o.Get(i9.gameInfo).playMinute.$==1;};i_=function(i$){var ja,jc;ja=function(jb){return[i$.game,jb];};jc=i$.gameInfo.get_View();return q.Map(ja,jc);};jd=k.filter(i8,i4);je=k.map(i_,jd);return D.Bind(function(jf){return D.Const(jf);},D.Sequence(je));},i6);}return i5;},i3);}),workloop:function(){return n.Delay(function(){return n.Combine(n.TryWith(n.Delay(function(){return n.Bind(C.processCoupon(),function(){return n.Bind(C.processEvents(),function(){return n.Bind(C.processMarkets(),function(){return n.Bind(C.processTotalMatched(),function(){o.Set(C.varDataRecived(),true);return n.Return(null);});});});});}),function(jm){var jn;jn=function(jo){var jp;jp="error updating coupon : "+I.prettyPrint(jo);return J?J.log(jp):undefined;};jn(jm);return n.Bind(n.Sleep(5000),function(){return n.Return(null);});}),n.Delay(function(){return C.workloop();}));});}},Utils:{LocalStorage:{checkTodayKey:function(js,jt){var ju,jv,jw,jx;ju=M.now();jv=G.getWithDef(js,ju);if(ju-jv>1*86400000){G.clear(jt);G.set(js,M.now());jx=function(jy){return function(jz){var jA;jA="local storage "+I.prettyPrint(jy)+" of "+I.prettyPrint(jz)+" is inspired";return J?J.log(jA):undefined;};};(jx(jt))(jv);jw=ju;}else{jw=jv;}return jw;},clear:function(jB){return G.strg().removeItem(jB);},get:function(jC){var jD,jE,jF,jG,jH;try{jE=G.strg().getItem(jC);jF=N.parse(jE);jD={$:1,$0:jF};}catch(jG){jH=function(jI){return function(jJ){var jK;jK="error getting from local storage, key "+I.prettyPrint(jI)+" : "+I.prettyPrint(jJ);return J?J.log(jK):undefined;};};(jH(jC))(jG);jD={$:0};}return jD;},getWithDef:function(jL,jM){var jN,jO,jP;jN=G.get(jL);if(jN.$==1){jP=jN.$0;jO=jP;}else{jO=jM;}return jO;},set:function(jQ,jR){var jS,jT,jU,jV;try{jT=N.stringify(jR);jS=G.strg().setItem(jQ,jT);}catch(jU){jV=function(jW){return function(jX){return function(jY){return O.FailWith("error setting to local storage, key "+I.prettyPrint(jW)+", value "+I.prettyPrint(jX)+" : "+I.prettyPrint(jY));};};};jS=((jV(jQ))(jR))(jU);}return jS;},strg:$.Field(function(){return P.localStorage;})},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(jZ){return F.trimEnd(jZ.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(j0){var j1,j2;if(j0.$==1){j2=j0.$0;j1=F.formatDecimal(j2);}else{j1="";}return j1;},getDatePart:function(j3){var j4;j4=new M(j3.getTime());j4.setHours(0,0,0,0);return j4;},mkids:function(j5,j6){var j7,j9,j_,j$,ka;j7=function(j8){return[j6(j8),j8];};j9=d.map(j7,j5);j_=L.OfArray(k.toArray(j9));j$=d.map(j6,j5);ka=Q.New1(R.OfSeq(j$));return[ka,j_];},trimEnd:function(kb,kc){var kd,ke,kf,kg,kh,ki,kj,kk,kl,km,kn,ko;kd=[kb,kc];if(kd[0]===""){ke="";}else{if(kd[1].$==1){kg=kd[0];kd[1];kh=kd[1].$0;if(kg.charCodeAt(kg.length-1)===kh){kd[1].$0;kj=kd[1];kk=kd[0];ki=F.trimEnd(S.string(kk,{$:0},{$:1,$0:kk.length-2}),kj);}else{if(kd[1].$==1){km=kd[0];kn=kd[1].$1;kl=F.trimEnd(km,kn);}else{kl=O.Raise(T.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}ki=kl;}kf=ki;}else{ko=kd[0];kf=ko;}ke=kf;}return ke;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe($$.WebSharper.Seq);l=$.Safe(b.Key);m=$.Safe(b.Var);n=$.Safe($$.WebSharper.Concurrency);o=$.Safe(b.Var1);p=$.Safe($$.WebSharper.Option);q=$.Safe(b.View);r=$.Safe(g.Level);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe(b.Storage1);y=$.Safe($$.WebSharper.Json);z=$.Safe(y.Provider);A=$.Safe(z.Id);B=$.Safe(b.ListModel);C=$.Safe(f.Coupon);D=$.Safe(b.View1);E=$.Safe(C.Meetup);F=$.Safe(f.Utils);G=$.Safe(F.LocalStorage);H=$.Safe(C.EventCatalogue);I=$.Safe($$.WebSharper.PrintfHelpers);J=$.Safe($$.console);K=$.Safe($$.WebSharper.Collections);L=$.Safe(K.MapModule);M=$.Safe($$.Date);N=$.Safe($$.JSON);O=$.Safe($$.WebSharper.Operators);P=$.Safe($$.window);Q=$.Safe(K.FSharpSet);R=$.Safe(K.BalancedTree);S=$.Safe($$.WebSharper.Slice);return T=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){G.strg();C.viewGames();C.varSelectedCountry();C.varInplayOnly();C.varDataRecived();C.meetups();C.eventsCatalogue();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
