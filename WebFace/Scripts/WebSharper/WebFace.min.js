(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;$.Define($$,{CentBet:{Client:{Admin:{Br:$.Field(function(){var H;H=$.New(e,{$:0});return(c.op_SpliceUntyped())(h.Element("br",[],H));}),Page:function(I){var J;J=i.Create(I);return h.EmbedView(j.Map(function(K){return h.Concat(d.append(K,d.ofArray([c.msgPart()])));},j.Map(function(L){return L?c.loginBetfairPart():c.loginAdminPart(function(){return k.Set(J,true);});},J.get_View())));},doc:function(N){return N;},loginAdminPart:function(O){var P,Q;P=i.Create("");Q=l.Delay(function(){var S,V,W,X;S=function(T){var U;U="authorize with "+m.prettyPrint(T);return n?n.log(U):undefined;};V=k.Get(P);S(V);W=c.varMsg();X={$:1,$0:[$.New(p,{$:1}),"logining admin.."]};k.Set(W,X);return l.Bind(r.Async("WebFace:2",[k.Get(P)]),function(Y){var Z;if(Y){(c.setInfo())("login admin : success");O(null);Z=l.Return(null);}else{(c.setError())("login admin : access denied");Z=l.Return(null);}return Z;});});return d.ofArray([(c.op_SpliceUntyped())(h.PasswordBox($.New(e,{$:0}),P)),c.submitButton("login admin",Q)]);},loginBetfairPart:function(){var _0,_1,_2;_0=i.Create("");_1=i.Create("");_2=l.Delay(function(){var _4;(c.setInfo())("logining betfair...");_4=r.Async("WebFace:0",[k.Get(_0),k.Get(_1)]);return l.Bind(_4,function(_5){var _6,_7,_8,_9,_;if(_5.$==1){_8=_5.$0;_7=[$.New(p,{$:3}),_8];}else{_7=[$.New(p,{$:1}),"successed!"];}_6=_7;_9={$:1,$0:_6};_=c.varMsg();k.Set(_,_9);return l.Return(null);});});return d.ofArray([h.TextNode("User"),(c.op_SpliceUntyped())(h.PasswordBox($.New(e,{$:0}),_0)),h.TextNode("Pass"),(c.op_SpliceUntyped())(h.PasswordBox($.New(e,{$:0}),_1)),c.submitButton("Login betfair",_2)]);},msgPart:$.Field(function(){var ba,bb,bk;ba=c.varMsg().get_View();bb=function(bc){var bd,be,bf,bg,bh,bi,bj;if(bc.$==1){be=bc.$0[1];bf=bc.$0[0];bg=(p.get_color())(bf);bh=bg[1];bi=bg[0];bj="background-color : "+m.toSafe(bi)+"; color : "+m.toSafe(bh)+";";bd=(c.op_SpliceUntyped())(h.Element("p",d.ofArray([s.Create("style",bj)]),d.ofArray([h.TextNode(be)])));}else{bd=h.get_Empty();}return bd;};bk=j.Map(bb,ba);return h.EmbedView(bk);}),op_SpliceUntyped:$.Field(function(){return function(bk){return c.doc(bk);};}),setError:$.Field(function(){var bl;bl=$.New(p,{$:3});return function(bm){return c.setMsg(bl,bm);};}),setInfo:$.Field(function(){var bn;bn=$.New(p,{$:1});return function(bo){return c.setMsg(bn,bo);};}),setMsg:function(bp,bq){var br,bs,bt;br=[bp,bq];bs={$:1,$0:br};bt=c.varMsg();return k.Set(bt,bs);},submitButton:function(bu,bv){var bw,bx,bA,bB,bG;bw=i.Create(false);bx=l.Delay(function(){k.Set(bw,true);return l.Bind(bv,function(){k.Set(bw,false);return l.Return(null);});});bA=bw.get_View();bB=function(bC){var bD;bD=t.toList(t.delay(function(){return bC?[s.Create("disabled","disabled")]:t.empty();}));return h.Button(bu,bD,function(){return l.Start(bx,{$:0});});};bG=j.Map(bB,bA);return h.EmbedView(bG);},varMsg:$.Field(function(){return i.Create({$:0});}),viewMsg:$.Field(function(){var bH,bI;bH=c.varMsg().get_View();bI=function(bJ){var bK,bL,bM,bN,bO,bP;if(bJ.$==1){bL=bJ.$0[1];bM=bJ.$0[0];bN=(p.get_color())(bM);bO=bN[1];bP=bN[0];bK=h.Element("p",d.ofArray([u.Style("color",bO),u.Style("background",bP)]),d.ofArray([h.TextNode(bL)]));}else{bK=h.get_Empty();}return bK;};return j.Map(bI,bH);})},Coupon:{Main:function(){var bQ,bV,bW,bX,b7,ce;bQ=l.Delay(function(){return l.While(function(){return true;},l.Delay(function(){return l.Bind(v.processCoupon(k.Get(v.varInplayOnly())),function(){return l.Return(null);});}));});l.Start(bQ,{$:0});bV=j.get_Do();bW=v.varInplayOnly().get_View();bX=w.Bind(function(bY){return w.Bind(function(bZ){var b0,b1,b2,b4,b5,b6;b0=t.isEmpty(bZ);b1=!b0;b2=function(b3){return x.inplay(b3);};b4=t.filter(b2,bZ);b5=t.isEmpty(b4);b6=!b5;return w.Const([b1,b6,bY]);},v.meetups().get_View());},bW);b7=function(b8){var b9,b_,b$,ca,cb,cc,cd;if(b8[0]){if(b8[1]){b$=d.ofArray([v.table()]);b_=h.Element("table",$.New(e,{$:0}),d.ofArray([h.Element("tbody",[],b$)]));}else{if(b8[2]){cb=d.ofArray([h.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);ca=h.Element("h1",[],cb);}else{cc=d.ofArray([v.table()]);ca=h.Element("table",$.New(e,{$:0}),d.ofArray([h.Element("tbody",[],cc)]));}b_=ca;}b9=b_;}else{cd=d.ofArray([h.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);b9=h.Element("h1",[],cd);}return b9;};ce=j.Map(b7,bX);return h.EmbedView(ce);},Meetup:$.Class({},{id:function(cf){return cf.game.gameId;},inplay:function(cg){return k.Get(cg.gameInfo).playMinute.$==1;},notinplay:function(ch){return k.Get(ch.gameInfo).playMinute.$==0;},viewGameInfo:function(ci){return ci.gameInfo.get_View();}}),Menu:function(){var cj,ck,cA;cj=v.varInplayOnly().get_View();ck=function(cl){var cm,co,cz;cm=function(cn){return cn;};co=d.ofArray([h.Element("a",t.toList(t.delay(function(){return t.append([s.Create("href","#")],t.delay(function(){return t.append([u.Handler("click",function(){return function(){return k.Set(v.varInplayOnly(),true);};})],t.delay(function(){return cl?[s.Create("class","active")]:t.empty();}));}));})),d.ofArray([h.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),h.Element("a",t.toList(t.delay(function(){return t.append([s.Create("href","#")],t.delay(function(){return t.append([u.Handler("click",function(){return function(){return k.Set(v.varInplayOnly(),false);};})],t.delay(function(){return!cl?[s.Create("class","active")]:t.empty();}));}));})),d.ofArray([h.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);cz=d.map(cm,co);return h.Concat(cz);};cA=j.Map(ck,cj);return h.EmbedView(cA);},MenuToday:function(){var cB,cC,cH;cB=v.varInplayOnly().get_View();cC=function(cD){return h.Element("li",t.toList(t.delay(function(){return!cD?[s.Create("class","active")]:t.empty();})),d.ofArray([h.Element("a",d.ofArray([s.Create("href","#"),u.Handler("click",function(){return function(){return k.Set(v.varInplayOnly(),false);};})]),d.ofArray([h.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};cH=j.Map(cC,cB);return h.EmbedView(cH);},addNewGames:function(cI){var cJ,cK,cL,cQ,cS,cU,cV,cW;cJ=k.Get(v.meetups().Var);cK=t.toList(cJ);v.meetups().Clear();cL=function(cM){var cN,cO,cP;cN=cM[0];cO=cM[1];cP=cM[2];return $.New(x,{game:cN,gameInfo:i.Create(cO),hash:cP});};cQ=function(cR){return k.Get(cR.gameInfo).order;};cS=function(cT){return v.meetups().Add(cT);};cU=d.map(cL,cI);cV=t.append(cK,cU);cW=t.sortBy(cQ,cV);return t.iter(cS,cW);},downloadCoupon:function(cX,cY){return r.Async("WebFace:1",[cY,cX]);},meetups:$.Field(function(){var cZ,c1;cZ=function(c0){return x.id(c0);};c1=$.New(e,{$:0});return y.Create(cZ,c1);}),processCoupon:function(c2){return l.Delay(function(){var c4,c6,c7,c8;c4=function(c5){return[c5.game.gameId,c5.hash];};c6=k.Get(v.meetups().Var);c7=t.map(c4,c6);c8=t.toList(c7);return l.Bind(v.downloadCoupon(c2,c8),function(c9){var c_,c$,da;c_=c9[1];c$=c9[2];da=c9[0];v.updateCoupon(da,c_,c$);return l.Return(null);});});},row:function(db,dc){var dd,de,dh,dk,_do,dq;if(dc?k.Get(db.gameInfo).playMinute.$==0:false){dd=h.get_Empty();}else{de=function(df){var dg;dg=d.ofArray([df]);return h.Element("td",[],dg);};dh=function(di){var dj;dj=d.ofArray([h.TextNode(di)]);return h.Element("td",[],dj);};dk=function(dl){var dm,dn;dm=db.gameInfo.get_View();dn=j.Map(dl,dm);return de(h.TextView(dn));};_do=function(dp){return o.formatDecimalOption(dp);};dq=$.New(e,{$:0});dd=h.Element("tr",dq,d.ofArray([dk(function(dr){var ds,dt,du;ds=dr.order;dt=ds[0];du=ds[1];return $$.String(dt)+"."+$$.String(du);}),dh(db.game.home),dh(db.game.away),dk(function(dv){return dv.status;}),dk(function(dw){return dw.summary;}),dk(function(dx){return _do(dx.winBack);}),dk(function(dy){return _do(dy.winLay);}),dk(function(dz){return _do(dz.drawBack);}),dk(function(dA){return _do(dA.drawLay);}),dk(function(dB){return _do(dB.loseBack);}),dk(function(dC){return _do(dC.loseLay);})]));}return dd;},table:function(){var dD,dE;dD=v.meetups().get_View();dE=function(dF){var dG,dK,dN;dG=function(dH){var dI,dJ;dI=dH[0];dJ=dH[1];return v.row(dI,dJ);};j.get_Do();dK=w.Bind(function(dL){return w.Bind(function(dM){return w.Const([dL,dM]);},v.varInplayOnly().get_View());},dF);dN=j.Map(dG,dK);return h.EmbedView(dN);};return h.ConvertSeq(dE,dD);},updateCoupon:function(dO,dP,dQ){var dR,dS,dT,dW,dX,dY,dZ,d1,d4,d5;dR=dO.$==0;if(!dR){dT=function(dU){var dV;dV="adding new games "+$$.String(dU);return n?n.log(dV):undefined;};dW=dO.get_Length();dT(dW);dS=v.addNewGames(dO);}else{dS=null;}dX=t.isEmpty(dQ);if(!dX){dZ=function(d0){return v.meetups().RemoveByKey(d0);};t.iter(dZ,dQ);d1=function(d2){var d3;d3="removing out games "+$$.String(d2);return n?n.log(d3):undefined;};d4=t.length(dQ);dY=d1(d4);}else{dY=null;}d5=function(d6){var d7,d8,d9,d_,d$,ea;d7=d6[0];d8=d6[1];d9=d6[2];d_=v.meetups().TryFindByKey(d7);if(d_.$==1){ea=d_.$0;k.Set(ea.gameInfo,d8);d$=void(ea.hash=d9);}else{d$=null;}return d$;};return t.iter(d5,dP);},varInplayOnly:$.Field(function(){return i.Create(true);})},Utils:{Level:$.Class({},{get_color:function(){return function(eb){return eb.$==3?["lightgrey","red"]:eb.$==2?["white","green"]:eb.$==4?["black","yellow"]:eb.$==0?["lightgrey","gray"]:["white","navy"];};}}),dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(ec){return o.trimEnd(ec.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(ed){var ee,ef;if(ed.$==1){ef=ed.$0;ee=o.formatDecimal(ef);}else{ee="";}return ee;},getDatePart:function(eg){var eh;eh=new z(eg.getTime());eh.setHours(0,0,0,0);return eh;},mkids:function(ei,ej){var ek,em,en,eo,ep;ek=function(el){return[ej(el),el];};em=d.map(ek,ei);en=B.OfArray(t.toArray(em));eo=d.map(ej,ei);ep=C.New1(D.OfSeq(eo));return[ep,en];},trimEnd:function(eq,er){var es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD;es=[eq,er];if(es[0]===""){et="";}else{if(es[1].$==1){ev=es[0];es[1];ew=es[1].$0;if(ev.charCodeAt(ev.length-1)===ew){es[1].$0;ey=es[1];ez=es[0];ex=o.trimEnd(E.string(ez,{$:0},{$:1,$0:ez.length-2}),ey);}else{if(es[1].$==1){eB=es[0];eC=es[1].$1;eA=o.trimEnd(eB,eC);}else{eA=F.Raise(G.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,22));}ex=eA;}eu=ex;}else{eD=es[0];eu=eD;}et=eu;}return et;}}}}});$.OnInit(function(){a=$.Safe($$.CentBet);b=$.Safe(a.Client);c=$.Safe(b.Admin);d=$.Safe($$.WebSharper.List);e=$.Safe(d.T);f=$.Safe($$.WebSharper.UI);g=$.Safe(f.Next);h=$.Safe(g.Doc);i=$.Safe(g.Var);j=$.Safe(g.View);k=$.Safe(g.Var1);l=$.Safe($$.WebSharper.Concurrency);m=$.Safe($$.WebSharper.PrintfHelpers);n=$.Safe($$.console);o=$.Safe(b.Utils);p=$.Safe(o.Level);q=$.Safe($$.WebSharper.Remoting);r=$.Safe(q.AjaxRemotingProvider);s=$.Safe(g.AttrProxy);t=$.Safe($$.WebSharper.Seq);u=$.Safe(g.AttrModule);v=$.Safe(b.Coupon);w=$.Safe(g.View1);x=$.Safe(v.Meetup);y=$.Safe(g.ListModel);z=$.Safe($$.Date);A=$.Safe($$.WebSharper.Collections);B=$.Safe(A.MapModule);C=$.Safe(A.FSharpSet);D=$.Safe(A.BalancedTree);E=$.Safe($$.WebSharper.Slice);F=$.Safe($$.WebSharper.Operators);return G=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){v.varInplayOnly();v.meetups();c.viewMsg();c.varMsg();c.setInfo();c.setError();c.op_SpliceUntyped();c.msgPart();c.Br();return;});}());
