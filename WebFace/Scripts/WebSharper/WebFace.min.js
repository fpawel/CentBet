(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;$.Define($$,{CentBet:{Client:{Admin:{RecordType:$.Class({},{get_color:function(){return function(Y){return Y.$==1?["lightgrey","red"]:Y.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var Z;Z=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],Z)),g.RenderRecords()]));},RenderCommandPrompt:function(){var _0;_0=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(_0);},RenderRecords:function(){var _1,_5;_1=function(_2){var _3,_4;_4=$.New(h,{$:0});_3=d.ofArray([(g.renderRecord())(_2),(g.op_SpliceUntyped())(c.Element("br",[],_4))]);return c.Concat(_3);};_5=g.varConsole().get_View();return c.ConvertSeq(_1,_5);},addRecord:function(_6,_7){return g.varConsole().Add({Id:k.Fresh(),Text:_7,RecordType:_6});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(_8){return _8.Id;},doc:function(_9){return _9;},op_SpliceUntyped:$.Field(function(){return function(_){return g.doc(_);};}),recordKey:function(ba){return ba.Id;},renderInput:function(){var ba,bb,bc,bd,bg,bj,bn,bo,bE;ba=l.Create("");bb=l.Create(null);bc=l.Create(false);bd=m.Delay(function(){n.Set(bc,true);return m.Bind(g.send(n.Get(ba)),function(){n.Set(bc,false);n.Set(ba,"");return m.Return(null);});});bg=function(bh){var bi;bi={$:1,$0:bh};g.varCmd=function(){return bi;};return n.Set(ba,bh.Text);};bj=function(bk){var bl,bm;bl=g.tryGetCommandFromHistory(bk);bm=o.map(bg,bl);return;};bn=bc.get_View();bo=function(bp){var bq;bq=d.ofArray([c.Input(p.toList(p.delay(function(){return p.append([j.Create("id",g["cmd-input"]())],p.delay(function(){return p.append(bp?[j.Create("disabled","disabled")]:p.empty(),p.delay(function(){return p.append([i.Style("width","80%")],p.delay(function(){return p.append([i.CustomVar(bb,function(bv){return function(){return bv.focus();};},function(){return{$:0};})],p.delay(function(){return[i.Handler("keydown",function(){return function(bA){var bB,bC,bD;bB=bA.keyCode;if(bB===13){bD=n.Get(ba).toLowerCase();bC=bD==="-clear-output"?g.varConsole().Clear():bD==="-clear-hist"?g.varCommandsHistory().Clear():m.Start(bd,{$:0});}else{bC=bB===38?bj(true):bB===40?bj(false):null;}return bC;};})];}));}));}));}));})),ba)]);return c.Concat(bq);};bE=q.Map(bo,bn);return c.EmbedView(bE);},renderRecord:$.Field(function(){var bF;bF=function(bG){var bH,bI,bJ,bK,bL;try{bI=(r.get_color())(bG.RecordType);bJ=bI[1];bK=bI[0];bH=(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bJ),i.Style("background",bK)]),d.ofArray([c.TextNode(bG.Text)])));}catch(bL){g.varCommandsHistory().Clear();g.varConsole().Clear();bH=c.get_Empty();}return bH;};return function(bM){var bN;bN=q.Map(bF,bM);return c.EmbedView(bN);};}),send:function(bO){return m.Delay(function(){var bQ,bR,bS,bT,bU,bV;bQ=s.Trim(bO);g.addRecord($.New(r,{$:2}),bQ);bS=n.Get(g.varCommandsHistory().Var);if(p.isEmpty(bS)){bT=true;}else{bU=t.last(bS);bT=bU.Text!==bQ;}if(bT){g.varCommandsHistory().Add({Id:k.Fresh(),Text:bQ});bV=m.Return(null);}else{bV=m.Return(null);}bR=bV;return m.Combine(bR,m.Delay(function(){return m.TryWith(m.Delay(function(){var bY;bY=v.Async("WebFace:1",[bQ]);return m.Bind(bY,function(bZ){var b0,b1,b2;if(bZ.$==1){b1=bZ.$0;g.addRecord($.New(r,{$:1}),b1);b0=m.Return(null);}else{b2=bZ.$0;g.addRecord($.New(r,{$:0}),b2);b0=m.Return(null);}return b0;});}),function(b3){g.addRecord($.New(r,{$:1}),b3.message);return m.Return(null);});}));});},tryGetCommandFromHistory:function(b4){var b5,b6,b7,b8,b9,b_,b$,cc,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE;b5=n.Get(g.varCommandsHistory().Var);b6=p.length(b5);if(b6===0){b7={$:0};}else{if(g.varCmd().$==1){b_=g.varCmd().$0.Id;b$=function(ca){return function(cb){return[cb,ca];};};cc=function(cd){var ce,cf;ce=cd[0];cd[1];cf=ce.Id;return w.Equals(cf,b_);};cg=n.Get(g.varCommandsHistory().Var);ch=p.mapi(b$,cg);ci=p.tryFind(cc,ch);cj=[ci,b4];if(cj[0].$==1){if(cj[1]){cj[0].$0[0];cm=cj[0].$0[1];if(b6>0?cm<b6-1:false){co=cj[0].$0[1];cj[0].$0[0];cn=co+1;}else{if(cj[0].$==1){if(cj[1]){cq=cj[1]?b6-1:0;}else{cj[0].$0[0];cr=cj[0].$0[1];if(b6>0?cr>0:false){ct=cj[0].$0[1];cj[0].$0[0];cs=ct-1;}else{cs=cj[1]?b6-1:0;}cq=cs;}cp=cq;}else{cp=cj[1]?b6-1:0;}cn=cp;}cl=cn;}else{if(cj[0].$==1){if(cj[1]){cv=cj[1]?b6-1:0;}else{cj[0].$0[0];cw=cj[0].$0[1];if(b6>0?cw>0:false){cy=cj[0].$0[1];cj[0].$0[0];cx=cy-1;}else{cx=cj[1]?b6-1:0;}cv=cx;}cu=cv;}else{cu=cj[1]?b6-1:0;}cl=cu;}ck=cl;}else{if(cj[0].$==1){if(cj[1]){cA=cj[1]?b6-1:0;}else{cj[0].$0[0];cB=cj[0].$0[1];if(b6>0?cB>0:false){cD=cj[0].$0[1];cj[0].$0[0];cC=cD-1;}else{cC=cj[1]?b6-1:0;}cA=cC;}cz=cA;}else{cz=cj[1]?b6-1:0;}ck=cz;}b9=ck;}else{b9=b6-1;}b8=b9;cE=p.nth(b8,b5);b7={$:1,$0:cE};}return b7;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cF,cG,cH,cK,cM,cN,cO,cS,cT,cX,cZ;try{cH=function(cI){var cJ;cJ="restoring list - "+x.prettyPrint(cI);return y?y.log(cJ):undefined;};cH("CentBetConsoleCommandsHistory");cK=function(cL){return g.cmdKey(cL);};cM=z.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))()});cN=D.CreateWithStorage(cK,cM);cO=function(cP){return function(cQ){var cR;cR=x.prettyPrint(cP)+" - "+$$.String(cQ);return y?y.log(cR):undefined;};};(cO("CentBetConsoleCommandsHistory"))(cN.get_Length());cG=cN;}catch(cS){cT=function(cU){return function(cV){var cW;cW="error when restoring "+x.prettyPrint(cU)+" - "+x.prettyPrint(cV);return y?y.log(cW):undefined;};};(cT("CentBetConsoleCommandsHistory"))(cS);cX=function(cY){return g.cmdKey(cY);};cZ=$.New(h,{$:0});cG=D.Create(cX,cZ);}cF=cG;return cF;}),varConsole:$.Field(function(){var c0,c1,c2,c5,c7,c8,c9,db,dc,dg,di;try{c2=function(c3){var c4;c4="restoring list - "+x.prettyPrint(c3);return y?y.log(c4):undefined;};c2("CentBetConsole");c5=function(c6){return g.recordKey(c6);};c7=z.LocalStorage("CentBetConsole",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["RecordType",B.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(k,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["RecordType",B.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});c8=D.CreateWithStorage(c5,c7);c9=function(c_){return function(c$){var da;da=x.prettyPrint(c_)+" - "+$$.String(c$);return y?y.log(da):undefined;};};(c9("CentBetConsole"))(c8.get_Length());c1=c8;}catch(db){dc=function(dd){return function(de){var df;df="error when restoring "+x.prettyPrint(dd)+" - "+x.prettyPrint(de);return y?y.log(df):undefined;};};(dc("CentBetConsole"))(db);dg=function(dh){return g.recordKey(dh);};di=$.New(h,{$:0});c1=D.Create(dg,di);}c0=c1;return c0;})},Coupon:{EventCatalogue:$.Class({},{id:function(dj){return dj.gameId;}}),Meetup:$.Class({},{id:function(dk){return dk.game.gameId;}}),PageLen:{get:function(){return F.validateValue(n.Get(F["var"]()));},localStorageKey:$.Field(function(){return"pageLen";}),set:function(dl){var dm,dn;dm=F.validateValue(dl);if(dm!==n.Get(F["var"]())){n.Set(F["var"](),dm);dn=H.set(F.localStorageKey(),dm);}else{dn=null;}return dn;},validateValue:function(_do){return _do<10?30:_do>40?40:_do;},"var":$.Field(function(){var dp,dq;dp=H.getWithDef(F.localStorageKey(),30);dq=F.validateValue(dp);return l.Create(dq);}),view:$.Field(function(){return F["var"]().get_View();})},Render:function(){var dr,ds,dt,du,dv,dx,dy,dz,dA,dB,dD,dE,dF,dG,dH,dJ,dK,dL,dM,dN,dP,dQ,dR,dS,dT,dV,dZ,d0;dr=["COUPON",0,0];ds=dr[0];dt=dr[1];du=dr[2];dv=function(){return E.processCoupon();};I["new"](ds,dt,du,dv);dx=["CHECK-SERVER-BETFAIRS-SESSION",0,0];dy=dx[0];dz=dx[1];dA=dx[2];dB=function(){return J.check();};I["new"](dy,dz,dA,dB);dD=["EVENTS-CATALOGUE",0,0];dE=dD[0];dF=dD[1];dG=dD[2];dH=function(){return E.processEvents();};I["new"](dE,dF,dG,dH);dJ=["MARKETS-CATALOGUE",0,0];dK=dJ[0];dL=dJ[1];dM=dJ[2];dN=function(){return E.processMarkets();};I["new"](dK,dL,dM,dN);dP=["TOTAL-MATCHED",0,0];dQ=dP[0];dR=dP[1];dS=dP[2];dT=function(){return E.processTotalMatched();};I["new"](dQ,dR,dS,dT);dV=function(dW){var dX,dY;if(dW){dX=E["render\u0421oupon"]();}else{dY=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);dX=c.Element("h1",[],dY);}return dX;};dZ=E.varDataRecived().get_View();d0=q.Map(dV,dZ);return c.EmbedView(d0);},ServerBetfairsSession:{check:function(){return m.Delay(function(){return m.Bind(v.Async("WebFace:2",[]),function(d2){J.hasServerBetfairsSession=function(){return d2;};return m.Return(null);});});},has:function(){return J.hasServerBetfairsSession();},hasNot:function(){return!J.hasServerBetfairsSession();},hasServerBetfairsSession:$.Field(function(){return true;})},SettingsDialog:{buttonDoc:function(d3){var d4,d5,d9;d4=F.view();d5=function(d6){var d7,d8;if((d3?d6===40:false)?true:!d3?d6===10:false){d7=c.get_Empty();}else{d8=K.buttonElt(d3,d6);d7=E.doc(d8);}return d7;};d9=q.Map(d5,d4);return c.EmbedView(d9);},buttonElt:function(d_,d$){var ei;ei=d_?"+":"-";return c.Element("button",d.ofArray([K.op_SpliceUntyped("w3-btn w3-teal"),j.Create("style","margin: 10px; width: 50px; height: 50px;"),i.Handler("click",function(){return function(){var ec,ed,ee,ef,eg,eh;ec=[d_,d$];if(ec[0]){if(ec[1]===40){ee=null;}else{ef=d$+(d_?1:-1);ee=F.set(ef);}ed=ee;}else{if(ec[1]===10){eg=null;}else{eh=d$+(d_?1:-1);eg=F.set(eh);}ed=eg;}return ed;};})]),d.ofArray([c.TextNode(ei)]));},"id'":$.Field(function(){return"id-settings-dialog";}),op_SpliceUntyped:function(ej){return j.Create("class",ej);},render:$.Field(function(){var ek,el,em,en,eo,ep,er;ek=d.ofArray([K.op_SpliceUntyped("w3-modal"),j.Create("id",K["id'"]())]);el=d.ofArray([K.op_SpliceUntyped("w3-modal-content w3-animate-zoom w3-card-8")]);em=d.ofArray([K.op_SpliceUntyped("w3-container w3-teal")]);en="document.getElementById('"+x.toSafe(K["id'"]())+"').style.display='none'";eo=d.ofArray([c.TextNode("\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0430\u0442\u0447\u0435\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435")]);ep=function(eq){return $$.String(eq);};er=F.view();return c.Element("div",ek,d.ofArray([c.Element("div",el,d.ofArray([c.Element("header",em,d.ofArray([c.Element("span",d.ofArray([K.op_SpliceUntyped("w3-closebtn"),j.Create("onclick",en)]),d.ofArray([c.TextNode("×")])),c.Element("h2",[],eo)])),c.Element("div",d.ofArray([K.op_SpliceUntyped("w3-xxlarge"),j.Create("style","margin : 10px; float : left;")]),d.ofArray([c.TextView(q.Map(ep,er))])),K.buttonDoc(true),K.buttonDoc(false)]))]));})},Work:$.Class({},{loop:function(es){return m.Delay(function(){var eu;eu=m.Delay(function(){return m.Bind(es.work.call(null,null),function(){return m.Bind(m.Sleep(es.sleepInterval),function(){return m.Return(null);});});});return m.Combine(m.TryWith(eu,function(ey){var ez,eD;ez=function(eA){return function(eB){var eC;eC="task error "+x.prettyPrint(eA)+" : "+x.prettyPrint(eB);return y?y.log(eC):undefined;};};eD=es.what;(ez(eD))(ey);return m.Bind(m.Sleep(es.sleepErrorInterval),function(){return m.Return(null);});}),m.Delay(function(){return I.loop(es);}));});},"new":function(eG,eH,eI,eJ){var eK;eK=$.New(I,{what:eG,sleepInterval:eH,sleepErrorInterval:eI,work:eJ});return I.run(eK);},run:function(eL){var eM;eM=m.Delay(function(){var eO,eR;eO=function(eP){var eQ;eQ="task "+x.prettyPrint(eP)+" : started";return y?y.log(eQ):undefined;};eR=eL.what;eO(eR);return m.Bind(I.loop(eL),function(){var eT,eW;eT=function(eU){var eV;eV="task "+x.prettyPrint(eU)+" : terminated";return y?y.log(eV):undefined;};eW=eL.what;eT(eW);return m.Return(null);});});return m.Start(eM,{$:0});}}),addNewGames:function(eX){var eY,eZ,e0,fl,fn,fp,fq,fr;eY=n.Get(E.meetups().Var);eZ=p.toList(eY);E.meetups().Clear();e0=function(e1){var e2,e3,e4,e5,e6,e7,e8,e9,e_,e$,fa,fb,fc,fd,fe,ff,fg,fh,fi,fj,fk;e2=e1[0];e3=e1[1];e4=e1[2];e5=e2.gameId;e6=e5[0];e7=e5[1];e8=E.tryGetCountry(e6,e7);e9=l.Create(e3.playMinute);e_=l.Create(e3.status);e$=l.Create(e3.summary);fa=l.Create(e3.order);fb=l.Create(e3.winBack);fc=l.Create(e3.winLay);fd=l.Create(e3.drawBack);fe=l.Create(e3.drawLay);ff=l.Create(e3.loseBack);fg=l.Create(e3.loseLay);fh=e2.gameId;fi=fh[0];fj=fh[1];fk=E.getLastTotakMatched(fi,fj);return $.New(L,{game:e2,playMinute:e9,status:e_,summary:e$,order:fa,winBack:fb,winLay:fc,drawBack:fd,drawLay:fe,loseBack:ff,loseLay:fg,country:l.Create(e8),totalMatched:l.Create(fk),hash:e4});};fl=function(fm){return n.Get(fm.order);};fn=function(fo){return E.meetups().Add(fo);};fp=d.map(e0,eX);fq=p.append(eZ,fp);fr=p.sortBy(fl,fq);return p.iter(fn,fr);},doc:function(fs){return fs;},eventsCatalogue:$.Field(function(){var ft,fu,fv,fw,fy,fz,fA,fB,fF,fH,fI;ft=H.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");try{fw=function(fx){return M.id(fx);};fz=(B.get_Default().EncodeRecord(M,[["gameId",B.get_Default().EncodeTuple([C,C]),0],["country",C,1],["markets",B.get_Default().EncodeList(B.get_Default().EncodeRecord(undefined,[["marketId",C,0],["marketName",C,0],["totalMatched",C,1],["runners",B.get_Default().EncodeList(B.get_Default().EncodeRecord(undefined,[["selectionId",C,0],["runnerName",C,0]])),0]])),0]]))();fy=z.LocalStorage("CentBetEventsCatalogue",{Encode:fz,Decode:(B.get_Default().DecodeRecord(M,[["gameId",B.get_Default().DecodeTuple([C,C]),0],["country",C,1],["markets",B.get_Default().DecodeList(B.get_Default().DecodeRecord(undefined,[["marketId",C,0],["marketName",C,0],["totalMatched",C,1],["runners",B.get_Default().DecodeList(B.get_Default().DecodeRecord(undefined,[["selectionId",C,0],["runnerName",C,0]])),0]])),0]]))()});fv=D.CreateWithStorage(fw,fy);}catch(fA){fB=function(fC){return function(fD){var fE;fE="error when restoring "+x.prettyPrint(fC)+" - "+x.prettyPrint(fD);return y?y.log(fE):undefined;};};(fB("CentBetEventsCatalogue"))(fA);fF=function(fG){return M.id(fG);};fH=$.New(h,{$:0});fv=D.Create(fF,fH);}fu=fv;fI=function(fJ){return function(fK){return function(fL){var fM;fM=x.prettyPrint(fJ)+" - "+$$.String(fK)+", "+x.prettyPrint(fL);return y?y.log(fM):undefined;};};};((fI("CentBetEventsCatalogue"))(fu.get_Length()))(ft);return fu;}),getGamesEvents:function(){var fN,fO,fS,fT;fN=n.Get(E.eventsCatalogue().Var);fO=function(fP){var fQ;fQ=function(fR){return w.Equals(fR.gameId,fP.game.gameId);};return[fP.game.gameId,p.tryFind(fQ,fN)];};fS=n.Get(E.meetups().Var);fT=p.map(fO,fS);return p.toList(fT);},getLastTotakMatched:function(fU,fV){var fW,fX,f5;fW=[fU,fV];fX=function(fY){var fZ,f1,f2,f3,f4;fZ=function(f0){return f0.totalMatched;};f1=fY.markets;f2=d.choose(fZ,f1);if(f2.$==0){f3={$:0};}else{f4=p.sum(f2);f3={$:1,$0:f4};}return f3;};f5=E.eventsCatalogue().TryFindByKey(fW);return o.bind(fX,f5);},meetups:$.Field(function(){var f6,f8;f6=function(f7){return L.id(f7);};f8=$.New(h,{$:0});return D.Create(f6,f8);}),processCoupon:function(){return m.Delay(function(){var f_,ga,gb,gc,gd,ge;f_=function(f$){return[f$.game.gameId,f$.hash];};ga=n.Get(E.meetups().Var);gb=p.map(f_,ga);gc=p.toList(gb);gd=F.get();ge=v.Async("WebFace:0",[gc,n.Get(E.varCurrentPageNumber()),gd]);return m.Bind(ge,function(gf){var gg,gh,gi,gj,gk,gl,gm;gg=gf[1];gh=gf[2];gi=gf[0];gj=gf[3];gk=(gj/gd>>0)+(gj%gd===0?0:1);if(n.Get(E.varPagesCount())!==gk){n.Set(E.varPagesCount(),gk);gm=m.Return(null);}else{gm=m.Return(null);}gl=gm;return m.Combine(gl,m.Delay(function(){var go,gp;if(n.Get(E.varCurrentPageNumber())>gk){n.Set(E.varCurrentPageNumber(),0);gp=m.Return(null);}else{gp=m.Return(null);}go=gp;return m.Combine(go,m.Delay(function(){var gr;if(!n.Get(E.varDataRecived())){n.Set(E.varDataRecived(),true);gr=m.Return(null);}else{gr=m.Return(null);}return m.Combine(gr,m.Delay(function(){E.updateCoupon(gi,gg,gh);return m.Return(null);}));}));}));});});},processEvents:function(){return m.Delay(function(){var gu,gy,gz,gA,gB;E.updateColumnCountryVisible();gu=function(gv){var gw,gx;if(gv[1].$==0){gx=gv[0];gw={$:1,$0:gx};}else{gw={$:0};}return gw;};gy=E.getGamesEvents();gz=d.choose(gu,gy);if(gz.$==0?true:J.hasNot()){gA=m.Return(null);}else{gB=v.Async("WebFace:3",[gz]);gA=m.Bind(gB,function(gC){var gD;gD=m.For(gC,function(gE){var gF,gG;gE[1];gF=gE[0];gG=gE[2];E.eventsCatalogue().Add($.New(M,{gameId:gF,country:gG,markets:$.New(h,{$:0})}));return m.Return(null);});return m.Combine(gD,m.Delay(function(){return m.For(n.Get(E.meetups().Var),function(gI){var gJ,gK,gL;gJ=gI.game.gameId;gK=gJ[0];gL=gJ[1];n.Set(gI.country,E.tryGetCountry(gK,gL));return m.Return(null);});}));});}return gA;});},processMarkets:function(){return m.Delay(function(){var gN,gS,gT;gN=function(gO){var gP,gQ,gR;if(gO[1].$==1){if(gO[1].$0.markets.$==0){gR=gO[0];gQ={$:1,$0:gR};}else{gQ={$:0};}gP=gQ;}else{gP={$:0};}return gP;};gS=E.getGamesEvents();gT=d.choose(gN,gS);return(gT.$==0?true:J.hasNot())?m.Return(null):m.For(gT,function(gU){var gV,gW;gV=gU[0];gW=gU[1];return m.Bind(v.Async("WebFace:4",[gV,gW]),function(gX){var gY,gZ,g0,g1;if(gX.$==1){gZ=gX.$0;g0=gU[0];g1=gU[1];E.setMarket(g0,g1,gZ);gY=m.Return(null);}else{gY=m.Return(null);}return gY;});});});},processTotalMatched:function(){return m.Delay(function(){var g3,g8,g9;E.updateColumnGpbVisible();g3=function(g4){var g5,g6,g7;if(g4[1].$==1){if(g4[1].$0.markets.$==1){g7=g4[0];g6={$:1,$0:g7};}else{g6={$:0};}g5=g6;}else{g5={$:0};}return g5;};g8=E.getGamesEvents();g9=d.choose(g3,g8);return(g9.$==0?true:J.hasNot())?m.Return(null):m.For(g9,function(g_){var g$,ha,hb;g$=g_[0];ha=g_[1];hb=v.Async("WebFace:5",[g$,ha]);return m.Bind(hb,function(hc){var hd,he,hi,hj,hk;if(hc.get_IsEmpty()){hd=m.Return(null);}else{he=function(hf){return function(){return function(hh){return hf+hh;};};};hi=g_[0];hj=g_[1];hk=O.Fold(he,0,hc);E.updateTotalMatched(hi,hj,hk);hd=m.Return(null);}return hd;});});});},renderGamesHeaderRow:$.Field(function(){return p.toList(p.delay(function(){var hm,hn,ho,hp,hq,hr;hn=d.ofArray([c.TextNode("\u2116")]);ho=d.ofArray([c.TextNode("\u0414\u043e\u043c\u0430")]);hp=$.New(h,{$:0});hq=d.ofArray([c.TextNode("\u0412 \u0433\u043e\u0441\u0442\u044f\u0445")]);hr=$.New(h,{$:0});hm=d.ofArray([c.Element("th",[],hn),c.Element("th",[],ho),c.Element("th",[],hp),c.Element("th",[],hq),c.Element("th",[],hr),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041f\u043e\u0431\u0435\u0434\u0430")])),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041d\u0438\u0447\u044c\u044f")])),c.Element("th",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435")]))]);return p.append(d.map(function(hs){return E.doc(hs);},hm),p.delay(function(){var hu,hz,hA;hu=function(hv){var hw,hx,hy;if(hv){hx=d.ofArray([c.TextNode("GPB")]);hy=c.Element("th",[],hx);hw=E.doc(hy);}else{hw=c.get_Empty();}return hw;};hz=E.varColumnGpbVisible().get_View();hA=q.Map(hu,hz);return p.append([c.EmbedView(hA)],p.delay(function(){var hC,hD;hC=$.New(h,{$:0});hD=c.Element("th",[],hC);return[E.doc(hD)];}));}));}));}),renderMeetup:function(hE){var hF,hN,hO,hP,hQ,hR,hV,hW,hX,hY,hZ,h0,h1,ie,_if,ig,ij,is,it,iw,iA;hF=function(hG){return function(hH){var hI,hJ,hL,hM;hJ=function(hK){return G.formatDecimalOption(hK);};hL=hH.get_View();hM=q.Map(hJ,hL);hI=c.Element("td",d.ofArray([j.Create("class",hG?"kef kef-back":"kef kef-lay")]),d.ofArray([c.TextView(hM)]));return E.doc(hI);};};hN=hF(true);hO=hF(false);hR=function(hS){var hT,hU;hT=hS[0];hU=hS[1];return $$.String(hT)+"."+$$.String(hU);};hV=hE.order.get_View();hW=q.Map(hR,hV);hQ=d.ofArray([c.TextView(hW)]);hX=c.Element("td",[],hQ);hY=c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(hE.game.home)]));hZ=q.get_Do();h0=hE.playMinute.get_View();h1=P.Bind(function(h2){var h3;h3=hE.summary.get_View();return P.Bind(function(h4){var h5,h6,h7,h8,h9,h_,h$,ia,ib,ic,id;if(h2.$==1){if(h4!==""){h7=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(h4)]));h6=E.doc(h7);}else{if(h4!==""){h9=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(h4)]));h8=E.doc(h9);}else{h_=$.New(h,{$:0});h$=c.Element("td",[],h_);h8=E.doc(h$);}h6=h8;}h5=h6;}else{if(h4!==""){ib=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(h4)]));ia=E.doc(ib);}else{ic=$.New(h,{$:0});id=c.Element("td",[],ic);ia=E.doc(id);}h5=ia;}return P.Const(h5);},h3);},h0);ie=c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(hE.game.away)]));_if=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextView(hE.status.get_View())]));q.get_Do();ig=P.Bind(function(ih){return P.Bind(function(ii){return P.Const([ih,ii]);},E.varColumnGpbVisible().get_View());},hE.totalMatched.get_View());ij=function(ik){var il,im,_in,io,ip,iq,ir;if(ik[1]){if(ik[0].$==1){_in=ik[0].$0;ip=$$.String(_in);io=c.Element("td",d.ofArray([j.Create("class","game-gpb")]),d.ofArray([c.TextNode(ip)]));im=E.doc(io);}else{iq=$.New(h,{$:0});ir=c.Element("td",[],iq);im=E.doc(ir);}il=im;}else{il=c.get_Empty();}return il;};is=q.Map(ij,ig);q.get_Do();it=P.Bind(function(iu){return P.Bind(function(iv){return P.Const([iu,iv]);},E.varColumnCountryVisible().get_View());},hE.country.get_View());iw=function(ix){var iy,iz;if(ix[1]){ix[0];iz=c.Element("td",d.ofArray([j.Create("class","game-country")]),d.ofArray([c.TextView(hE.country.get_View())]));iy=E.doc(iz);}else{iy=c.get_Empty();}return iy;};iA=q.Map(iw,it);hP=d.ofArray([E.doc(hX),E.doc(hY),c.EmbedView(h1),E.doc(ie),E.doc(_if),hN(hE.winBack),hO(hE.winLay),hN(hE.drawBack),hO(hE.drawLay),hN(hE.loseBack),hO(hE.loseLay),c.EmbedView(is),c.EmbedView(iA)]);return c.Element("tr",[],hP);},renderPagination:$.Field(function(){var iB,iC,iD;iB=q.get_Do();iC=E.varPagesCount().get_View();iD=P.Bind(function(iE){var iF;iF=E.varCurrentPageNumber().get_View();return P.Bind(function(iG){var iH,iI,iJ,iW;iH="document.getElementById('"+x.toSafe(K["id'"]())+"').style.display='block'";iI=j.Create("onclick",iH);iJ=p.toList(p.delay(function(){return p.append(p.map(function(iL){var iM,iS,iT;iM=p.toList(p.delay(function(){return p.append([j.Create("href","#")],p.delay(function(){return p.append([i.Handler("click",function(){return function(){return n.Set(E.varCurrentPageNumber(),iL);};})],p.delay(function(){return iL===iG?[j.Create("class","w3-green")]:p.empty();}));}));}));iT=$$.String(iL+1);iS=d.ofArray([c.Element("a",iM,d.ofArray([c.TextNode(iT)]))]);return c.Element("li",[],iS);},Q.range(0,iE-1)),p.delay(function(){var iV;iV=d.ofArray([c.Element("a",d.ofArray([j.Create("href","#"),iI]),d.ofArray([c.TextNode("...")]))]);return[c.Element("li",[],iV)];}));}));iW=d.map(function(iX){return E.doc(iX);},iJ);return P.Const(c.Concat(iW));},iF);},iC);return c.EmbedView(iD);}),"render\u0421oupon":$.Field(function(){var iY,iZ,i0,i1,i2,i3,i6,i9,i_;iY=d.ofArray([j.Create("class","w3-container")]);iZ=d.ofArray([j.Create("class","w3-responsive")]);i0=d.ofArray([j.Create("class","w3-table w3-bordered w3-striped w3-hoverable")]);i1=d.ofArray([c.Element("tr",d.ofArray([i.Class("coupon-header-row w3-pale-green")]),E.renderGamesHeaderRow())]);i3=function(i4){var i5;i5=E.renderMeetup(i4);return E.doc(i5);};i6=function(i7){var i8;i8=p.map(i3,i7);return c.Concat(i8);};i9=E.meetups().get_View();i_=q.Map(i6,i9);i2=d.ofArray([c.EmbedView(i_)]);return c.Element("div",iY,d.ofArray([c.Element("div",d.ofArray([j.Create("class","w3-center")]),d.ofArray([c.Element("ul",d.ofArray([j.Create("class","w3-pagination w3-border w3-round")]),d.ofArray([E.renderPagination()]))])),c.Element("div",iZ,d.ofArray([c.Element("table",i0,d.ofArray([c.Element("thead",[],i1),c.Element("tbody",[],i2)]))])),K.render()]));}),setMarket:function(i$,ja,jb){var jc,jd,jg,jj,jk,jl,jm,jn,jx,jy;jc=[i$,ja];jd=function(je){var jf;je[0];je[1];je[2];jf=je[3];return jf;};jg=function(jh){return function(ji){return jh+ji;};};jj=jc[0];jk=jc[1];jl=d.choose(jd,jb);jm=p.fold(jg,0,jl);E.updateTotalMatched(jj,jk,jm);jn=function(jo){var jp,jq,jr,js,jt;jp=jo[0];jq=jo[1];jr=jo[2];js=jo[3];jt=function(ju){var jv,jw;jv=ju[0];jw=ju[1];return{selectionId:jw,runnerName:jv};};return{marketId:jp,marketName:jq,totalMatched:js,runners:d.map(jt,jr)};};jx=d.map(jn,jb);jy=function(jz){return{$:1,$0:$.New(M,{gameId:jz.gameId,country:jz.country,markets:jx})};};return E.eventsCatalogue().UpdateBy(jy,jc);},stvr:function(jA,jB){return!w.Equals(n.Get(jA),jB)?n.Set(jA,jB):null;},tryGetCountry:function(jC,jD){var jE,jF,jG,jH,jI,jJ,jK;jE=[jC,jD];jF=jE[0];jG=jE[1];jH=E.tryGetEvent(jF,jG);if(jH.$==1){if(jH.$0.country.$==1){jK=jH.$0.country.$0;jJ=jK;}else{jJ="";}jI=jJ;}else{jI="";}return jI;},tryGetEvent:function(jL,jM){var jN,jO,jR;jN=[jL,jM];jO=function(jP){var jQ;jQ=jP.gameId;return w.Equals(jN,jQ);};jR=n.Get(E.eventsCatalogue().Var);return p.tryFind(jO,jR);},updateColumnCountryVisible:function(){var jS,jU,jV;jS=function(jT){return n.Get(jT.country)!=="";};jU=n.Get(E.meetups().Var);jV=p.exists(jS,jU);return!w.Equals(n.Get(E.varColumnCountryVisible()),jV)?n.Set(E.varColumnCountryVisible(),jV):null;},updateColumnGpbVisible:function(){var jW,jY,jZ;jW=function(jX){return n.Get(jX.totalMatched).$==1;};jY=n.Get(E.meetups().Var);jZ=p.exists(jW,jY);return!w.Equals(n.Get(E.varColumnGpbVisible()),jZ)?n.Set(E.varColumnGpbVisible(),jZ):null;},updateCoupon:function(j0,j1,j2){var j3,j4,j5,j6,j8;j3=j0.$==0;!j3?E.addNewGames(j0):null;j4=p.isEmpty(j2);if(!j4){j6=function(j7){return E.meetups().RemoveByKey(j7);};j5=p.iter(j6,j2);}else{j5=null;}j8=function(j9){var j_,j$,ka,kb,kc,kd,ke,kf;j_=j9[0];j$=j9[1];ka=j9[2];kb=E.meetups().TryFindByKey(j_);if(kb.$==1){kd=kb.$0;if(kd.hash!==ka){kf=kb.$0;kf.hash=ka;E.stvr(kf.playMinute,j$.playMinute);E.stvr(kf.status,j$.status);E.stvr(kf.summary,j$.summary);E.stvr(kf.order,j$.order);E.stvr(kf.winBack,j$.winBack);E.stvr(kf.winLay,j$.winLay);E.stvr(kf.drawBack,j$.drawBack);E.stvr(kf.drawLay,j$.drawLay);E.stvr(kf.loseBack,j$.loseBack);ke=E.stvr(kf.loseLay,j$.loseLay);}else{ke=null;}kc=ke;}else{kc=null;}return kc;};return p.iter(j8,j1);},updateTotalMatched:function(kg,kh,ki){var kj,kk,kl,km;kj=[kg,kh];kk=E.meetups().TryFindByKey(kj);if(kk.$==1){km=kk.$0;kl=n.Set(km.totalMatched,{$:1,$0:ki});}else{kl=null;}return kl;},varColumnCountryVisible:$.Field(function(){return l.Create(false);}),varColumnGpbVisible:$.Field(function(){return l.Create(false);}),varCurrentPageNumber:$.Field(function(){return l.Create(0);}),varDataRecived:$.Field(function(){return l.Create(false);}),varPagesCount:$.Field(function(){return l.Create(1);})},Utils:{Left:function(kn){return{$:0,$0:kn};},LocalStorage:{checkTodayKey:function(ko,kp){var kq,kr,ks,kt;kq=R.now();kr=H.getWithDef(ko,kq);if(kq-kr>1*86400000){H.clear(kp);H.set(ko,R.now());kt=function(ku){return function(kv){var kw;kw="local storage "+x.prettyPrint(ku)+" of "+x.prettyPrint(kv)+" is inspired";return y?y.log(kw):undefined;};};(kt(kp))(kr);ks=kq;}else{ks=kr;}return ks;},clear:function(kx){return H.strg().removeItem(kx);},get:function(ky){var kz,kA,kB,kC,kD;try{kA=H.strg().getItem(ky);kB=S.parse(kA);kz={$:1,$0:kB};}catch(kC){kD=function(kE){return function(kF){var kG;kG="error getting from local storage, key "+x.prettyPrint(kE)+" : "+x.prettyPrint(kF);return y?y.log(kG):undefined;};};(kD(ky))(kC);kz={$:0};}return kz;},getWithDef:function(kH,kI){var kJ,kK,kL;kJ=H.get(kH);if(kJ.$==1){kL=kJ.$0;kK=kL;}else{kK=kI;}return kK;},set:function(kM,kN){var kO,kP,kQ,kR;try{kP=S.stringify(kN);kO=H.strg().setItem(kM,kP);}catch(kQ){kR=function(kS){return function(kT){return function(kU){return Q.FailWith("error setting to local storage, key "+x.prettyPrint(kS)+", value "+x.prettyPrint(kT)+" : "+x.prettyPrint(kU));};};};kO=((kR(kM))(kN))(kQ);}return kO;},strg:$.Field(function(){return T.localStorage;})},Right:function(kV){return{$:1,$0:kV};},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(kW){return G.trimEnd(kW.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(kX){var kY,kZ;if(kX.$==1){kZ=kX.$0;kY=G.formatDecimal(kZ);}else{kY="";}return kY;},getDatePart:function(k0){var k1;k1=new R(k0.getTime());k1.setHours(0,0,0,0);return k1;},mkids:function(k2,k3){var k4,k6,k7,k8,k9;k4=function(k5){return[k3(k5),k5];};k6=d.map(k4,k2);k7=O.OfArray(p.toArray(k6));k8=d.map(k3,k2);k9=U.New1(V.OfSeq(k8));return[k9,k7];},trimEnd:function(k_,k$){var la,lb,lc,ld,le,lf,lg,lh,li,lj,lk,ll;la=[k_,k$];if(la[0]===""){lb="";}else{if(la[1].$==1){ld=la[0];la[1];le=la[1].$0;if(ld.charCodeAt(ld.length-1)===le){la[1].$0;lg=la[1];lh=la[0];lf=G.trimEnd(W.string(lh,{$:0},{$:1,$0:lh.length-2}),lg);}else{if(la[1].$==1){lj=la[0];lk=la[1].$1;li=G.trimEnd(lj,lk);}else{li=Q.Raise(X.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",8,18));}lf=li;}lc=lf;}else{ll=la[0];lc=ll;}lb=lc;}return lb;},"|Left|Right|":function(lm){var ln,lo,lp;if(lm.$==1){lo=lm.$0;ln={$:1,$0:lo};}else{lp=lm.$0;ln={$:0,$0:lp};}return ln;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe(b.Key);l=$.Safe(b.Var);m=$.Safe($$.WebSharper.Concurrency);n=$.Safe(b.Var1);o=$.Safe($$.WebSharper.Option);p=$.Safe($$.WebSharper.Seq);q=$.Safe(b.View);r=$.Safe(g.RecordType);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe($$.WebSharper.PrintfHelpers);y=$.Safe($$.console);z=$.Safe(b.Storage1);A=$.Safe($$.WebSharper.Json);B=$.Safe(A.Provider);C=$.Safe(B.Id);D=$.Safe(b.ListModel);E=$.Safe(f.Coupon);F=$.Safe(E.PageLen);G=$.Safe(f.Utils);H=$.Safe(G.LocalStorage);I=$.Safe(E.Work);J=$.Safe(E.ServerBetfairsSession);K=$.Safe(E.SettingsDialog);L=$.Safe(E.Meetup);M=$.Safe(E.EventCatalogue);N=$.Safe($$.WebSharper.Collections);O=$.Safe(N.MapModule);P=$.Safe(b.View1);Q=$.Safe($$.WebSharper.Operators);R=$.Safe($$.Date);S=$.Safe($$.JSON);T=$.Safe($$.window);U=$.Safe(N.FSharpSet);V=$.Safe(N.BalancedTree);W=$.Safe($$.WebSharper.Slice);return X=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){H.strg();E.varPagesCount();E.varDataRecived();E.varCurrentPageNumber();E.varColumnGpbVisible();E.varColumnCountryVisible();E["render\u0421oupon"]();E.renderPagination();E.renderGamesHeaderRow();E.meetups();E.eventsCatalogue();K.render();K["id'"]();J.hasServerBetfairsSession();F.view();F["var"]();F.localStorageKey();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
