(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;$.Define($$,{CentBet:{Client:{Admin:{Config:function(){var G,H,I,J,K,M,N,O,P,Q,R,S,T,V;G=c.Create("");H=c.Create("");I=c.Create(false);J=c.Create({$:0});K=function(L){return L;};N=d.ofArray([e.TextNode("session token")]);O=d.ofArray([e.Input($.New(f,{$:0}),G)]);P=d.ofArray([e.TextNode("developers app key")]);Q=d.ofArray([e.Input($.New(f,{$:0}),H)]);S=$.New(f,{$:0});T=function(){return null;};R=d.ofArray([e.Button("Send",S,T)]);M=d.ofArray([e.Element("p",[],N),e.Element("p",[],O),e.Element("p",[],P),e.Element("p",[],Q),e.Element("p",[],R)]);V=d.map(K,M);return e.Concat(V);},Main:function(W){var X;X=c.Create(W);return e.EmbedView(g.Map(function(Y){return Y?j.Config():j.PromptEnterKey(function(){return k.Set(X,true);});},X.get_View()));},PromptEnterKey:function(_0){var _1,_2,_3,_4,_5,bk,bo,bp,bq,br,bs,bt,bu,bv,bw,by,bA,bB,bF,bG,bH,bI,bM;_1=c.Create("");_2=c.Create(false);_3=c.Create({$:0});_4=c.Create(null);_5=function(){return l.Delay(function(){var _8,ba,bb,bc;_8=function(_9){var _;_="authorize with "+m.prettyPrint(_9);return n?n.log(_):undefined;};ba=k.Get(_1);_8(ba);k.Set(_2,true);bb={$:0};k.Set(_3,bb);bc=p.Async("WebFace:2",[k.Get(_1)]);return l.Bind(bc,function(bd){var be,bf,bg,bj;k.Set(_2,false);if(bd.$==1){bf=bd.$0;bg=function(bh){var bi;bi="authorization error "+m.prettyPrint(bh);return n?n.log(bi):undefined;};bg(bf);bj={$:1,$0:bf};k.Set(_3,bj);be=l.Return(null);}else{if(n){n.log("authorized");}_0(null);be=l.Return(null);}return be;});});};bk=function(bl){var bm,bn;if(bl===""){bm=null;}else{bn=_5(null);bm=l.Start(bn,{$:0});}return bm;};bo=_1.get_View();bp=g.Map(bk,bo);bq=_4.get_View();br=g.SnapshotOn(null,bq,bp);bt=d.ofArray([e.InputArea($.New(f,{$:0}),_1)]);bv=$.New(f,{$:0});bw=function(){return k.Set(_4,null);};bu=d.ofArray([e.Button("submit",bv,bw)]);by=function(){return e.get_Empty();};bA=g.Map(by,br);bB=function(bC){var bD,bE;if(bC){bE=d.ofArray([e.TextNode("\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd...")]);bD=e.Element("p",[],bE);}else{bD=e.get_Empty();}return bD;};bF=_2.get_View();bG=g.Map(bB,bF);bH=_3.get_View();bI=function(bJ){var bK,bL;if(bJ.$==1){bL=bJ.$0;bK=e.Element("p",d.ofArray([q.Style("color","red")]),d.ofArray([e.TextNode(bL)]));}else{bK=e.get_Empty();}return bK;};bM=g.Map(bI,bH);bs=d.ofArray([e.Element("p",[],bt),e.Element("p",[],bu),e.EmbedView(bA),e.EmbedView(bG),e.EmbedView(bM)]);return e.Concat(bs);}},Coupon:{Main:function(){var bM,bR,bS,bT,b3,ca;bM=l.Delay(function(){return l.While(function(){return true;},l.Delay(function(){return l.Bind(r.processCoupon(k.Get(r.varInplayOnly())),function(){return l.Return(null);});}));});l.Start(bM,{$:0});bR=g.get_Do();bS=r.varInplayOnly().get_View();bT=s.Bind(function(bU){return s.Bind(function(bV){var bW,bX,bY,b0,b1,b2;bW=t.isEmpty(bV);bX=!bW;bY=function(bZ){return u.inplay(bZ);};b0=t.filter(bY,bV);b1=t.isEmpty(b0);b2=!b1;return s.Const([bX,b2,bU]);},r.meetups().get_View());},bS);b3=function(b4){var b5,b6,b7,b8,b9,b_,b$;if(b4[0]){if(b4[1]){b7=d.ofArray([r.table()]);b6=e.Element("table",$.New(f,{$:0}),d.ofArray([e.Element("tbody",[],b7)]));}else{if(b4[2]){b9=d.ofArray([e.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);b8=e.Element("h1",[],b9);}else{b_=d.ofArray([r.table()]);b8=e.Element("table",$.New(f,{$:0}),d.ofArray([e.Element("tbody",[],b_)]));}b6=b8;}b5=b6;}else{b$=d.ofArray([e.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);b5=e.Element("h1",[],b$);}return b5;};ca=g.Map(b3,bT);return e.EmbedView(ca);},Meetup:$.Class({},{id:function(cb){return cb.game.gameId;},inplay:function(cc){return k.Get(cc.gameInfo).playMinute.$==1;},notinplay:function(cd){return k.Get(cd.gameInfo).playMinute.$==0;},viewGameInfo:function(ce){return ce.gameInfo.get_View();}}),Menu:function(){var cf,cg,cw;cf=r.varInplayOnly().get_View();cg=function(ch){var ci,ck,cv;ci=function(cj){return cj;};ck=d.ofArray([e.Element("a",t.toList(t.delay(function(){return t.append([v.Create("href","#")],t.delay(function(){return t.append([q.Handler("click",function(){return function(){return k.Set(r.varInplayOnly(),true);};})],t.delay(function(){return ch?[v.Create("class","active")]:t.empty();}));}));})),d.ofArray([e.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),e.Element("a",t.toList(t.delay(function(){return t.append([v.Create("href","#")],t.delay(function(){return t.append([q.Handler("click",function(){return function(){return k.Set(r.varInplayOnly(),false);};})],t.delay(function(){return!ch?[v.Create("class","active")]:t.empty();}));}));})),d.ofArray([e.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);cv=d.map(ci,ck);return e.Concat(cv);};cw=g.Map(cg,cf);return e.EmbedView(cw);},MenuToday:function(){var cx,cy,cD;cx=r.varInplayOnly().get_View();cy=function(cz){return e.Element("li",t.toList(t.delay(function(){return!cz?[v.Create("class","active")]:t.empty();})),d.ofArray([e.Element("a",d.ofArray([v.Create("href","#"),q.Handler("click",function(){return function(){return k.Set(r.varInplayOnly(),false);};})]),d.ofArray([e.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};cD=g.Map(cy,cx);return e.EmbedView(cD);},addNewGames:function(cE){var cF,cG,cH,cM,cO,cQ,cR,cS;cF=k.Get(r.meetups().Var);cG=t.toList(cF);r.meetups().Clear();cH=function(cI){var cJ,cK,cL;cJ=cI[0];cK=cI[1];cL=cI[2];return $.New(u,{game:cJ,gameInfo:c.Create(cK),hash:cL});};cM=function(cN){return k.Get(cN.gameInfo).order;};cO=function(cP){return r.meetups().Add(cP);};cQ=d.map(cH,cE);cR=t.append(cG,cQ);cS=t.sortBy(cM,cR);return t.iter(cO,cS);},downloadCoupon:function(cT,cU){return p.Async("WebFace:0",[cU,cT]);},meetups:$.Field(function(){var cV,cX;cV=function(cW){return u.id(cW);};cX=$.New(f,{$:0});return w.Create(cV,cX);}),processCoupon:function(cY){return l.Delay(function(){var c0,c2,c3,c4;c0=function(c1){return[c1.game.gameId,c1.hash];};c2=k.Get(r.meetups().Var);c3=t.map(c0,c2);c4=t.toList(c3);return l.Bind(r.downloadCoupon(cY,c4),function(c5){var c6,c7,c8;c6=c5[1];c7=c5[2];c8=c5[0];r.updateCoupon(c8,c6,c7);return l.Return(null);});});},row:function(c9,c_){var c$,da,dd,dg,dk,dm;if(c_?k.Get(c9.gameInfo).playMinute.$==0:false){c$=e.get_Empty();}else{da=function(db){var dc;dc=d.ofArray([db]);return e.Element("td",[],dc);};dd=function(de){var df;df=d.ofArray([e.TextNode(de)]);return e.Element("td",[],df);};dg=function(dh){var di,dj;di=c9.gameInfo.get_View();dj=g.Map(dh,di);return da(e.TextView(dj));};dk=function(dl){return x.formatDecimalOption(dl);};dm=$.New(f,{$:0});c$=e.Element("tr",dm,d.ofArray([dg(function(dn){var _do,dp,dq;_do=dn.order;dp=_do[0];dq=_do[1];return $$.String(dp)+"."+$$.String(dq);}),dd(c9.game.home),dd(c9.game.away),dg(function(dr){return dr.status;}),dg(function(ds){return ds.summary;}),dg(function(dt){return dk(dt.winBack);}),dg(function(du){return dk(du.winLay);}),dg(function(dv){return dk(dv.drawBack);}),dg(function(dw){return dk(dw.drawLay);}),dg(function(dx){return dk(dx.loseBack);}),dg(function(dy){return dk(dy.loseLay);})]));}return c$;},table:function(){var dz,dA;dz=r.meetups().get_View();dA=function(dB){var dC,dG,dJ;dC=function(dD){var dE,dF;dE=dD[0];dF=dD[1];return r.row(dE,dF);};g.get_Do();dG=s.Bind(function(dH){return s.Bind(function(dI){return s.Const([dH,dI]);},r.varInplayOnly().get_View());},dB);dJ=g.Map(dC,dG);return e.EmbedView(dJ);};return e.ConvertSeq(dA,dz);},updateCoupon:function(dK,dL,dM){var dN,dO,dP,dS,dT,dU,dV,dX,d0,d1;dN=dK.$==0;if(!dN){dP=function(dQ){var dR;dR="adding new games "+$$.String(dQ);return n?n.log(dR):undefined;};dS=dK.get_Length();dP(dS);dO=r.addNewGames(dK);}else{dO=null;}dT=t.isEmpty(dM);if(!dT){dV=function(dW){return r.meetups().RemoveByKey(dW);};t.iter(dV,dM);dX=function(dY){var dZ;dZ="removing out games "+$$.String(dY);return n?n.log(dZ):undefined;};d0=t.length(dM);dU=dX(d0);}else{dU=null;}d1=function(d2){var d3,d4,d5,d6,d7,d8;d3=d2[0];d4=d2[1];d5=d2[2];d6=r.meetups().TryFindByKey(d3);if(d6.$==1){d8=d6.$0;k.Set(d8.gameInfo,d4);d7=void(d8.hash=d5);}else{d7=null;}return d7;};return t.iter(d1,dL);},varInplayOnly:$.Field(function(){return c.Create(true);})},Utils:{dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(d9){return x.trimEnd(d9.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(d_){var d$,ea;if(d_.$==1){ea=d_.$0;d$=x.formatDecimal(ea);}else{d$="";}return d$;},getDatePart:function(eb){var ec;ec=new y(eb.getTime());ec.setHours(0,0,0,0);return ec;},mkids:function(ed,ee){var ef,eh,ei,ej,ek;ef=function(eg){return[ee(eg),eg];};eh=d.map(ef,ed);ei=A.OfArray(t.toArray(eh));ej=d.map(ee,ed);ek=B.New1(C.OfSeq(ej));return[ek,ei];},trimEnd:function(el,em){var en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey;en=[el,em];if(en[0]===""){eo="";}else{if(en[1].$==1){eq=en[0];en[1];er=en[1].$0;if(eq.charCodeAt(eq.length-1)===er){en[1].$0;et=en[1];eu=en[0];es=x.trimEnd(D.string(eu,{$:0},{$:1,$0:eu.length-2}),et);}else{if(en[1].$==1){ew=en[0];ex=en[1].$1;ev=x.trimEnd(ew,ex);}else{ev=E.Raise(F.New("E:\\User\\Docs\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\WebClient\\ClientUtils.fs",9,22));}es=ev;}ep=es;}else{ey=en[0];ep=ey;}eo=ep;}return eo;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Var);d=$.Safe($$.WebSharper.List);e=$.Safe(b.Doc);f=$.Safe(d.T);g=$.Safe(b.View);h=$.Safe($$.CentBet);i=$.Safe(h.Client);j=$.Safe(i.Admin);k=$.Safe(b.Var1);l=$.Safe($$.WebSharper.Concurrency);m=$.Safe($$.WebSharper.PrintfHelpers);n=$.Safe($$.console);o=$.Safe($$.WebSharper.Remoting);p=$.Safe(o.AjaxRemotingProvider);q=$.Safe(b.AttrModule);r=$.Safe(i.Coupon);s=$.Safe(b.View1);t=$.Safe($$.WebSharper.Seq);u=$.Safe(r.Meetup);v=$.Safe(b.AttrProxy);w=$.Safe(b.ListModel);x=$.Safe(i.Utils);y=$.Safe($$.Date);z=$.Safe($$.WebSharper.Collections);A=$.Safe(z.MapModule);B=$.Safe(z.FSharpSet);C=$.Safe(z.BalancedTree);D=$.Safe($$.WebSharper.Slice);E=$.Safe($$.WebSharper.Operators);return F=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){r.varInplayOnly();r.meetups();return;});}());
