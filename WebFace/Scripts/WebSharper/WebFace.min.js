(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({},{get_color:function(){return function(V){return V.$==1?["lightgrey","red"]:V.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var W;W=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],W)),g.RenderRecords()]));},RenderCommandPrompt:function(){var X;X=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(X);},RenderMenu:function(){var Y,_0,_9;Y=function(Z){return Z;};_0=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([c.TextNode("Clear console")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([c.TextNode("Clear history")]))]);_9=d.map(Y,_0);return c.Concat(_9);},RenderRecords:function(){var _,bd;_=function(ba){var bb,bc;bc=$.New(h,{$:0});bb=d.ofArray([(g.renderRecord())(ba),(g.op_SpliceUntyped())(c.Element("br",[],bc))]);return c.Concat(bb);};bd=g.varConsole().get_View();return c.ConvertSeq(_,bd);},addRecord:function(bd,be){return g.varConsole().Add({Id:l.Fresh(),Text:be,Level:bd});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bf){return bf.Id;},doc:function(bg){return bg;},op_SpliceUntyped:$.Field(function(){return function(bh){return g.doc(bh);};}),recordKey:function(bi){return bi.Id;},renderInput:function(){var bj,bk,bl,bm,bp,bs,bw,bx,bL;bj=m.Create("");bk=m.Create(null);bl=m.Create(false);bm=n.Delay(function(){o.Set(bl,true);return n.Bind(g.send(o.Get(bj)),function(){o.Set(bl,false);o.Set(bj,"");return n.Return(null);});});bp=function(bq){var br;br={$:1,$0:bq};g.varCmd=function(){return br;};return o.Set(bj,bq.Text);};bs=function(bt){var bu,bv;bu=g.tryGetCommandFromHistory(bt);bv=p.map(bp,bu);return;};bw=bl.get_View();bx=function(by){var bz;bz=d.ofArray([c.Input(k.toList(k.delay(function(){return k.append([j.Create("id",g["cmd-input"]())],k.delay(function(){return k.append(by?[j.Create("disabled","disabled")]:k.empty(),k.delay(function(){return k.append([i.Style("width","80%")],k.delay(function(){return k.append([i.CustomVar(bk,function(bE){return function(){return bE.focus();};},function(){return{$:0};})],k.delay(function(){return[i.Handler("keydown",function(){return function(bJ){var bK;bK=bJ.keyCode;return bK===13?n.Start(bm,{$:0}):bK===38?bs(true):bK===40?bs(false):null;};})];}));}));}));}));})),bj)]);return c.Concat(bz);};bL=q.Map(bx,bw);return c.EmbedView(bL);},renderRecord:$.Field(function(){var bM;bM=function(bN){var bO,bP,bQ;bO=(r.get_color())(bN.Level);bP=bO[1];bQ=bO[0];return(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bP),i.Style("background",bQ)]),d.ofArray([c.TextNode(bN.Text)])));};return function(bR){var bS;bS=q.Map(bM,bR);return c.EmbedView(bS);};}),send:function(bT){return n.Delay(function(){var bV,bW,bX,bY,bZ,b0;bV=s.Trim(bT);g.addRecord($.New(r,{$:2}),bV);bX=o.Get(g.varCommandsHistory().Var);if(k.isEmpty(bX)){bY=true;}else{bZ=t.last(bX);bY=bZ.Text!==bV;}if(bY){g.varCommandsHistory().Add({Id:l.Fresh(),Text:bV});b0=n.Return(null);}else{b0=n.Return(null);}bW=b0;return n.Combine(bW,n.Delay(function(){return n.TryWith(n.Delay(function(){return n.Bind(v.Async("WebFace:1",[bV]),function(b3){var b4;b3[0];b4=b3[1];g.addRecord($.New(r,{$:0}),b4);return n.Return(null);});}),function(b5){g.addRecord($.New(r,{$:1}),b5.message);return n.Return(null);});}));});},tryGetCommandFromHistory:function(b6){var b7,b8,b9,b_,b$,ca,cb,ce,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;b7=o.Get(g.varCommandsHistory().Var);b8=k.length(b7);if(b8===0){b9={$:0};}else{if(g.varCmd().$==1){ca=g.varCmd().$0.Id;cb=function(cc){return function(cd){return[cd,cc];};};ce=function(cf){var cg,ch;cg=cf[0];cf[1];ch=cg.Id;return w.Equals(ch,ca);};ci=o.Get(g.varCommandsHistory().Var);cj=k.mapi(cb,ci);ck=k.tryFind(ce,cj);cl=[ck,b6];if(cl[0].$==1){if(cl[1]){cl[0].$0[0];co=cl[0].$0[1];if(b8>0?co<b8-1:false){cq=cl[0].$0[1];cl[0].$0[0];cp=cq+1;}else{if(cl[0].$==1){if(cl[1]){cs=cl[1]?b8-1:0;}else{cl[0].$0[0];ct=cl[0].$0[1];if(b8>0?ct>0:false){cv=cl[0].$0[1];cl[0].$0[0];cu=cv-1;}else{cu=cl[1]?b8-1:0;}cs=cu;}cr=cs;}else{cr=cl[1]?b8-1:0;}cp=cr;}cn=cp;}else{if(cl[0].$==1){if(cl[1]){cx=cl[1]?b8-1:0;}else{cl[0].$0[0];cy=cl[0].$0[1];if(b8>0?cy>0:false){cA=cl[0].$0[1];cl[0].$0[0];cz=cA-1;}else{cz=cl[1]?b8-1:0;}cx=cz;}cw=cx;}else{cw=cl[1]?b8-1:0;}cn=cw;}cm=cn;}else{if(cl[0].$==1){if(cl[1]){cC=cl[1]?b8-1:0;}else{cl[0].$0[0];cD=cl[0].$0[1];if(b8>0?cD>0:false){cF=cl[0].$0[1];cl[0].$0[0];cE=cF-1;}else{cE=cl[1]?b8-1:0;}cC=cE;}cB=cC;}else{cB=cl[1]?b8-1:0;}cm=cB;}b$=cm;}else{b$=b8-1;}b_=b$;cG=k.nth(b_,b7);b9={$:1,$0:cG};}return b9;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cH,cJ;cH=function(cI){return g.cmdKey(cI);};cJ=x.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))()});return B.CreateWithStorage(cH,cJ);}),varConsole:$.Field(function(){var cK,cM;cK=function(cL){return g.recordKey(cL);};cM=x.LocalStorage("CentBetConsole",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return B.CreateWithStorage(cK,cM);})},Coupon:{EventCatalogue:$.Class({},{id:function(cN){return cN.gameId;}}),Meetup:$.Class({},{hasGPB:function(cO){return o.Get(cO.totalMatched).$==1;},id:function(cP){return cP.game.gameId;},inplay:function(cQ){return o.Get(cQ.gameInfo).playMinute.$==1;},notinplay:function(cR){return o.Get(cR.gameInfo).playMinute.$==0;},viewGameInfo:function(cS){return cS.gameInfo.get_View();}}),Render:function(){var cT,cU,cV,cW,cX,cZ,c0,c1,c2,c3,c5,c6,c7,c8,c9,c$,da,db,dc,dd,df,dg,dh,dn,dw;cT=["COUPON",5000,5000];cU=cT[0];cV=cT[1];cW=cT[2];cX=function(){return C.processCoupon();};D["new"](cU,cV,cW,cX);cZ=["EVENTS-CATALOGUE",10000,5000];c0=cZ[0];c1=cZ[1];c2=cZ[2];c3=function(){return C.processEvents();};D["new"](c0,c1,c2,c3);c5=["MARKETS-CATALOGUE",10000,5000];c6=c5[0];c7=c5[1];c8=c5[2];c9=function(){return C.processMarkets();};D["new"](c6,c7,c8,c9);c$=["TOTAL-MATCHED",10000,5000];da=c$[0];db=c$[1];dc=c$[2];dd=function(){return C.processTotalMatched();};D["new"](da,db,dc,dd);df=q.get_Do();dg=C.varInplayOnly().get_View();dh=E.Bind(function(di){return E.Bind(function(dj){return E.Bind(function(dk){var dl,dm;dl=k.isEmpty(dk);dm=!dl;return E.Const([dm,di,dj]);},C.meetups().get_View());},C.varDataRecived().get_View());},dg);dn=function(_do){var dp,dq,dr,ds,dt,du,dv;if(_do[2]){if(_do[0]){dr=d.ofArray([C.renderMeetups()]);dq=c.Element("table",$.New(h,{$:0}),d.ofArray([c.Element("tbody",[],dr)]));}else{if(_do[1]){dt=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0440\u0430\u0437\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445")]);ds=c.Element("h1",[],dt);}else{du=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445 \u043d\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f")]);ds=c.Element("h1",[],du);}dq=ds;}dp=dq;}else{dv=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);dp=c.Element("h1",[],dv);}return dp;};dw=q.Map(dn,dh);return c.EmbedView(dw);},RenderMenu:function(){var dx;dx=d.ofArray([C.renderMenusInplay(),C.renderMenuCountries()]);return c.Concat(dx);},Work:$.Class({},{loop:function(dy){return n.Delay(function(){var dA;dA=n.Delay(function(){return n.Bind(dy.work.call(null,null),function(){return n.Bind(n.Sleep(dy.sleepInterval),function(){return n.Return(null);});});});return n.Combine(n.TryWith(dA,function(dE){var dF,dJ;dF=function(dG){return function(dH){var dI;dI="task error "+F.prettyPrint(dG)+" : "+F.prettyPrint(dH);return G?G.log(dI):undefined;};};dJ=dy.what;(dF(dJ))(dE);return n.Bind(n.Sleep(dy.sleepErrorInterval),function(){return n.Return(null);});}),n.Delay(function(){return D.loop(dy);}));});},"new":function(dM,dN,dO,dP){var dQ;dQ=$.New(D,{what:dM,sleepInterval:dN,sleepErrorInterval:dO,work:dP});return D.run(dQ);},run:function(dR){var dS;dS=n.Delay(function(){var dU,dX;dU=function(dV){var dW;dW="task "+F.prettyPrint(dV)+" : started";return G?G.log(dW):undefined;};dX=dR.what;dU(dX);return n.Bind(D.loop(dR),function(){var dZ,d2;dZ=function(d0){var d1;d1="task "+F.prettyPrint(d0)+" : terminated";return G?G.log(d1):undefined;};d2=dR.what;dZ(d2);return n.Return(null);});});return n.Start(dS,{$:0});}}),addNewGames:function(d3){var d4,d5,d6,ee,eg,ei,ej,ek;d4=o.Get(C.meetups().Var);d5=k.toList(d4);C.meetups().Clear();d6=function(d7){var d8,d9,d_,d$,ea,eb,ec,ed;d8=d7[0];d9=d7[1];d_=d7[2];d$=d8.gameId;ea=d$[0];eb=d$[1];ec=C.tryGetCountry(ea,eb);ed=m.Create(d9);return $.New(H,{game:d8,gameInfo:ed,country:m.Create(ec),totalMatched:m.Create({$:0}),hash:d_});};ee=function(ef){return o.Get(ef.gameInfo).order;};eg=function(eh){return C.meetups().Add(eh);};ei=d.map(d6,d3);ej=k.append(d5,ei);ek=k.sortBy(ee,ej);return k.iter(eg,ek);},doc:function(el){return el;},eventsCatalogue:$.Field(function(){var em,en,ep,eq,er,es;em=J.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");en=function(eo){return K.id(eo);};eq=(z.get_Default().EncodeRecord(K,[["gameId",z.get_Default().EncodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))();ep=x.LocalStorage("CentBetEventsCatalogue",{Encode:eq,Decode:(z.get_Default().DecodeRecord(K,[["gameId",z.get_Default().DecodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))()});er=B.CreateWithStorage(en,ep);es=function(et){return function(eu){return function(ev){var ew;ew=F.prettyPrint(et)+" - "+$$.String(eu)+", "+F.prettyPrint(ev);return G?G.log(ew):undefined;};};};((es("CentBetEventsCatalogue"))(er.get_Length()))(em);return er;}),meetups:$.Field(function(){var ex,ez;ex=function(ey){return H.id(ey);};ez=$.New(h,{$:0});return B.Create(ex,ez);}),processCoupon:function(){return n.Delay(function(){var eB,eD,eE,eF,eG;eB=function(eC){return[eC.game.gameId,eC.hash];};eD=o.Get(C.meetups().Var);eE=k.map(eB,eD);eF=k.toList(eE);eG=v.Async("WebFace:0",[eF,o.Get(C.varInplayOnly())]);return n.Bind(eG,function(eH){var eI,eJ,eK,eL;eI=eH[1];eJ=eH[2];eK=eH[0];if(!(eK.$==0)?true:!(eI.$==0)){o.Set(C.varDataRecived(),true);eL=n.Return(null);}else{eL=n.Return(null);}return n.Combine(eL,n.Delay(function(){C.updateCoupon(eK,eI,eJ);return n.Return(null);}));});});},processEvents:function(){return n.Delay(function(){var eO,eP,eQ,eV,eW,eX,eY;eO=o.Get(C.eventsCatalogue().Var);eP=o.Get(C.meetups().Var);eQ=function(eR){var eS,eU;eS=function(eT){return w.Equals(eT.gameId,eR.game.gameId);};eU=k.tryFind(eS,eO);return eU.$==0?{$:1,$0:eR.game.gameId}:{$:0};};eV=k.choose(eQ,eP);eW=k.toList(eV);if(eW.$==0){eX=n.Return(null);}else{eY=v.Async("WebFace:2",[eW]);eX=n.Bind(eY,function(eZ){var e0;e0=n.For(eZ,function(e1){var e2,e3;e1[1];e2=e1[0];e3=e1[2];C.eventsCatalogue().Add($.New(K,{gameId:e2,country:e3,markets:$.New(h,{$:0})}));return n.Return(null);});return n.Combine(e0,n.Delay(function(){return n.For(o.Get(C.meetups().Var),function(e5){var e6,e7,e8;e6=e5.game.gameId;e7=e6[0];e8=e6[1];o.Set(e5.country,C.tryGetCountry(e7,e8));return n.Return(null);});}));});}return eX;});},processMarkets:function(){return n.Delay(function(){var e_,fa,fb,fc;e_=function(e$){return e$.markets.$==0;};fa=o.Get(C.eventsCatalogue().Var);fb=k.filter(e_,fa);fc=k.toList(fb);return fc.$==0?n.Return(null):n.For(fc,function(fd){var fe,ff,fg,fh;fe=fd.gameId;ff=fe[0];fg=fe[1];fh=v.Async("WebFace:4",[ff,fg]);return n.Bind(fh,function(fi){var fj,fk,fl,fo,fp,fq,fr,fs,ft,fu,fv,fE,fF,fH,fI;if(fi.$==1){fk=fi.$0;fl=function(fm){var fn;fm[0];fm[1];fm[2];fn=fm[3];return fn;};fo=fd.gameId;fp=fo[0];fq=fo[1];fr=d.choose(fl,fk);if(fr.$==0){ft={$:0};}else{fu=k.sum(fr);ft={$:1,$0:fu};}fs=ft;C.updateTotalMatched(fp,fq,fs);fv=function(fw){var fx,fy,fz,fA;fx=fw[0];fy=fw[1];fz=fw[2];fw[3];fA=function(fB){var fC,fD;fC=fB[0];fD=fB[1];return{selectionId:fD,runnerName:fC};};return{marketId:fx,marketName:fy,runners:d.map(fA,fz)};};fE=d.map(fv,fk);fF=function(fG){return{$:1,$0:$.New(K,{gameId:fG.gameId,country:fG.country,markets:fE})};};fH=fd.gameId;C.eventsCatalogue().UpdateBy(fF,fH);fj=n.Return(null);}else{fI=fi.$0;L.FailWith(fI);fj=n.Return(null);}return fj;});});});},processTotalMatched:function(){return n.Delay(function(){var fK,fM,fN,fO;fK=function(fL){return fL.game.gameId;};fM=o.Get(C.meetups().Var);fN=k.map(fK,fM);fO=k.toList(fN);return fO.$==0?n.Return(null):n.For(fO,function(fP){var fQ,fR,fS;fQ=fP[0];fR=fP[1];fS=v.Async("WebFace:3",[fQ,fR]);return n.Bind(fS,function(fT){var fU,fV,fW,fX,fY;if(fT.$==1){fV=fT.$0;fW=fP[0];fX=fP[1];C.updateTotalMatched(fW,fX,fV);fU=n.Return(null);}else{fY=fT.$0;L.FailWith(fY);fU=n.Return(null);}return fU;});});});},renderGamesHeaderRow:function(fZ){var f0,go;f0=k.toList(k.delay(function(){var f2,f3;f2=d.ofArray([c.TextNode("\u2116")]);f3=c.Element("td",[],f2);return k.append([C.doc(f3)],k.delay(function(){var f5,f6;f5=d.ofArray([c.TextNode("1")]);f6=c.Element("td",[],f5);return k.append([C.doc(f6)],k.delay(function(){var f8,f9,f_;if(fZ){f9=$.New(h,{$:0});f_=c.Element("td",[],f9);f8=[C.doc(f_)];}else{f8=k.empty();}return k.append(f8,k.delay(function(){var ga,gb;ga=d.ofArray([c.TextNode("2")]);gb=c.Element("td",[],ga);return k.append([C.doc(gb)],k.delay(function(){var gd,ge;gd=$.New(h,{$:0});ge=c.Element("td",[],gd);return k.append([C.doc(ge)],k.delay(function(){var gg;gg=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("1")]));return k.append([C.doc(gg)],k.delay(function(){var gi;gi=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("×")]));return k.append([C.doc(gi)],k.delay(function(){var gk;gk=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("2")]));return k.append([C.doc(gk)],k.delay(function(){var gm,gn;gm=d.ofArray([c.TextNode("GPB")]);gn=c.Element("td",[],gm);return[C.doc(gn)];}));}));}));}));}));}));}));}));}));go=d.ofArray([i.Class("coupon-header-row")]);return c.Element("tr",go,f0);},renderMeetup:function(gp,gq,gr){var gs,gt,gu,gv,gw,gx,gy,gz,gH,gI,gJ,gR,gS,gT,gU,gV,gW,g4,g5,g6,hc;gs=[gp,o.Get(gr.gameInfo).playMinute,gq];if(gs[0]){if(gs[1].$==0){gu=c.get_Empty();}else{if(gs[2].$==1){gw=gs[2].$0;if(gw!==""?gw!==o.Get(gr.country):false){gs[2].$0;gx=c.get_Empty();}else{gy=gr.gameInfo.get_View();gz=function(gA){var gB,gD,gE,gF,gG;gB=function(gC){return gC.$==1;};gD=d.ofArray([gA.drawBack,gA.drawLay,gA.winBack,gA.winLay,gA.loseBack,gA.loseLay]);if(k.exists(gB,gD)){gF=C.renderMeetup1(gr,gq.$==1);gG=c.Element("tr",[],gF);gE=C.doc(gG);}else{gE=c.get_Empty();}return gE;};gH=q.Map(gz,gy);gx=c.EmbedView(gH);}gv=gx;}else{gI=gr.gameInfo.get_View();gJ=function(gK){var gL,gN,gO,gP,gQ;gL=function(gM){return gM.$==1;};gN=d.ofArray([gK.drawBack,gK.drawLay,gK.winBack,gK.winLay,gK.loseBack,gK.loseLay]);if(k.exists(gL,gN)){gP=C.renderMeetup1(gr,gq.$==1);gQ=c.Element("tr",[],gP);gO=C.doc(gQ);}else{gO=c.get_Empty();}return gO;};gR=q.Map(gJ,gI);gv=c.EmbedView(gR);}gu=gv;}gt=gu;}else{if(gs[2].$==1){gT=gs[2].$0;if(gT!==""?gT!==o.Get(gr.country):false){gs[2].$0;gU=c.get_Empty();}else{gV=gr.gameInfo.get_View();gW=function(gX){var gY,g0,g1,g2,g3;gY=function(gZ){return gZ.$==1;};g0=d.ofArray([gX.drawBack,gX.drawLay,gX.winBack,gX.winLay,gX.loseBack,gX.loseLay]);if(k.exists(gY,g0)){g2=C.renderMeetup1(gr,gq.$==1);g3=c.Element("tr",[],g2);g1=C.doc(g3);}else{g1=c.get_Empty();}return g1;};g4=q.Map(gW,gV);gU=c.EmbedView(g4);}gS=gU;}else{g5=gr.gameInfo.get_View();g6=function(g7){var g8,g_,g$,ha,hb;g8=function(g9){return g9.$==1;};g_=d.ofArray([g7.drawBack,g7.drawLay,g7.winBack,g7.winLay,g7.loseBack,g7.loseLay]);if(k.exists(g8,g_)){ha=C.renderMeetup1(gr,gq.$==1);hb=c.Element("tr",[],ha);g$=C.doc(hb);}else{g$=c.get_Empty();}return g$;};hc=q.Map(g6,g5);gS=c.EmbedView(hc);}gt=gS;}return gt;},renderMeetup1:function(hd,he){var hf,hj;hf=function(hg){var hh,hi;hh=hd.gameInfo.get_View();hi=q.Map(hg,hh);return c.TextView(hi);};hj=function(hk,hl){var hm;hm=c.Element("td",d.ofArray([j.Create("class",hk?"kef kef-back":"kef kef-lay")]),d.ofArray([hf(hl)]));return C.doc(hm);};return k.toList(k.delay(function(){var ho,ht;ho=d.ofArray([hf(function(hp){var hq,hr,hs;hq=hp.order;hr=hq[0];hs=hq[1];return $$.String(hr)+"."+$$.String(hs);})]);ht=c.Element("td",[],ho);return k.append([C.doc(ht)],k.delay(function(){var hv;hv=c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(hd.game.home)]));return k.append([C.doc(hv)],k.delay(function(){var hx,hy;hx=hd.gameInfo.get_View();hy=q.Map(function(hz){var hA,hB;if(hz.playMinute.$==1){hz.playMinute.$0;hB=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(hz.summary)]));hA=C.doc(hB);}else{hA=c.get_Empty();}return hA;},hx);return k.append([c.EmbedView(hy)],k.delay(function(){var hD;hD=c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(hd.game.away)]));return k.append([C.doc(hD)],k.delay(function(){var hF;hF=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([hf(function(hG){return hG.status;})]));return k.append([C.doc(hF)],k.delay(function(){return k.append([hj(true,function(hI){return I.formatDecimalOption(hI.winBack);})],k.delay(function(){return k.append([hj(false,function(hK){return I.formatDecimalOption(hK.winLay);})],k.delay(function(){return k.append([hj(true,function(hM){return I.formatDecimalOption(hM.drawBack);})],k.delay(function(){return k.append([hj(false,function(hO){return I.formatDecimalOption(hO.drawLay);})],k.delay(function(){return k.append([hj(true,function(hQ){return I.formatDecimalOption(hQ.loseBack);})],k.delay(function(){return k.append([hj(false,function(hS){return I.formatDecimalOption(hS.loseLay);})],k.delay(function(){var hU,hV,h1;hU=hd.totalMatched.get_View();hV=function(hW){var hX,hY,hZ,h0;if(hW.$==1){hY=hW.$0;h0=$$.String(hY);hZ=c.Element("td",d.ofArray([j.Create("class","game-gpb")]),d.ofArray([c.TextNode(h0)]));hX=C.doc(hZ);}else{hX=c.get_Empty();}return hX;};h1=q.Map(hV,hU);return k.append([c.EmbedView(h1)],k.delay(function(){var h3,h4;if(!he){h4=c.Element("td",d.ofArray([j.Create("class","game-country")]),d.ofArray([c.TextView(hd.country.get_View())]));h3=[C.doc(h4)];}else{h3=k.empty();}return h3;}));}));}));}));}));}));}));}));}));}));}));}));}));},renderMeetups:function(){var h5,h6,h7;h5=q.get_Do();h6=C.meetups().get_View();h7=E.Bind(function(h8){var h9;h9=C.varInplayOnly().get_View();return E.Bind(function(h_){var h$;h$=C.varSelectedCountry().get_View();return E.Bind(function(ia){var ib,id,ie,_if,ig,ih,ii,ij,ik,im;ib=function(ic){return H.inplay(ic);};id=k.exists(ib,h8);ig=C.renderGamesHeaderRow(id);_if=d.ofArray([C.doc(ig)]);ih=[h_,ia];ii=ih[0];ij=ih[1];ik=function(il){return C.renderMeetup(ii,ij,il);};im=k.map(ik,h8);ie=d.ofArray([c.Element("thead",[],_if),c.Element("tbody",[],im)]);return E.Const(c.Element("table",[],ie));},h$);},h9);},h6);return c.EmbedView(h7);},renderMenuCountries:function(){var _in,iq,iA;q.get_Do();_in=E.Bind(function(io){return E.Bind(function(ip){return E.Const([io,ip]);},C.varSelectedCountry().get_View());},C.viewCountries());iq=function(ir){var is,it,iu,iv,ix,iy,iz;is=ir[0];it=ir[1];if(k.isEmpty(is)){iu=c.get_Empty();}else{iv=function(iw){return C.renderMenuItemCountry(it,iw);};ix=k.map(iv,is);iy=c.Concat(ix);iz=C.renderMenuItemAllCountries();iu=c.Append(iz,iy);}return iu;};iA=q.Map(iq,_in);return c.EmbedView(iA);},renderMenuItemAllCountries:function(){var iB,iC,iM;iB=C.varSelectedCountry().get_View();iC=function(iD){return c.Element("a",k.toList(k.delay(function(){var iF,iG,iH;if(iD.$==1){iG=iD.$0;if(iG!==""){iD.$0;iH=k.empty();}else{iH=[j.Create("class","active")];}iF=iH;}else{iF=[j.Create("class","active")];}return k.append(iF,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:0});};})];}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u0441\u0442\u0440\u0430\u043d\u044b")]));};iM=q.Map(iC,iB);return c.EmbedView(iM);},renderMenuItemCountry:function(iN,iO){return c.Element("a",k.toList(k.delay(function(){var iQ,iR,iS;if(iN.$==1){iR=iN.$0;if(iR===iO){iN.$0;iS=[j.Create("class","active")];}else{iS=k.empty();}iQ=iS;}else{iQ=k.empty();}return k.append(iQ,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:1,$0:iO});};})];}));}));})),d.ofArray([c.TextNode(iO)]));},renderMenusInplay:function(){var iX,iY,jc;iX=C.varInplayOnly().get_View();iY=function(iZ){var i0,i2,jb;i0=function(i1){return i1;};i2=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),true);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return iZ?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),false);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return!iZ?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);jb=d.map(i0,i2);return c.Concat(jb);};jc=q.Map(iY,iX);return c.EmbedView(jc);},tryGetCountry:function(jd,je){var jf,jg,jh,ji,jj,jk,jl;jf=[jd,je];jg=jf[0];jh=jf[1];ji=C.tryGetEvent(jg,jh);if(ji.$==1){if(ji.$0.country.$==1){jl=ji.$0.country.$0;jk=jl;}else{jk="";}jj=jk;}else{jj="";}return jj;},tryGetEvent:function(jm,jn){var jo,jp,js;jo=[jm,jn];jp=function(jq){var jr;jr=jq.gameId;return w.Equals(jo,jr);};js=o.Get(C.eventsCatalogue().Var);return k.tryFind(jp,js);},updateCoupon:function(jt,ju,jv){var jw,jx,jy,jB,jC,jD,jE,jG,jJ,jK;jw=jt.$==0;if(!jw){jy=function(jz){var jA;jA="adding new games "+$$.String(jz);return G?G.log(jA):undefined;};jB=jt.get_Length();jy(jB);jx=C.addNewGames(jt);}else{jx=null;}jC=k.isEmpty(jv);if(!jC){jE=function(jF){return C.meetups().RemoveByKey(jF);};k.iter(jE,jv);jG=function(jH){var jI;jI="removing out games "+$$.String(jH);return G?G.log(jI):undefined;};jJ=k.length(jv);jD=jG(jJ);}else{jD=null;}jK=function(jL){var jM,jN,jO,jP,jQ,jR;jM=jL[0];jN=jL[1];jO=jL[2];jP=C.meetups().TryFindByKey(jM);if(jP.$==1){jR=jP.$0;o.Set(jR.gameInfo,jN);jQ=void(jR.hash=jO);}else{jQ=null;}return jQ;};return k.iter(jK,ju);},updateTotalMatched:function(jS,jT,jU){var jV,jW,jX,jY;jV=[jS,jT];jW=C.meetups().TryFindByKey(jV);if(jW.$==1){jY=jW.$0;jX=o.Set(jY.totalMatched,jU);}else{jX=null;}return jX;},varDataRecived:$.Field(function(){return m.Create(false);}),varInplayOnly:$.Field(function(){return m.Create(true);}),varSelectedCountry:$.Field(function(){return m.Create({$:0});}),viewCountries:function(){var jZ,j0;jZ=q.get_Do();j0=C.eventsCatalogue().get_View();return E.Bind(function(j1){var j2,j4,j5,j6;j2=function(j3){return[j3.gameId,j3];};j4=k.map(j2,j1);j5=N.OfArray(k.toArray(j4));j6=C.viewGames();return E.Bind(function(j7){var j8,kc,kd,ke,kg,kh,kj,kk;j8=function(j9){var j_,j$,kb;j_=j9[0];j9[1];j$=function(ka){return ka.country;};kb=j5.TryFind(j_.gameId);return p.map(j$,kb);};kc=k.choose(j8,j7);kd={$:0};ke=function(kf){return!w.Equals(kd,kf);};kg=k.filter(ke,kc);kh=function(ki){return ki;};kj=k.choose(kh,kg);kk=t.distinct(kj);return E.Const(k.sort(kk));},j6);},j0);},viewGames:$.Field(function(){var kl,km;kl=q.get_Do();km=C.meetups().get_View();return E.Bind(function(kn){var ko,kp;if(k.isEmpty(kn)){ko=E.Const(k.empty());}else{kp=C.varInplayOnly().get_View();ko=E.Bind(function(kq){var kr,kt,ky,kz;kr=function(ks){return!kq?true:o.Get(ks.gameInfo).playMinute.$==1;};kt=function(ku){var kv,kx;kv=function(kw){return[ku.game,kw];};kx=ku.gameInfo.get_View();return q.Map(kv,kx);};ky=k.filter(kr,kn);kz=k.map(kt,ky);return E.Bind(function(kA){return E.Const(kA);},E.Sequence(kz));},kp);}return ko;},km);})},Utils:{LocalStorage:{checkTodayKey:function(kB,kC){var kD,kE,kF,kG;kD=O.now();kE=J.getWithDef(kB,kD);if(kD-kE>1*86400000){J.clear(kC);J.set(kB,O.now());kG=function(kH){return function(kI){var kJ;kJ="local storage "+F.prettyPrint(kH)+" of "+F.prettyPrint(kI)+" is inspired";return G?G.log(kJ):undefined;};};(kG(kC))(kE);kF=kD;}else{kF=kE;}return kF;},clear:function(kK){return J.strg().removeItem(kK);},get:function(kL){var kM,kN,kO,kP,kQ;try{kN=J.strg().getItem(kL);kO=P.parse(kN);kM={$:1,$0:kO};}catch(kP){kQ=function(kR){return function(kS){var kT;kT="error getting from local storage, key "+F.prettyPrint(kR)+" : "+F.prettyPrint(kS);return G?G.log(kT):undefined;};};(kQ(kL))(kP);kM={$:0};}return kM;},getWithDef:function(kU,kV){var kW,kX,kY;kW=J.get(kU);if(kW.$==1){kY=kW.$0;kX=kY;}else{kX=kV;}return kX;},set:function(kZ,k0){var k1,k2,k3,k4;try{k2=P.stringify(k0);k1=J.strg().setItem(kZ,k2);}catch(k3){k4=function(k5){return function(k6){return function(k7){return L.FailWith("error setting to local storage, key "+F.prettyPrint(k5)+", value "+F.prettyPrint(k6)+" : "+F.prettyPrint(k7));};};};k1=((k4(kZ))(k0))(k3);}return k1;},strg:$.Field(function(){return Q.localStorage;})},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(k8){return I.trimEnd(k8.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(k9){var k_,k$;if(k9.$==1){k$=k9.$0;k_=I.formatDecimal(k$);}else{k_="";}return k_;},getDatePart:function(la){var lb;lb=new O(la.getTime());lb.setHours(0,0,0,0);return lb;},mkids:function(lc,ld){var le,lg,lh,li,lj;le=function(lf){return[ld(lf),lf];};lg=d.map(le,lc);lh=N.OfArray(k.toArray(lg));li=d.map(ld,lc);lj=R.New1(S.OfSeq(li));return[lj,lh];},trimEnd:function(lk,ll){var lm,ln,lo,lp,lq,lr,ls,lt,lu,lv,lw,lx;lm=[lk,ll];if(lm[0]===""){ln="";}else{if(lm[1].$==1){lp=lm[0];lm[1];lq=lm[1].$0;if(lp.charCodeAt(lp.length-1)===lq){lm[1].$0;ls=lm[1];lt=lm[0];lr=I.trimEnd(T.string(lt,{$:0},{$:1,$0:lt.length-2}),ls);}else{if(lm[1].$==1){lv=lm[0];lw=lm[1].$1;lu=I.trimEnd(lv,lw);}else{lu=L.Raise(U.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}lr=lu;}lo=lr;}else{lx=lm[0];lo=lx;}ln=lo;}return ln;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe($$.WebSharper.Seq);l=$.Safe(b.Key);m=$.Safe(b.Var);n=$.Safe($$.WebSharper.Concurrency);o=$.Safe(b.Var1);p=$.Safe($$.WebSharper.Option);q=$.Safe(b.View);r=$.Safe(g.Level);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe(b.Storage1);y=$.Safe($$.WebSharper.Json);z=$.Safe(y.Provider);A=$.Safe(z.Id);B=$.Safe(b.ListModel);C=$.Safe(f.Coupon);D=$.Safe(C.Work);E=$.Safe(b.View1);F=$.Safe($$.WebSharper.PrintfHelpers);G=$.Safe($$.console);H=$.Safe(C.Meetup);I=$.Safe(f.Utils);J=$.Safe(I.LocalStorage);K=$.Safe(C.EventCatalogue);L=$.Safe($$.WebSharper.Operators);M=$.Safe($$.WebSharper.Collections);N=$.Safe(M.MapModule);O=$.Safe($$.Date);P=$.Safe($$.JSON);Q=$.Safe($$.window);R=$.Safe(M.FSharpSet);S=$.Safe(M.BalancedTree);T=$.Safe($$.WebSharper.Slice);return U=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){J.strg();C.viewGames();C.varSelectedCountry();C.varInplayOnly();C.varDataRecived();C.meetups();C.eventsCatalogue();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
