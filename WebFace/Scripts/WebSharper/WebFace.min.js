(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({},{get_color:function(){return function(V){return V.$==1?["lightgrey","red"]:V.$==2?["lightgrey","green"]:["white","navy"];};}}),Render:function(){var W;W=$.New(h,{$:0});return c.Concat(d.ofArray([g.RenderCommandPrompt(),(g.op_SpliceUntyped())(c.Element("br",[],W)),g.RenderRecords()]));},RenderCommandPrompt:function(){var X;X=d.ofArray([(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("margin-left","10px")]),$.New(h,{$:0}))),(g.op_SpliceUntyped())(c.Element("label",d.ofArray([j.Create("for",g["cmd-input"]())]),d.ofArray([c.TextNode("Input here:")]))),g.renderInput()]);return c.Concat(X);},RenderMenu:function(){var Y,_0,_9;Y=function(Z){return Z;};_0=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([c.TextNode("Clear console")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([c.TextNode("Clear history")]))]);_9=d.map(Y,_0);return c.Concat(_9);},RenderRecords:function(){var _,bd;_=function(ba){var bb,bc;bc=$.New(h,{$:0});bb=d.ofArray([(g.renderRecord())(ba),(g.op_SpliceUntyped())(c.Element("br",[],bc))]);return c.Concat(bb);};bd=g.varConsole().get_View();return c.ConvertSeq(_,bd);},addRecord:function(bd,be){return g.varConsole().Add({Id:l.Fresh(),Text:be,Level:bd});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bf){return bf.Id;},doc:function(bg){return bg;},op_SpliceUntyped:$.Field(function(){return function(bh){return g.doc(bh);};}),recordKey:function(bi){return bi.Id;},renderInput:function(){var bj,bk,bl,bm,bp,bs,bw,bx,bL;bj=m.Create("");bk=m.Create(null);bl=m.Create(false);bm=n.Delay(function(){o.Set(bl,true);return n.Bind(g.send(o.Get(bj)),function(){o.Set(bl,false);o.Set(bj,"");return n.Return(null);});});bp=function(bq){var br;br={$:1,$0:bq};g.varCmd=function(){return br;};return o.Set(bj,bq.Text);};bs=function(bt){var bu,bv;bu=g.tryGetCommandFromHistory(bt);bv=p.map(bp,bu);return;};bw=bl.get_View();bx=function(by){var bz;bz=d.ofArray([c.Input(k.toList(k.delay(function(){return k.append([j.Create("id",g["cmd-input"]())],k.delay(function(){return k.append(by?[j.Create("disabled","disabled")]:k.empty(),k.delay(function(){return k.append([i.Style("width","80%")],k.delay(function(){return k.append([i.CustomVar(bk,function(bE){return function(){return bE.focus();};},function(){return{$:0};})],k.delay(function(){return[i.Handler("keydown",function(){return function(bJ){var bK;bK=bJ.keyCode;return bK===13?n.Start(bm,{$:0}):bK===38?bs(true):bK===40?bs(false):null;};})];}));}));}));}));})),bj)]);return c.Concat(bz);};bL=q.Map(bx,bw);return c.EmbedView(bL);},renderRecord:$.Field(function(){var bM;bM=function(bN){var bO,bP,bQ;bO=(r.get_color())(bN.Level);bP=bO[1];bQ=bO[0];return(g.op_SpliceUntyped())(c.Element("span",d.ofArray([i.Style("color",bP),i.Style("background",bQ)]),d.ofArray([c.TextNode(bN.Text)])));};return function(bR){var bS;bS=q.Map(bM,bR);return c.EmbedView(bS);};}),send:function(bT){return n.Delay(function(){var bV,bW,bX,bY,bZ,b0;bV=s.Trim(bT);g.addRecord($.New(r,{$:2}),bV);bX=o.Get(g.varCommandsHistory().Var);if(k.isEmpty(bX)){bY=true;}else{bZ=t.last(bX);bY=bZ.Text!==bV;}if(bY){g.varCommandsHistory().Add({Id:l.Fresh(),Text:bV});b0=n.Return(null);}else{b0=n.Return(null);}bW=b0;return n.Combine(bW,n.Delay(function(){return n.TryWith(n.Delay(function(){return n.Bind(v.Async("WebFace:1",[bV]),function(b3){var b4;b3[0];b4=b3[1];g.addRecord($.New(r,{$:0}),b4);return n.Return(null);});}),function(b5){g.addRecord($.New(r,{$:1}),b5.message);return n.Return(null);});}));});},tryGetCommandFromHistory:function(b6){var b7,b8,b9,b_,b$,ca,cb,ce,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;b7=o.Get(g.varCommandsHistory().Var);b8=k.length(b7);if(b8===0){b9={$:0};}else{if(g.varCmd().$==1){ca=g.varCmd().$0.Id;cb=function(cc){return function(cd){return[cd,cc];};};ce=function(cf){var cg,ch;cg=cf[0];cf[1];ch=cg.Id;return w.Equals(ch,ca);};ci=o.Get(g.varCommandsHistory().Var);cj=k.mapi(cb,ci);ck=k.tryFind(ce,cj);cl=[ck,b6];if(cl[0].$==1){if(cl[1]){cl[0].$0[0];co=cl[0].$0[1];if(b8>0?co<b8-1:false){cq=cl[0].$0[1];cl[0].$0[0];cp=cq+1;}else{if(cl[0].$==1){if(cl[1]){cs=cl[1]?b8-1:0;}else{cl[0].$0[0];ct=cl[0].$0[1];if(b8>0?ct>0:false){cv=cl[0].$0[1];cl[0].$0[0];cu=cv-1;}else{cu=cl[1]?b8-1:0;}cs=cu;}cr=cs;}else{cr=cl[1]?b8-1:0;}cp=cr;}cn=cp;}else{if(cl[0].$==1){if(cl[1]){cx=cl[1]?b8-1:0;}else{cl[0].$0[0];cy=cl[0].$0[1];if(b8>0?cy>0:false){cA=cl[0].$0[1];cl[0].$0[0];cz=cA-1;}else{cz=cl[1]?b8-1:0;}cx=cz;}cw=cx;}else{cw=cl[1]?b8-1:0;}cn=cw;}cm=cn;}else{if(cl[0].$==1){if(cl[1]){cC=cl[1]?b8-1:0;}else{cl[0].$0[0];cD=cl[0].$0[1];if(b8>0?cD>0:false){cF=cl[0].$0[1];cl[0].$0[0];cE=cF-1;}else{cE=cl[1]?b8-1:0;}cC=cE;}cB=cC;}else{cB=cl[1]?b8-1:0;}cm=cB;}b$=cm;}else{b$=b8-1;}b_=b$;cG=k.nth(b_,b7);b9={$:1,$0:cG};}return b9;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cH,cJ;cH=function(cI){return g.cmdKey(cI);};cJ=x.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0]]))()});return B.CreateWithStorage(cH,cJ);}),varConsole:$.Field(function(){var cK,cM;cK=function(cL){return g.recordKey(cL);};cM=x.LocalStorage("CentBetConsole",{Encode:(z.get_Default().EncodeRecord(undefined,[["Id",z.get_Default().EncodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().EncodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(z.get_Default().DecodeRecord(undefined,[["Id",z.get_Default().DecodeUnion(l,"$",[[0,[["$0","Item",A,0]]]]),0],["Text",A,0],["Level",z.get_Default().DecodeUnion(r,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return B.CreateWithStorage(cK,cM);})},Coupon:{EventCatalogue:$.Class({},{id:function(cN){return cN.gameId;}}),Meetup:$.Class({},{hasGPB:function(cO){return o.Get(cO.totalMatched).$==1;},id:function(cP){return cP.game.gameId;},inplay:function(cQ){return o.Get(cQ.gameInfo).playMinute.$==1;},notinplay:function(cR){return o.Get(cR.gameInfo).playMinute.$==0;},viewGameInfo:function(cS){return cS.gameInfo.get_View();}}),Render:function(){var cT,cU,cV,cW,cX,cZ,c0,c1,c2,c3,c5,c6,c7,c8,c9,c$,da,db,dc,dd,df,dg,dh,dn,dw;cT=["COUPON",5000,5000];cU=cT[0];cV=cT[1];cW=cT[2];cX=function(){return C.processCoupon();};D["new"](cU,cV,cW,cX);cZ=["EVENTS-CATALOGUE",10000,5000];c0=cZ[0];c1=cZ[1];c2=cZ[2];c3=function(){return C.processEvents();};D["new"](c0,c1,c2,c3);c5=["MARKETS-CATALOGUE",10000,5000];c6=c5[0];c7=c5[1];c8=c5[2];c9=function(){return C.processMarkets();};D["new"](c6,c7,c8,c9);c$=["TOTAL-MATCHED",10000,5000];da=c$[0];db=c$[1];dc=c$[2];dd=function(){return C.processTotalMatched();};D["new"](da,db,dc,dd);df=q.get_Do();dg=C.varInplayOnly().get_View();dh=E.Bind(function(di){return E.Bind(function(dj){return E.Bind(function(dk){var dl,dm;dl=k.isEmpty(dk);dm=!dl;return E.Const([dm,di,dj]);},C.meetups().get_View());},C.varDataRecived().get_View());},dg);dn=function(_do){var dp,dq,dr,ds,dt,du,dv;if(_do[2]){if(_do[0]){dr=d.ofArray([C.renderMeetups()]);dq=c.Element("table",$.New(h,{$:0}),d.ofArray([c.Element("tbody",[],dr)]));}else{if(_do[1]){dt=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0440\u0430\u0437\u044b\u0433\u0440\u044b\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0438\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445")]);ds=c.Element("h1",[],dt);}else{du=d.ofArray([c.TextNode("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0430\u0445 \u043d\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f")]);ds=c.Element("h1",[],du);}dq=ds;}dp=dq;}else{dv=d.ofArray([c.TextNode("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435.")]);dp=c.Element("h1",[],dv);}return dp;};dw=q.Map(dn,dh);return c.EmbedView(dw);},RenderMenu:function(){var dx;dx=d.ofArray([C.renderMenusInplay(),C.renderMenuCountries()]);return c.Concat(dx);},Work:$.Class({},{loop:function(dy){return n.Delay(function(){var dA;dA=n.Delay(function(){return n.Bind(dy.work.call(null,null),function(){return n.Bind(n.Sleep(dy.sleepInterval),function(){return n.Return(null);});});});return n.Combine(n.TryWith(dA,function(dE){var dF,dJ;dF=function(dG){return function(dH){var dI;dI="task error "+F.prettyPrint(dG)+" : "+F.prettyPrint(dH);return G?G.log(dI):undefined;};};dJ=dy.what;(dF(dJ))(dE);return n.Bind(n.Sleep(dy.sleepErrorInterval),function(){return n.Return(null);});}),n.Delay(function(){return D.loop(dy);}));});},"new":function(dM,dN,dO,dP){var dQ;dQ=$.New(D,{what:dM,sleepInterval:dN,sleepErrorInterval:dO,work:dP});return D.run(dQ);},run:function(dR){var dS;dS=n.Delay(function(){var dU,dX;dU=function(dV){var dW;dW="task "+F.prettyPrint(dV)+" : started";return G?G.log(dW):undefined;};dX=dR.what;dU(dX);return n.Bind(D.loop(dR),function(){var dZ,d2;dZ=function(d0){var d1;d1="task "+F.prettyPrint(d0)+" : terminated";return G?G.log(d1):undefined;};d2=dR.what;dZ(d2);return n.Return(null);});});return n.Start(dS,{$:0});}}),addNewGames:function(d3){var d4,d5,d6,ee,eg,ei,ej,ek;d4=o.Get(C.meetups().Var);d5=k.toList(d4);C.meetups().Clear();d6=function(d7){var d8,d9,d_,d$,ea,eb,ec,ed;d8=d7[0];d9=d7[1];d_=d7[2];d$=d8.gameId;ea=d$[0];eb=d$[1];ec=C.tryGetCountry(ea,eb);ed=m.Create(d9);return $.New(H,{game:d8,gameInfo:ed,country:m.Create(ec),totalMatched:m.Create({$:0}),hash:d_});};ee=function(ef){return o.Get(ef.gameInfo).order;};eg=function(eh){return C.meetups().Add(eh);};ei=d.map(d6,d3);ej=k.append(d5,ei);ek=k.sortBy(ee,ej);return k.iter(eg,ek);},doc:function(el){return el;},eventsCatalogue:$.Field(function(){var em,en,ep,eq,er,es;em=J.checkTodayKey("CentBetEventsCatalogueCreated","CentBetEventsCatalogue");en=function(eo){return K.id(eo);};eq=(z.get_Default().EncodeRecord(K,[["gameId",z.get_Default().EncodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().EncodeList(z.get_Default().EncodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))();ep=x.LocalStorage("CentBetEventsCatalogue",{Encode:eq,Decode:(z.get_Default().DecodeRecord(K,[["gameId",z.get_Default().DecodeTuple([A,A]),0],["country",A,1],["markets",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["marketId",A,0],["marketName",A,0],["runners",z.get_Default().DecodeList(z.get_Default().DecodeRecord(undefined,[["selectionId",A,0],["runnerName",A,0]])),0]])),0]]))()});er=B.CreateWithStorage(en,ep);es=function(et){return function(eu){return function(ev){var ew;ew=F.prettyPrint(et)+" - "+$$.String(eu)+", "+F.prettyPrint(ev);return G?G.log(ew):undefined;};};};((es("CentBetEventsCatalogue"))(er.get_Length()))(em);return er;}),meetups:$.Field(function(){var ex,ez;ex=function(ey){return H.id(ey);};ez=$.New(h,{$:0});return B.Create(ex,ez);}),processCoupon:function(){return n.Delay(function(){var eB,eD,eE,eF,eG;eB=function(eC){return[eC.game.gameId,eC.hash];};eD=o.Get(C.meetups().Var);eE=k.map(eB,eD);eF=k.toList(eE);eG=v.Async("WebFace:0",[eF,o.Get(C.varInplayOnly())]);return n.Bind(eG,function(eH){var eI,eJ,eK,eL;eI=eH[1];eJ=eH[2];eK=eH[0];if(!(eK.$==0)?true:!(eI.$==0)){o.Set(C.varDataRecived(),true);eL=n.Return(null);}else{eL=n.Return(null);}return n.Combine(eL,n.Delay(function(){C.updateCoupon(eK,eI,eJ);return n.Return(null);}));});});},processEvents:function(){return n.Delay(function(){var eO,eP,eQ,eV,eW,eX,eY;eO=o.Get(C.eventsCatalogue().Var);eP=o.Get(C.meetups().Var);eQ=function(eR){var eS,eU;eS=function(eT){return w.Equals(eT.gameId,eR.game.gameId);};eU=k.tryFind(eS,eO);return eU.$==0?{$:1,$0:eR.game.gameId}:{$:0};};eV=k.choose(eQ,eP);eW=k.toList(eV);if(eW.$==0){eX=n.Return(null);}else{eY=v.Async("WebFace:2",[eW]);eX=n.Bind(eY,function(eZ){var e0;e0=n.For(eZ,function(e1){var e2,e3;e1[1];e2=e1[0];e3=e1[2];C.eventsCatalogue().Add($.New(K,{gameId:e2,country:e3,markets:$.New(h,{$:0})}));return n.Return(null);});return n.Combine(e0,n.Delay(function(){return n.For(o.Get(C.meetups().Var),function(e5){var e6,e7,e8;e6=e5.game.gameId;e7=e6[0];e8=e6[1];o.Set(e5.country,C.tryGetCountry(e7,e8));return n.Return(null);});}));});}return eX;});},processMarkets:function(){return n.Delay(function(){var e_,fa,fb,fc;e_=function(e$){return e$.markets.$==0;};fa=o.Get(C.eventsCatalogue().Var);fb=k.filter(e_,fa);fc=k.toList(fb);return fc.$==0?n.Return(null):n.For(fc,function(fd){var fe,ff,fg,fh;fe=fd.gameId;ff=fe[0];fg=fe[1];fh=v.Async("WebFace:4",[ff,fg]);return n.Bind(fh,function(fi){var fj,fk,fl,fo,fp,fq,fr,fs,ft,fu,fv,fE,fF,fH,fI;if(fi.$==1){fk=fi.$0;fl=function(fm){var fn;fm[0];fm[1];fm[2];fn=fm[3];return fn;};fo=fd.gameId;fp=fo[0];fq=fo[1];fr=d.choose(fl,fk);if(fr.$==0){ft={$:0};}else{fu=k.sum(fr);ft={$:1,$0:fu};}fs=ft;C.updateTotalMatched(fp,fq,fs);fv=function(fw){var fx,fy,fz,fA;fx=fw[0];fy=fw[1];fz=fw[2];fw[3];fA=function(fB){var fC,fD;fC=fB[0];fD=fB[1];return{selectionId:fD,runnerName:fC};};return{marketId:fx,marketName:fy,runners:d.map(fA,fz)};};fE=d.map(fv,fk);fF=function(fG){return{$:1,$0:$.New(K,{gameId:fG.gameId,country:fG.country,markets:fE})};};fH=fd.gameId;C.eventsCatalogue().UpdateBy(fF,fH);fj=n.Return(null);}else{fI=fi.$0;L.FailWith(fI);fj=n.Return(null);}return fj;});});});},processTotalMatched:function(){return n.Delay(function(){var fK,fM,fN,fO;fK=function(fL){return fL.game.gameId;};fM=o.Get(C.meetups().Var);fN=k.map(fK,fM);fO=k.toList(fN);return fO.$==0?n.Return(null):n.For(fO,function(fP){var fQ,fR,fS;fQ=fP[0];fR=fP[1];fS=v.Async("WebFace:3",[fQ,fR]);return n.Bind(fS,function(fT){var fU,fV,fW,fX,fY;if(fT.$==1){fV=fT.$0;fW=fP[0];fX=fP[1];C.updateTotalMatched(fW,fX,fV);fU=n.Return(null);}else{fY=fT.$0;L.FailWith(fY);fU=n.Return(null);}return fU;});});});},renderGamesHeaderRow:function(fZ){var f0,gi;f0=k.toList(k.delay(function(){var f2,f3;f2=d.ofArray([c.TextNode("\u2116")]);f3=c.Element("td",[],f2);return k.append([C.doc(f3)],k.delay(function(){var f5,f6;f5=d.ofArray([c.TextNode("1")]);f6=c.Element("td",[],f5);return k.append([C.doc(f6)],k.delay(function(){var f8,f9,f_;if(fZ){f9=$.New(h,{$:0});f_=c.Element("td",[],f9);f8=[C.doc(f_)];}else{f8=k.empty();}return k.append(f8,k.delay(function(){var ga,gb;ga=d.ofArray([c.TextNode("2")]);gb=c.Element("td",[],ga);return k.append([C.doc(gb)],k.delay(function(){var gd;gd=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("1")]));return k.append([C.doc(gd)],k.delay(function(){var gf;gf=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("×")]));return k.append([C.doc(gf)],k.delay(function(){var gh;gh=c.Element("td",d.ofArray([j.Create("colspan","2")]),d.ofArray([c.TextNode("2")]));return[C.doc(gh)];}));}));}));}));}));}));}));gi=d.ofArray([i.Class("coupon-header-row")]);return c.Element("tr",gi,f0);},renderMeetup:function(gj,gk,gl){var gm,gn,go,gp,gq,gr,gs,gt,gB,gC,gD,gL,gM,gN,gO,gP,gQ,gY,gZ,g0,g8;gm=[gj,o.Get(gl.gameInfo).playMinute,gk];if(gm[0]){if(gm[1].$==0){go=c.get_Empty();}else{if(gm[2].$==1){gq=gm[2].$0;if(gq!==""?gq!==o.Get(gl.country):false){gm[2].$0;gr=c.get_Empty();}else{gs=gl.gameInfo.get_View();gt=function(gu){var gv,gx,gy,gz,gA;gv=function(gw){return gw.$==1;};gx=d.ofArray([gu.drawBack,gu.drawLay,gu.winBack,gu.winLay,gu.loseBack,gu.loseLay]);if(k.exists(gv,gx)){gz=C.renderMeetup1(gl,gk.$==1);gA=c.Element("tr",[],gz);gy=C.doc(gA);}else{gy=c.get_Empty();}return gy;};gB=q.Map(gt,gs);gr=c.EmbedView(gB);}gp=gr;}else{gC=gl.gameInfo.get_View();gD=function(gE){var gF,gH,gI,gJ,gK;gF=function(gG){return gG.$==1;};gH=d.ofArray([gE.drawBack,gE.drawLay,gE.winBack,gE.winLay,gE.loseBack,gE.loseLay]);if(k.exists(gF,gH)){gJ=C.renderMeetup1(gl,gk.$==1);gK=c.Element("tr",[],gJ);gI=C.doc(gK);}else{gI=c.get_Empty();}return gI;};gL=q.Map(gD,gC);gp=c.EmbedView(gL);}go=gp;}gn=go;}else{if(gm[2].$==1){gN=gm[2].$0;if(gN!==""?gN!==o.Get(gl.country):false){gm[2].$0;gO=c.get_Empty();}else{gP=gl.gameInfo.get_View();gQ=function(gR){var gS,gU,gV,gW,gX;gS=function(gT){return gT.$==1;};gU=d.ofArray([gR.drawBack,gR.drawLay,gR.winBack,gR.winLay,gR.loseBack,gR.loseLay]);if(k.exists(gS,gU)){gW=C.renderMeetup1(gl,gk.$==1);gX=c.Element("tr",[],gW);gV=C.doc(gX);}else{gV=c.get_Empty();}return gV;};gY=q.Map(gQ,gP);gO=c.EmbedView(gY);}gM=gO;}else{gZ=gl.gameInfo.get_View();g0=function(g1){var g2,g4,g5,g6,g7;g2=function(g3){return g3.$==1;};g4=d.ofArray([g1.drawBack,g1.drawLay,g1.winBack,g1.winLay,g1.loseBack,g1.loseLay]);if(k.exists(g2,g4)){g6=C.renderMeetup1(gl,gk.$==1);g7=c.Element("tr",[],g6);g5=C.doc(g7);}else{g5=c.get_Empty();}return g5;};g8=q.Map(g0,gZ);gM=c.EmbedView(g8);}gn=gM;}return gn;},renderMeetup1:function(g9,g_){var g$,hd;g$=function(ha){var hb,hc;hb=g9.gameInfo.get_View();hc=q.Map(ha,hb);return c.TextView(hc);};hd=function(he,hf){var hg;hg=c.Element("td",d.ofArray([j.Create("class",he?"kef kef-back":"kef kef-lay")]),d.ofArray([g$(hf)]));return C.doc(hg);};return k.toList(k.delay(function(){var hi,hn;hi=d.ofArray([g$(function(hj){var hk,hl,hm;hk=hj.order;hl=hk[0];hm=hk[1];return $$.String(hl)+"."+$$.String(hm);})]);hn=c.Element("td",[],hi);return k.append([C.doc(hn)],k.delay(function(){var hp;hp=c.Element("td",d.ofArray([j.Create("class","home-team")]),d.ofArray([c.TextNode(g9.game.home)]));return k.append([C.doc(hp)],k.delay(function(){var hr,hs;hr=g9.gameInfo.get_View();hs=q.Map(function(ht){var hu,hv;if(ht.playMinute.$==1){ht.playMinute.$0;hv=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([c.TextNode(ht.summary)]));hu=C.doc(hv);}else{hu=c.get_Empty();}return hu;},hr);return k.append([c.EmbedView(hs)],k.delay(function(){var hx;hx=c.Element("td",d.ofArray([j.Create("class","away-team")]),d.ofArray([c.TextNode(g9.game.away)]));return k.append([C.doc(hx)],k.delay(function(){var hz;hz=c.Element("td",d.ofArray([j.Create("class","game-status")]),d.ofArray([g$(function(hA){return hA.status;})]));return k.append([C.doc(hz)],k.delay(function(){return k.append([hd(true,function(hC){return I.formatDecimalOption(hC.winBack);})],k.delay(function(){return k.append([hd(false,function(hE){return I.formatDecimalOption(hE.winLay);})],k.delay(function(){return k.append([hd(true,function(hG){return I.formatDecimalOption(hG.drawBack);})],k.delay(function(){return k.append([hd(false,function(hI){return I.formatDecimalOption(hI.drawLay);})],k.delay(function(){return k.append([hd(true,function(hK){return I.formatDecimalOption(hK.loseBack);})],k.delay(function(){return k.append([hd(false,function(hM){return I.formatDecimalOption(hM.loseLay);})],k.delay(function(){var hO,h1;hO=k.toList(k.delay(function(){var hQ,hR,hX;hQ=g9.totalMatched.get_View();hR=function(hS){var hT,hU,hV,hW;if(hS.$==1){hU=hS.$0;hW=$$.String(hU);hV=c.Element("span",d.ofArray([j.Create("class","game-gpb")]),d.ofArray([c.TextNode(hW)]));hT=C.doc(hV);}else{hT=c.get_Empty();}return hT;};hX=q.Map(hR,hQ);return k.append([c.EmbedView(hX)],k.delay(function(){var hZ,h0;if(!g_){h0=c.Element("span",d.ofArray([j.Create("class","game-coubtry")]),d.ofArray([c.TextView(g9.country.get_View())]));hZ=[C.doc(h0)];}else{hZ=k.empty();}return hZ;}));}));h1=c.Element("td",[],hO);return[C.doc(h1)];}));}));}));}));}));}));}));}));}));}));}));}));},renderMeetups:function(){var h2,h3,h4;h2=q.get_Do();h3=C.meetups().get_View();h4=E.Bind(function(h5){var h6;h6=C.varInplayOnly().get_View();return E.Bind(function(h7){var h8;h8=C.varSelectedCountry().get_View();return E.Bind(function(h9){var h_,ia,ib,ic,id,ie,_if,ig,ih,ij;h_=function(h$){return H.inplay(h$);};ia=k.exists(h_,h5);id=C.renderGamesHeaderRow(ia);ic=d.ofArray([C.doc(id)]);ie=[h7,h9];_if=ie[0];ig=ie[1];ih=function(ii){return C.renderMeetup(_if,ig,ii);};ij=k.map(ih,h5);ib=d.ofArray([c.Element("thead",[],ic),c.Element("tbody",[],ij)]);return E.Const(c.Element("table",[],ib));},h8);},h6);},h3);return c.EmbedView(h4);},renderMenuCountries:function(){var ik,_in,ix;q.get_Do();ik=E.Bind(function(il){return E.Bind(function(im){return E.Const([il,im]);},C.varSelectedCountry().get_View());},C.viewCountries());_in=function(io){var ip,iq,ir,is,iu,iv,iw;ip=io[0];iq=io[1];if(k.isEmpty(ip)){ir=c.get_Empty();}else{is=function(it){return C.renderMenuItemCountry(iq,it);};iu=k.map(is,ip);iv=c.Concat(iu);iw=C.renderMenuItemAllCountries();ir=c.Append(iw,iv);}return ir;};ix=q.Map(_in,ik);return c.EmbedView(ix);},renderMenuItemAllCountries:function(){var iy,iz,iJ;iy=C.varSelectedCountry().get_View();iz=function(iA){return c.Element("a",k.toList(k.delay(function(){var iC,iD,iE;if(iA.$==1){iD=iA.$0;if(iD!==""){iA.$0;iE=k.empty();}else{iE=[j.Create("class","active")];}iC=iE;}else{iC=[j.Create("class","active")];}return k.append(iC,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:0});};})];}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u0441\u0442\u0440\u0430\u043d\u044b")]));};iJ=q.Map(iz,iy);return c.EmbedView(iJ);},renderMenuItemCountry:function(iK,iL){return c.Element("a",k.toList(k.delay(function(){var iN,iO,iP;if(iK.$==1){iO=iK.$0;if(iO===iL){iK.$0;iP=[j.Create("class","active")];}else{iP=k.empty();}iN=iP;}else{iN=k.empty();}return k.append(iN,k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return[i.Handler("click",function(){return function(){return o.Set(C.varSelectedCountry(),{$:1,$0:iL});};})];}));}));})),d.ofArray([c.TextNode(iL)]));},renderMenusInplay:function(){var iU,iV,i$;iU=C.varInplayOnly().get_View();iV=function(iW){var iX,iZ,i_;iX=function(iY){return iY;};iZ=d.ofArray([c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),true);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return iW?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),c.Element("a",k.toList(k.delay(function(){return k.append([j.Create("href","#")],k.delay(function(){return k.append([i.Handler("click",function(){return function(){o.Set(C.varSelectedCountry(),{$:0});o.Set(C.varInplayOnly(),false);return o.Set(C.varDataRecived(),false);};})],k.delay(function(){return!iW?[j.Create("class","active")]:k.empty();}));}));})),d.ofArray([c.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);i_=d.map(iX,iZ);return c.Concat(i_);};i$=q.Map(iV,iU);return c.EmbedView(i$);},tryGetCountry:function(ja,jb){var jc,jd,je,jf,jg,jh,ji;jc=[ja,jb];jd=jc[0];je=jc[1];jf=C.tryGetEvent(jd,je);if(jf.$==1){if(jf.$0.country.$==1){ji=jf.$0.country.$0;jh=ji;}else{jh="";}jg=jh;}else{jg="";}return jg;},tryGetEvent:function(jj,jk){var jl,jm,jp;jl=[jj,jk];jm=function(jn){var jo;jo=jn.gameId;return w.Equals(jl,jo);};jp=o.Get(C.eventsCatalogue().Var);return k.tryFind(jm,jp);},updateCoupon:function(jq,jr,js){var jt,ju,jv,jy,jz,jA,jB,jD,jG,jH;jt=jq.$==0;if(!jt){jv=function(jw){var jx;jx="adding new games "+$$.String(jw);return G?G.log(jx):undefined;};jy=jq.get_Length();jv(jy);ju=C.addNewGames(jq);}else{ju=null;}jz=k.isEmpty(js);if(!jz){jB=function(jC){return C.meetups().RemoveByKey(jC);};k.iter(jB,js);jD=function(jE){var jF;jF="removing out games "+$$.String(jE);return G?G.log(jF):undefined;};jG=k.length(js);jA=jD(jG);}else{jA=null;}jH=function(jI){var jJ,jK,jL,jM,jN,jO;jJ=jI[0];jK=jI[1];jL=jI[2];jM=C.meetups().TryFindByKey(jJ);if(jM.$==1){jO=jM.$0;o.Set(jO.gameInfo,jK);jN=void(jO.hash=jL);}else{jN=null;}return jN;};return k.iter(jH,jr);},updateTotalMatched:function(jP,jQ,jR){var jS,jT,jU,jV;jS=[jP,jQ];jT=C.meetups().TryFindByKey(jS);if(jT.$==1){jV=jT.$0;jU=o.Set(jV.totalMatched,jR);}else{jU=null;}return jU;},varDataRecived:$.Field(function(){return m.Create(false);}),varInplayOnly:$.Field(function(){return m.Create(true);}),varSelectedCountry:$.Field(function(){return m.Create({$:0});}),viewCountries:function(){var jW,jX;jW=q.get_Do();jX=C.eventsCatalogue().get_View();return E.Bind(function(jY){var jZ,j1,j2,j3;jZ=function(j0){return[j0.gameId,j0];};j1=k.map(jZ,jY);j2=N.OfArray(k.toArray(j1));j3=C.viewGames();return E.Bind(function(j4){var j5,j$,ka,kb,kd,ke,kg,kh;j5=function(j6){var j7,j8,j_;j7=j6[0];j6[1];j8=function(j9){return j9.country;};j_=j2.TryFind(j7.gameId);return p.map(j8,j_);};j$=k.choose(j5,j4);ka={$:0};kb=function(kc){return!w.Equals(ka,kc);};kd=k.filter(kb,j$);ke=function(kf){return kf;};kg=k.choose(ke,kd);kh=t.distinct(kg);return E.Const(k.sort(kh));},j3);},jX);},viewGames:$.Field(function(){var ki,kj;ki=q.get_Do();kj=C.meetups().get_View();return E.Bind(function(kk){var kl,km;if(k.isEmpty(kk)){kl=E.Const(k.empty());}else{km=C.varInplayOnly().get_View();kl=E.Bind(function(kn){var ko,kq,kv,kw;ko=function(kp){return!kn?true:o.Get(kp.gameInfo).playMinute.$==1;};kq=function(kr){var ks,ku;ks=function(kt){return[kr.game,kt];};ku=kr.gameInfo.get_View();return q.Map(ks,ku);};kv=k.filter(ko,kk);kw=k.map(kq,kv);return E.Bind(function(kx){return E.Const(kx);},E.Sequence(kw));},km);}return kl;},kj);})},Utils:{LocalStorage:{checkTodayKey:function(ky,kz){var kA,kB,kC,kD;kA=O.now();kB=J.getWithDef(ky,kA);if(kA-kB>1*86400000){J.clear(kz);J.set(ky,O.now());kD=function(kE){return function(kF){var kG;kG="local storage "+F.prettyPrint(kE)+" of "+F.prettyPrint(kF)+" is inspired";return G?G.log(kG):undefined;};};(kD(kz))(kB);kC=kA;}else{kC=kB;}return kC;},clear:function(kH){return J.strg().removeItem(kH);},get:function(kI){var kJ,kK,kL,kM,kN;try{kK=J.strg().getItem(kI);kL=P.parse(kK);kJ={$:1,$0:kL};}catch(kM){kN=function(kO){return function(kP){var kQ;kQ="error getting from local storage, key "+F.prettyPrint(kO)+" : "+F.prettyPrint(kP);return G?G.log(kQ):undefined;};};(kN(kI))(kM);kJ={$:0};}return kJ;},getWithDef:function(kR,kS){var kT,kU,kV;kT=J.get(kR);if(kT.$==1){kV=kT.$0;kU=kV;}else{kU=kS;}return kU;},set:function(kW,kX){var kY,kZ,k0,k1;try{kZ=P.stringify(kX);kY=J.strg().setItem(kW,kZ);}catch(k0){k1=function(k2){return function(k3){return function(k4){return L.FailWith("error setting to local storage, key "+F.prettyPrint(k2)+", value "+F.prettyPrint(k3)+" : "+F.prettyPrint(k4));};};};kY=((k1(kW))(kX))(k0);}return kY;},strg:$.Field(function(){return Q.localStorage;})},dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(k5){return I.trimEnd(k5.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(k6){var k7,k8;if(k6.$==1){k8=k6.$0;k7=I.formatDecimal(k8);}else{k7="";}return k7;},getDatePart:function(k9){var k_;k_=new O(k9.getTime());k_.setHours(0,0,0,0);return k_;},mkids:function(k$,la){var lb,ld,le,lf,lg;lb=function(lc){return[la(lc),lc];};ld=d.map(lb,k$);le=N.OfArray(k.toArray(ld));lf=d.map(la,k$);lg=R.New1(S.OfSeq(lf));return[lg,le];},trimEnd:function(lh,li){var lj,lk,ll,lm,ln,lo,lp,lq,lr,ls,lt,lu;lj=[lh,li];if(lj[0]===""){lk="";}else{if(lj[1].$==1){lm=lj[0];lj[1];ln=lj[1].$0;if(lm.charCodeAt(lm.length-1)===ln){lj[1].$0;lp=lj[1];lq=lj[0];lo=I.trimEnd(T.string(lq,{$:0},{$:1,$0:lq.length-2}),lp);}else{if(lj[1].$==1){ls=lj[0];lt=lj[1].$1;lr=I.trimEnd(ls,lt);}else{lr=L.Raise(U.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}lo=lr;}ll=lo;}else{lu=lj[0];ll=lu;}lk=ll;}return lk;}}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.UI);b=$.Safe(a.Next);c=$.Safe(b.Doc);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe(d.T);i=$.Safe(b.AttrModule);j=$.Safe(b.AttrProxy);k=$.Safe($$.WebSharper.Seq);l=$.Safe(b.Key);m=$.Safe(b.Var);n=$.Safe($$.WebSharper.Concurrency);o=$.Safe(b.Var1);p=$.Safe($$.WebSharper.Option);q=$.Safe(b.View);r=$.Safe(g.Level);s=$.Safe($$.WebSharper.Strings);t=$.Safe($$.Seq);u=$.Safe($$.WebSharper.Remoting);v=$.Safe(u.AjaxRemotingProvider);w=$.Safe($$.WebSharper.Unchecked);x=$.Safe(b.Storage1);y=$.Safe($$.WebSharper.Json);z=$.Safe(y.Provider);A=$.Safe(z.Id);B=$.Safe(b.ListModel);C=$.Safe(f.Coupon);D=$.Safe(C.Work);E=$.Safe(b.View1);F=$.Safe($$.WebSharper.PrintfHelpers);G=$.Safe($$.console);H=$.Safe(C.Meetup);I=$.Safe(f.Utils);J=$.Safe(I.LocalStorage);K=$.Safe(C.EventCatalogue);L=$.Safe($$.WebSharper.Operators);M=$.Safe($$.WebSharper.Collections);N=$.Safe(M.MapModule);O=$.Safe($$.Date);P=$.Safe($$.JSON);Q=$.Safe($$.window);R=$.Safe(M.FSharpSet);S=$.Safe(M.BalancedTree);T=$.Safe($$.WebSharper.Slice);return U=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){J.strg();C.viewGames();C.varSelectedCountry();C.varInplayOnly();C.varDataRecived();C.meetups();C.eventsCatalogue();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
