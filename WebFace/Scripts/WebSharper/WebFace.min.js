(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({get_s1:function(){return this.$==2?">":"<";}},{get_color:function(){return function(R){return R.$==1?["lightgrey","red"]:R.$==2?["lightgrey","green"]:["white","navy"];};}}),LocalStorage:$.Class({Get:function(S){var T,U,V,W,X;try{U=this.strg.getItem(S);V=a.parse(U);T={$:0,$0:V};}catch(W){X=this.strg;T={$:1,$0:"local storage get item "+b.prettyPrint(S)+" error : "+b.prettyPrint(W)+", storage "+b.prettyPrint(X)};}return T;},Set:function(Y,Z){var _0,_1,_2,_3;try{_1=a.stringify(Z);_0={$:0,$0:this.strg.setItem(Y,_1)};}catch(_2){_3=this.strg;_0={$:1,$0:"local storage set item "+b.prettyPrint(Y)+" error : "+b.prettyPrint(_2)+", value "+b.prettyPrint(Z)+", storage "+b.prettyPrint(_3)};}return _0;}},{New:function(){var _5;_5=$.New(this,{});_5.strg=c.localStorage;return _5;}}),RenderCommandPrompt:function(){var _6;_6=d.ofArray([(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("margin-left","10px")]),$.New(l,{$:0}))),(g.op_SpliceUntyped())(j.Element("label",d.ofArray([m.Create("for",g["cmd-input"]())]),d.ofArray([j.TextNode("Input here:")]))),g.renderInput()]);return j.Concat(_6);},RenderConsole:function(){var _7,ba;_7=function(_8){var _9,_;_=$.New(l,{$:0});_9=d.ofArray([(g.renderRecord())(_8),(g.op_SpliceUntyped())(j.Element("br",[],_))]);return j.Concat(_9);};ba=g.varConsole().get_View();return j.ConvertSeq(_7,ba);},RenderMenu:function(){return j.Concat(d.map(function(ba){return ba;},d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([j.TextNode("Clear console")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([j.TextNode("Clear history")]))])));},addRecord:function(bj,bk){return g.varConsole().Add({Id:o.Fresh(),Text:bk,Level:bj});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bl){return bl.Id;},doc:function(bm){return bm;},op_SpliceUntyped:$.Field(function(){return function(bn){return g.doc(bn);};}),recordKey:function(bo){return bo.Id;},renderInput:function(){var bp,bq,br,bs,bv,bI,bJ,bW;bp=p.Create("");bq=p.Create(null);br=p.Create(false);bs=q.Delay(function(){r.Set(br,true);return q.Bind(g.send(r.Get(bp)),function(){r.Set(br,false);r.Set(bp,"");return q.Return(null);});});bv=function(bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;if(bw==="Enter"){bx=q.Start(bs,{$:0});}else{if(bw==="Up"){bz=g.tryGetCommandFromHistory(bw==="Up");if(bz.$==1){bB=bz.$0;bC={$:1,$0:bB};g.varCmd=function(){return bC;};bA=r.Set(bp,bB.Text);}else{bA=null;}by=bA;}else{if(bw==="Down"){bE=g.tryGetCommandFromHistory(bw==="Up");if(bE.$==1){bG=bE.$0;bH={$:1,$0:bG};g.varCmd=function(){return bH;};bF=r.Set(bp,bG.Text);}else{bF=null;}bD=bF;}else{bD=null;}by=bD;}bx=by;}return bx;};bI=br.get_View();bJ=function(bK){return j.Input(n.toList(n.delay(function(){return n.append([m.Create("id",g["cmd-input"]())],n.delay(function(){return n.append(bK?[m.Create("disabled","disabled")]:n.empty(),n.delay(function(){return n.append([k.Style("width","80%")],n.delay(function(){return n.append([k.CustomVar(bq,function(bP){return function(){return bP.focus();};},function(){return{$:0};})],n.delay(function(){var bT;bT=function(){return function(bV){return bv(bV.keyIdentifier);};};return[k.Handler("keydown",bT)];}));}));}));}));})),bp);};bW=s.Map(bJ,bI);return j.EmbedView(bW);},renderRecord:$.Field(function(){var bX;bX=function(bY){var bZ,b0,b1;bZ=(t.get_color())(bY.Level);b0=bZ[1];b1=bZ[0];return(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("color",b0),k.Style("background",b1)]),d.ofArray([j.TextNode(bY.Level.get_s1()+" "+bY.Text)])));};return function(b2){var b3;b3=s.Map(bX,b2);return j.EmbedView(b3);};}),send:function(b4){return q.Delay(function(){var b6,b7,b8,b9,b_,b$;b6=u.Trim(b4);g.addRecord($.New(t,{$:2}),b6);b8=r.Get(g.varCommandsHistory().Var);if(n.isEmpty(b8)){b9=true;}else{b_=v.last(b8);b9=b_.Text!==b6;}if(b9){g.varCommandsHistory().Add({Id:o.Fresh(),Text:b6});b$=q.Return(null);}else{b$=q.Return(null);}b7=b$;return q.Combine(b7,q.Delay(function(){return q.TryWith(q.Delay(function(){return q.Bind(x.Async("WebFace:1",[b6]),function(cc){var cd;cc[0];cd=cc[1];g.addRecord($.New(t,{$:0}),cd);return q.Return(null);});}),function(ce){g.addRecord($.New(t,{$:1}),ce.message);return q.Return(null);});}));});},tryGetCommandFromHistory:function(cf){var cg,ch,ci,cj,ck,cl,cm,cp,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR;cg=r.Get(g.varCommandsHistory().Var);ch=n.length(cg);if(ch===0){ci={$:0};}else{if(g.varCmd().$==1){cl=g.varCmd().$0.Id;cm=function(cn){return function(co){return[co,cn];};};cp=function(cq){var cr,cs;cr=cq[0];cq[1];cs=cr.Id;return y.Equals(cs,cl);};ct=r.Get(g.varCommandsHistory().Var);cu=n.mapi(cm,ct);cv=n.tryFind(cp,cu);cw=[cv,cf];if(cw[0].$==1){if(cw[1]){cw[0].$0[0];cz=cw[0].$0[1];if(ch>0?cz<ch-1:false){cB=cw[0].$0[1];cw[0].$0[0];cA=cB+1;}else{if(cw[0].$==1){if(cw[1]){cD=cw[1]?ch-1:0;}else{cw[0].$0[0];cE=cw[0].$0[1];if(ch>0?cE>0:false){cG=cw[0].$0[1];cw[0].$0[0];cF=cG-1;}else{cF=cw[1]?ch-1:0;}cD=cF;}cC=cD;}else{cC=cw[1]?ch-1:0;}cA=cC;}cy=cA;}else{if(cw[0].$==1){if(cw[1]){cI=cw[1]?ch-1:0;}else{cw[0].$0[0];cJ=cw[0].$0[1];if(ch>0?cJ>0:false){cL=cw[0].$0[1];cw[0].$0[0];cK=cL-1;}else{cK=cw[1]?ch-1:0;}cI=cK;}cH=cI;}else{cH=cw[1]?ch-1:0;}cy=cH;}cx=cy;}else{if(cw[0].$==1){if(cw[1]){cN=cw[1]?ch-1:0;}else{cw[0].$0[0];cO=cw[0].$0[1];if(ch>0?cO>0:false){cQ=cw[0].$0[1];cw[0].$0[0];cP=cQ-1;}else{cP=cw[1]?ch-1:0;}cN=cP;}cM=cN;}else{cM=cw[1]?ch-1:0;}cx=cM;}ck=cx;}else{ck=ch-1;}cj=ck;cR=n.nth(cj,cg);ci={$:1,$0:cR};}return ci;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cS,cU;cS=function(cT){return g.cmdKey(cT);};cU=z.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0]]))()});return D.CreateWithStorage(cS,cU);}),varConsole:$.Field(function(){var cV,cX;cV=function(cW){return g.recordKey(cW);};cX=z.LocalStorage("CentBetConsole",{Encode:(B.get_Default().EncodeRecord(undefined,[["Id",B.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["Level",B.get_Default().EncodeUnion(t,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(B.get_Default().DecodeRecord(undefined,[["Id",B.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",C,0]]]]),0],["Text",C,0],["Level",B.get_Default().DecodeUnion(t,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return D.CreateWithStorage(cV,cX);})},Coupon:{Main:function(){var cY,c3,c4,c5,dd,dm;cY=q.Delay(function(){return q.While(function(){return true;},q.Delay(function(){return q.Bind(E.processCoupon(r.Get(E.varInplayOnly())),function(){return q.Return(null);});}));});q.Start(cY,{$:0});c3=s.get_Do();c4=E.varInplayOnly().get_View();c5=F.Bind(function(c6){return F.Bind(function(c7){var c8,c9,c_,da,db,dc;c8=n.isEmpty(c7);c9=!c8;c_=function(c$){return G.inplay(c$);};da=n.filter(c_,c7);db=n.isEmpty(da);dc=!db;return F.Const([c9,dc,c6]);},E.meetups().get_View());},c4);dd=function(de){var df,dg,dh,di,dj,dk,dl;if(de[0]){if(de[1]){dh=d.ofArray([E.table()]);dg=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dh)]));}else{if(de[2]){dj=d.ofArray([j.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);di=j.Element("h1",[],dj);}else{dk=d.ofArray([E.table()]);di=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dk)]));}dg=di;}df=dg;}else{dl=d.ofArray([j.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);df=j.Element("h1",[],dl);}return df;};dm=s.Map(dd,c5);return j.EmbedView(dm);},Meetup:$.Class({},{id:function(dn){return dn.game.gameId;},inplay:function(_do){return r.Get(_do.gameInfo).playMinute.$==1;},notinplay:function(dp){return r.Get(dp.gameInfo).playMinute.$==0;},viewGameInfo:function(dq){return dq.gameInfo.get_View();}}),Menu:function(){var dr,ds,dI;dr=E.varInplayOnly().get_View();ds=function(dt){var du,dw,dH;du=function(dv){return dv;};dw=d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return r.Set(E.varInplayOnly(),true);};})],n.delay(function(){return dt?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return r.Set(E.varInplayOnly(),false);};})],n.delay(function(){return!dt?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);dH=d.map(du,dw);return j.Concat(dH);};dI=s.Map(ds,dr);return j.EmbedView(dI);},MenuToday:function(){var dJ,dK,dP;dJ=E.varInplayOnly().get_View();dK=function(dL){return j.Element("li",n.toList(n.delay(function(){return!dL?[m.Create("class","active")]:n.empty();})),d.ofArray([j.Element("a",d.ofArray([m.Create("href","#"),k.Handler("click",function(){return function(){return r.Set(E.varInplayOnly(),false);};})]),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};dP=s.Map(dK,dJ);return j.EmbedView(dP);},addNewGames:function(dQ){var dR,dS,dT,dY,d0,d2,d3,d4;dR=r.Get(E.meetups().Var);dS=n.toList(dR);E.meetups().Clear();dT=function(dU){var dV,dW,dX;dV=dU[0];dW=dU[1];dX=dU[2];return $.New(G,{game:dV,gameInfo:p.Create(dW),hash:dX});};dY=function(dZ){return r.Get(dZ.gameInfo).order;};d0=function(d1){return E.meetups().Add(d1);};d2=d.map(dT,dQ);d3=n.append(dS,d2);d4=n.sortBy(dY,d3);return n.iter(d0,d4);},downloadCoupon:function(d5,d6){return x.Async("WebFace:0",[d6,d5]);},meetups:$.Field(function(){var d7,d9;d7=function(d8){return G.id(d8);};d9=$.New(l,{$:0});return D.Create(d7,d9);}),processCoupon:function(d_){return q.Delay(function(){var ea,ec,ed,ee;ea=function(eb){return[eb.game.gameId,eb.hash];};ec=r.Get(E.meetups().Var);ed=n.map(ea,ec);ee=n.toList(ed);return q.Bind(E.downloadCoupon(d_,ee),function(ef){var eg,eh,ei;eg=ef[1];eh=ef[2];ei=ef[0];E.updateCoupon(ei,eg,eh);return q.Return(null);});});},row:function(ej,ek){var el,em,ep,es,ew,ey;if(ek?r.Get(ej.gameInfo).playMinute.$==0:false){el=j.get_Empty();}else{em=function(en){var eo;eo=d.ofArray([en]);return j.Element("td",[],eo);};ep=function(eq){var er;er=d.ofArray([j.TextNode(eq)]);return j.Element("td",[],er);};es=function(et){var eu,ev;eu=ej.gameInfo.get_View();ev=s.Map(et,eu);return em(j.TextView(ev));};ew=function(ex){return H.formatDecimalOption(ex);};ey=$.New(l,{$:0});el=j.Element("tr",ey,d.ofArray([es(function(ez){var eA,eB,eC;eA=ez.order;eB=eA[0];eC=eA[1];return $$.String(eB)+"."+$$.String(eC);}),ep(ej.game.home),ep(ej.game.away),es(function(eD){return eD.status;}),es(function(eE){return eE.summary;}),es(function(eF){return ew(eF.winBack);}),es(function(eG){return ew(eG.winLay);}),es(function(eH){return ew(eH.drawBack);}),es(function(eI){return ew(eI.drawLay);}),es(function(eJ){return ew(eJ.loseBack);}),es(function(eK){return ew(eK.loseLay);})]));}return el;},table:function(){var eL,eM;eL=E.meetups().get_View();eM=function(eN){var eO,eS,eV;eO=function(eP){var eQ,eR;eQ=eP[0];eR=eP[1];return E.row(eQ,eR);};s.get_Do();eS=F.Bind(function(eT){return F.Bind(function(eU){return F.Const([eT,eU]);},E.varInplayOnly().get_View());},eN);eV=s.Map(eO,eS);return j.EmbedView(eV);};return j.ConvertSeq(eM,eL);},updateCoupon:function(eW,eX,eY){var eZ,e0,e1,e4,e5,e6,e7,e9,fa,fb;eZ=eW.$==0;if(!eZ){e1=function(e2){var e3;e3="adding new games "+$$.String(e2);return I?I.log(e3):undefined;};e4=eW.get_Length();e1(e4);e0=E.addNewGames(eW);}else{e0=null;}e5=n.isEmpty(eY);if(!e5){e7=function(e8){return E.meetups().RemoveByKey(e8);};n.iter(e7,eY);e9=function(e_){var e$;e$="removing out games "+$$.String(e_);return I?I.log(e$):undefined;};fa=n.length(eY);e6=e9(fa);}else{e6=null;}fb=function(fc){var fd,fe,ff,fg,fh,fi;fd=fc[0];fe=fc[1];ff=fc[2];fg=E.meetups().TryFindByKey(fd);if(fg.$==1){fi=fg.$0;r.Set(fi.gameInfo,fe);fh=void(fi.hash=ff);}else{fh=null;}return fh;};return n.iter(fb,eX);},varInplayOnly:$.Field(function(){return p.Create(true);})},Utils:{dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(fj){return H.trimEnd(fj.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(fk){var fl,fm;if(fk.$==1){fm=fk.$0;fl=H.formatDecimal(fm);}else{fl="";}return fl;},getDatePart:function(fn){var fo;fo=new J(fn.getTime());fo.setHours(0,0,0,0);return fo;},mkids:function(fp,fq){var fr,ft,fu,fv,fw;fr=function(fs){return[fq(fs),fs];};ft=d.map(fr,fp);fu=L.OfArray(n.toArray(ft));fv=d.map(fq,fp);fw=M.New1(N.OfSeq(fv));return[fw,fu];},trimEnd:function(fx,fy){var fz,fA,fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK;fz=[fx,fy];if(fz[0]===""){fA="";}else{if(fz[1].$==1){fC=fz[0];fz[1];fD=fz[1].$0;if(fC.charCodeAt(fC.length-1)===fD){fz[1].$0;fF=fz[1];fG=fz[0];fE=H.trimEnd(O.string(fG,{$:0},{$:1,$0:fG.length-2}),fF);}else{if(fz[1].$==1){fI=fz[0];fJ=fz[1].$1;fH=H.trimEnd(fI,fJ);}else{fH=P.Raise(Q.New("C:\\Users\\User\\Documents\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}fE=fH;}fB=fE;}else{fK=fz[0];fB=fK;}fA=fB;}return fA;}}}}});$.OnInit(function(){a=$.Safe($$.JSON);b=$.Safe($$.WebSharper.PrintfHelpers);c=$.Safe($$.window);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe($$.WebSharper.UI);i=$.Safe(h.Next);j=$.Safe(i.Doc);k=$.Safe(i.AttrModule);l=$.Safe(d.T);m=$.Safe(i.AttrProxy);n=$.Safe($$.WebSharper.Seq);o=$.Safe(i.Key);p=$.Safe(i.Var);q=$.Safe($$.WebSharper.Concurrency);r=$.Safe(i.Var1);s=$.Safe(i.View);t=$.Safe(g.Level);u=$.Safe($$.WebSharper.Strings);v=$.Safe($$.Seq);w=$.Safe($$.WebSharper.Remoting);x=$.Safe(w.AjaxRemotingProvider);y=$.Safe($$.WebSharper.Unchecked);z=$.Safe(i.Storage1);A=$.Safe($$.WebSharper.Json);B=$.Safe(A.Provider);C=$.Safe(B.Id);D=$.Safe(i.ListModel);E=$.Safe(f.Coupon);F=$.Safe(i.View1);G=$.Safe(E.Meetup);H=$.Safe(f.Utils);I=$.Safe($$.console);J=$.Safe($$.Date);K=$.Safe($$.WebSharper.Collections);L=$.Safe(K.MapModule);M=$.Safe(K.FSharpSet);N=$.Safe(K.BalancedTree);O=$.Safe($$.WebSharper.Slice);P=$.Safe($$.WebSharper.Operators);return Q=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){E.varInplayOnly();E.meetups();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
