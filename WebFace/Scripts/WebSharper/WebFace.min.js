(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;$.Define($$,{CentBet:{Client:{Admin:{Level:$.Class({},{get_color:function(){return function(U){return U.$==1?["lightgrey","red"]:U.$==2?["lightgrey","green"]:["white","navy"];};}}),LocalStorage:$.Class({Get:function(V){var W,X,Y,Z,_0;try{X=this.strg.getItem(V);Y=a.parse(X);W={$:0,$0:Y};}catch(Z){_0=this.strg;W={$:1,$0:"local storage get item "+b.prettyPrint(V)+" error : "+b.prettyPrint(Z)+", storage "+b.prettyPrint(_0)};}return W;},Set:function(_1,_2){var _3,_4,_5,_6;try{_4=a.stringify(_2);_3={$:0,$0:this.strg.setItem(_1,_4)};}catch(_5){_6=this.strg;_3={$:1,$0:"local storage set item "+b.prettyPrint(_1)+" error : "+b.prettyPrint(_5)+", value "+b.prettyPrint(_2)+", storage "+b.prettyPrint(_6)};}return _3;}},{New:function(){var _8;_8=$.New(this,{});_8.strg=c.localStorage;return _8;}}),RenderCommandPrompt:function(){var _9;_9=d.ofArray([(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("margin-left","10px")]),$.New(l,{$:0}))),(g.op_SpliceUntyped())(j.Element("label",d.ofArray([m.Create("for",g["cmd-input"]())]),d.ofArray([j.TextNode("Input here:")]))),g.renderInput()]);return j.Concat(_9);},RenderConsole:function(){var _,bd;_=function(ba){var bb,bc;bc=$.New(l,{$:0});bb=d.ofArray([(g.renderRecord())(ba),(g.op_SpliceUntyped())(j.Element("br",[],bc))]);return j.Concat(bb);};bd=g.varConsole().get_View();return j.ConvertSeq(_,bd);},RenderMenu:function(){return j.Concat(d.map(function(bd){return bd;},d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varConsole().Clear();};})];}));})),d.ofArray([j.TextNode("Clear console")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return[k.Handler("click",function(){return function(){return g.varCommandsHistory().Clear();};})];}));})),d.ofArray([j.TextNode("Clear history")]))])));},addRecord:function(bm,bn){return g.varConsole().Add({Id:o.Fresh(),Text:bn,Level:bm});},"cmd-input":$.Field(function(){return"cmd-input";}),cmdKey:function(bo){return bo.Id;},doc:function(bp){return bp;},op_SpliceUntyped:$.Field(function(){return function(bq){return g.doc(bq);};}),recordKey:function(br){return br.Id;},renderInput:function(){var bs,bt,bu,bv,by,bB,bF,bG,bI,bJ,bK,bY;bs=p.Create("");bt=p.Create(null);bu=p.Create(false);bv=q.Delay(function(){r.Set(bu,true);return q.Bind(g.send(r.Get(bs)),function(){r.Set(bu,false);r.Set(bs,"");return q.Return(null);});});by=function(bz){var bA;bA={$:1,$0:bz};g.varCmd=function(){return bA;};return r.Set(bs,bz.Text);};bB=function(bC){var bD,bE;bD=g.tryGetCommandFromHistory(bC);bE=s.map(by,bD);return;};bF=u.get_KeysPressed();bG=function(bH){return bH.$==1?bH.$0===13?bH.$1.$==0?q.Start(bv,{$:0}):null:bH.$0===38?bH.$1.$==0?bB(true):null:bH.$0===40?bH.$1.$==0?bB(false):null:null:null;};bI=v.Map(bG,bF);bJ=bu.get_View();bK=function(bL){var bM;bM=d.ofArray([j.Input(n.toList(n.delay(function(){return n.append([m.Create("id",g["cmd-input"]())],n.delay(function(){return n.append(bL?[m.Create("disabled","disabled")]:n.empty(),n.delay(function(){return n.append([k.Style("width","80%")],n.delay(function(){return n.append([k.CustomVar(bt,function(bR){return function(){return bR.focus();};},function(){return{$:0};})],n.delay(function(){return[k.Handler("keydown",function(){return function(bW){var bX;bX=bW.keyCode;return bX===13?q.Start(bv,{$:0}):bX===38?bB(true):bX===40?bB(false):null;};})];}));}));}));}));})),bs)]);return j.Concat(bM);};bY=v.Map(bK,bJ);return j.EmbedView(bY);},renderRecord:$.Field(function(){var bZ;bZ=function(b0){var b1,b2,b3;b1=(w.get_color())(b0.Level);b2=b1[1];b3=b1[0];return(g.op_SpliceUntyped())(j.Element("span",d.ofArray([k.Style("color",b2),k.Style("background",b3)]),d.ofArray([j.TextNode(b0.Text)])));};return function(b4){var b5;b5=v.Map(bZ,b4);return j.EmbedView(b5);};}),send:function(b6){return q.Delay(function(){var b8,b9,b_,b$,ca,cb;b8=x.Trim(b6);g.addRecord($.New(w,{$:2}),b8);b_=r.Get(g.varCommandsHistory().Var);if(n.isEmpty(b_)){b$=true;}else{ca=y.last(b_);b$=ca.Text!==b8;}if(b$){g.varCommandsHistory().Add({Id:o.Fresh(),Text:b8});cb=q.Return(null);}else{cb=q.Return(null);}b9=cb;return q.Combine(b9,q.Delay(function(){return q.TryWith(q.Delay(function(){return q.Bind(A.Async("WebFace:1",[b8]),function(ce){var cf;ce[0];cf=ce[1];g.addRecord($.New(w,{$:0}),cf);return q.Return(null);});}),function(cg){g.addRecord($.New(w,{$:1}),cg.message);return q.Return(null);});}));});},tryGetCommandFromHistory:function(ch){var ci,cj,ck,cl,cm,cn,co,cr,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT;ci=r.Get(g.varCommandsHistory().Var);cj=n.length(ci);if(cj===0){ck={$:0};}else{if(g.varCmd().$==1){cn=g.varCmd().$0.Id;co=function(cp){return function(cq){return[cq,cp];};};cr=function(cs){var ct,cu;ct=cs[0];cs[1];cu=ct.Id;return B.Equals(cu,cn);};cv=r.Get(g.varCommandsHistory().Var);cw=n.mapi(co,cv);cx=n.tryFind(cr,cw);cy=[cx,ch];if(cy[0].$==1){if(cy[1]){cy[0].$0[0];cB=cy[0].$0[1];if(cj>0?cB<cj-1:false){cD=cy[0].$0[1];cy[0].$0[0];cC=cD+1;}else{if(cy[0].$==1){if(cy[1]){cF=cy[1]?cj-1:0;}else{cy[0].$0[0];cG=cy[0].$0[1];if(cj>0?cG>0:false){cI=cy[0].$0[1];cy[0].$0[0];cH=cI-1;}else{cH=cy[1]?cj-1:0;}cF=cH;}cE=cF;}else{cE=cy[1]?cj-1:0;}cC=cE;}cA=cC;}else{if(cy[0].$==1){if(cy[1]){cK=cy[1]?cj-1:0;}else{cy[0].$0[0];cL=cy[0].$0[1];if(cj>0?cL>0:false){cN=cy[0].$0[1];cy[0].$0[0];cM=cN-1;}else{cM=cy[1]?cj-1:0;}cK=cM;}cJ=cK;}else{cJ=cy[1]?cj-1:0;}cA=cJ;}cz=cA;}else{if(cy[0].$==1){if(cy[1]){cP=cy[1]?cj-1:0;}else{cy[0].$0[0];cQ=cy[0].$0[1];if(cj>0?cQ>0:false){cS=cy[0].$0[1];cy[0].$0[0];cR=cS-1;}else{cR=cy[1]?cj-1:0;}cP=cR;}cO=cP;}else{cO=cy[1]?cj-1:0;}cz=cO;}cm=cz;}else{cm=cj-1;}cl=cm;cT=n.nth(cl,ci);ck={$:1,$0:cT};}return ck;},varCmd:$.Field(function(){return{$:0};}),varCommandsHistory:$.Field(function(){var cU,cW;cU=function(cV){return g.cmdKey(cV);};cW=C.LocalStorage("CentBetConsoleCommandsHistory",{Encode:(E.get_Default().EncodeRecord(undefined,[["Id",E.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",F,0]]]]),0],["Text",F,0]]))(),Decode:(E.get_Default().DecodeRecord(undefined,[["Id",E.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",F,0]]]]),0],["Text",F,0]]))()});return G.CreateWithStorage(cU,cW);}),varConsole:$.Field(function(){var cX,cZ;cX=function(cY){return g.recordKey(cY);};cZ=C.LocalStorage("CentBetConsole",{Encode:(E.get_Default().EncodeRecord(undefined,[["Id",E.get_Default().EncodeUnion(o,"$",[[0,[["$0","Item",F,0]]]]),0],["Text",F,0],["Level",E.get_Default().EncodeUnion(w,"$",[[0,[]],[1,[]],[2,[]]]),0]]))(),Decode:(E.get_Default().DecodeRecord(undefined,[["Id",E.get_Default().DecodeUnion(o,"$",[[0,[["$0","Item",F,0]]]]),0],["Text",F,0],["Level",E.get_Default().DecodeUnion(w,"$",[[0,[]],[1,[]],[2,[]]]),0]]))()});return G.CreateWithStorage(cX,cZ);})},Coupon:{Main:function(){var c0,c5,c6,c7,df,_do;c0=q.Delay(function(){return q.While(function(){return true;},q.Delay(function(){return q.Bind(H.processCoupon(r.Get(H.varInplayOnly())),function(){return q.Return(null);});}));});q.Start(c0,{$:0});c5=v.get_Do();c6=H.varInplayOnly().get_View();c7=I.Bind(function(c8){return I.Bind(function(c9){var c_,c$,da,dc,dd,de;c_=n.isEmpty(c9);c$=!c_;da=function(db){return J.inplay(db);};dc=n.filter(da,c9);dd=n.isEmpty(dc);de=!dd;return I.Const([c$,de,c8]);},H.meetups().get_View());},c6);df=function(dg){var dh,di,dj,dk,dl,dm,dn;if(dg[0]){if(dg[1]){dj=d.ofArray([H.table()]);di=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dj)]));}else{if(dg[2]){dl=d.ofArray([j.TextNode("\u0424\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438 \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u0438\u0441\u044c")]);dk=j.Element("h1",[],dl);}else{dm=d.ofArray([H.table()]);dk=j.Element("table",$.New(l,{$:0}),d.ofArray([j.Element("tbody",[],dm)]));}di=dk;}dh=di;}else{dn=d.ofArray([j.TextNode("\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u043d\u0435\u0442 \u0444\u0443\u0442\u0431\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0442\u0447\u0435\u0439")]);dh=j.Element("h1",[],dn);}return dh;};_do=v.Map(df,c7);return j.EmbedView(_do);},Meetup:$.Class({},{id:function(dp){return dp.game.gameId;},inplay:function(dq){return r.Get(dq.gameInfo).playMinute.$==1;},notinplay:function(dr){return r.Get(dr.gameInfo).playMinute.$==0;},viewGameInfo:function(ds){return ds.gameInfo.get_View();}}),Menu:function(){var dt,du,dK;dt=H.varInplayOnly().get_View();du=function(dv){var dw,dy,dJ;dw=function(dx){return dx;};dy=d.ofArray([j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return r.Set(H.varInplayOnly(),true);};})],n.delay(function(){return dv?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412 \u0438\u0433\u0440\u0435")])),j.Element("a",n.toList(n.delay(function(){return n.append([m.Create("href","#")],n.delay(function(){return n.append([k.Handler("click",function(){return function(){return r.Set(H.varInplayOnly(),false);};})],n.delay(function(){return!dv?[m.Create("class","active")]:n.empty();}));}));})),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]);dJ=d.map(dw,dy);return j.Concat(dJ);};dK=v.Map(du,dt);return j.EmbedView(dK);},MenuToday:function(){var dL,dM,dR;dL=H.varInplayOnly().get_View();dM=function(dN){return j.Element("li",n.toList(n.delay(function(){return!dN?[m.Create("class","active")]:n.empty();})),d.ofArray([j.Element("a",d.ofArray([m.Create("href","#"),k.Handler("click",function(){return function(){return r.Set(H.varInplayOnly(),false);};})]),d.ofArray([j.TextNode("\u0412\u0441\u0435 \u043c\u0430\u0442\u0447\u0438")]))]));};dR=v.Map(dM,dL);return j.EmbedView(dR);},addNewGames:function(dS){var dT,dU,dV,d0,d2,d4,d5,d6;dT=r.Get(H.meetups().Var);dU=n.toList(dT);H.meetups().Clear();dV=function(dW){var dX,dY,dZ;dX=dW[0];dY=dW[1];dZ=dW[2];return $.New(J,{game:dX,gameInfo:p.Create(dY),hash:dZ});};d0=function(d1){return r.Get(d1.gameInfo).order;};d2=function(d3){return H.meetups().Add(d3);};d4=d.map(dV,dS);d5=n.append(dU,d4);d6=n.sortBy(d0,d5);return n.iter(d2,d6);},downloadCoupon:function(d7,d8){return A.Async("WebFace:0",[d8,d7]);},meetups:$.Field(function(){var d9,d$;d9=function(d_){return J.id(d_);};d$=$.New(l,{$:0});return G.Create(d9,d$);}),processCoupon:function(ea){return q.Delay(function(){var ec,ee,ef,eg;ec=function(ed){return[ed.game.gameId,ed.hash];};ee=r.Get(H.meetups().Var);ef=n.map(ec,ee);eg=n.toList(ef);return q.Bind(H.downloadCoupon(ea,eg),function(eh){var ei,ej,ek;ei=eh[1];ej=eh[2];ek=eh[0];H.updateCoupon(ek,ei,ej);return q.Return(null);});});},row:function(el,em){var en,eo,er,eu,ey,eA;if(em?r.Get(el.gameInfo).playMinute.$==0:false){en=j.get_Empty();}else{eo=function(ep){var eq;eq=d.ofArray([ep]);return j.Element("td",[],eq);};er=function(es){var et;et=d.ofArray([j.TextNode(es)]);return j.Element("td",[],et);};eu=function(ev){var ew,ex;ew=el.gameInfo.get_View();ex=v.Map(ev,ew);return eo(j.TextView(ex));};ey=function(ez){return K.formatDecimalOption(ez);};eA=$.New(l,{$:0});en=j.Element("tr",eA,d.ofArray([eu(function(eB){var eC,eD,eE;eC=eB.order;eD=eC[0];eE=eC[1];return $$.String(eD)+"."+$$.String(eE);}),er(el.game.home),er(el.game.away),eu(function(eF){return eF.status;}),eu(function(eG){return eG.summary;}),eu(function(eH){return ey(eH.winBack);}),eu(function(eI){return ey(eI.winLay);}),eu(function(eJ){return ey(eJ.drawBack);}),eu(function(eK){return ey(eK.drawLay);}),eu(function(eL){return ey(eL.loseBack);}),eu(function(eM){return ey(eM.loseLay);})]));}return en;},table:function(){var eN,eO;eN=H.meetups().get_View();eO=function(eP){var eQ,eU,eX;eQ=function(eR){var eS,eT;eS=eR[0];eT=eR[1];return H.row(eS,eT);};v.get_Do();eU=I.Bind(function(eV){return I.Bind(function(eW){return I.Const([eV,eW]);},H.varInplayOnly().get_View());},eP);eX=v.Map(eQ,eU);return j.EmbedView(eX);};return j.ConvertSeq(eO,eN);},updateCoupon:function(eY,eZ,e0){var e1,e2,e3,e6,e7,e8,e9,e$,fc,fd;e1=eY.$==0;if(!e1){e3=function(e4){var e5;e5="adding new games "+$$.String(e4);return L?L.log(e5):undefined;};e6=eY.get_Length();e3(e6);e2=H.addNewGames(eY);}else{e2=null;}e7=n.isEmpty(e0);if(!e7){e9=function(e_){return H.meetups().RemoveByKey(e_);};n.iter(e9,e0);e$=function(fa){var fb;fb="removing out games "+$$.String(fa);return L?L.log(fb):undefined;};fc=n.length(e0);e8=e$(fc);}else{e8=null;}fd=function(fe){var ff,fg,fh,fi,fj,fk;ff=fe[0];fg=fe[1];fh=fe[2];fi=H.meetups().TryFindByKey(ff);if(fi.$==1){fk=fi.$0;r.Set(fk.gameInfo,fg);fj=void(fk.hash=fh);}else{fj=null;}return fj;};return n.iter(fd,eZ);},varInplayOnly:$.Field(function(){return p.Create(true);})},Utils:{dateTimeToString:function($s){var $0=this,$this=this;return $$.dateTimeToString($s);},formatDecimal:function(fl){return K.trimEnd(fl.toFixed(6),d.ofArray([48,46]));},formatDecimalOption:function(fm){var fn,fo;if(fm.$==1){fo=fm.$0;fn=K.formatDecimal(fo);}else{fn="";}return fn;},getDatePart:function(fp){var fq;fq=new M(fp.getTime());fq.setHours(0,0,0,0);return fq;},mkids:function(fr,fs){var ft,fv,fw,fx,fy;ft=function(fu){return[fs(fu),fu];};fv=d.map(ft,fr);fw=O.OfArray(n.toArray(fv));fx=d.map(fs,fr);fy=P.New1(Q.OfSeq(fx));return[fy,fw];},trimEnd:function(fz,fA){var fB,fC,fD,fE,fF,fG,fH,fI,fJ,fK,fL,fM;fB=[fz,fA];if(fB[0]===""){fC="";}else{if(fB[1].$==1){fE=fB[0];fB[1];fF=fB[1].$0;if(fE.charCodeAt(fE.length-1)===fF){fB[1].$0;fH=fB[1];fI=fB[0];fG=K.trimEnd(R.string(fI,{$:0},{$:1,$0:fI.length-2}),fH);}else{if(fB[1].$==1){fK=fB[0];fL=fB[1].$1;fJ=K.trimEnd(fK,fL);}else{fJ=S.Raise(T.New("E:\\User\\Docs\\Visual Studio 2015\\Projects\\Betfair\\CentBet\\WebFace\\ClientUtils.fs",9,18));}fG=fJ;}fD=fG;}else{fM=fB[0];fD=fM;}fC=fD;}return fC;}}}}});$.OnInit(function(){a=$.Safe($$.JSON);b=$.Safe($$.WebSharper.PrintfHelpers);c=$.Safe($$.window);d=$.Safe($$.WebSharper.List);e=$.Safe($$.CentBet);f=$.Safe(e.Client);g=$.Safe(f.Admin);h=$.Safe($$.WebSharper.UI);i=$.Safe(h.Next);j=$.Safe(i.Doc);k=$.Safe(i.AttrModule);l=$.Safe(d.T);m=$.Safe(i.AttrProxy);n=$.Safe($$.WebSharper.Seq);o=$.Safe(i.Key);p=$.Safe(i.Var);q=$.Safe($$.WebSharper.Concurrency);r=$.Safe(i.Var1);s=$.Safe($$.WebSharper.Option);t=$.Safe(i.Input);u=$.Safe(t.Keyboard);v=$.Safe(i.View);w=$.Safe(g.Level);x=$.Safe($$.WebSharper.Strings);y=$.Safe($$.Seq);z=$.Safe($$.WebSharper.Remoting);A=$.Safe(z.AjaxRemotingProvider);B=$.Safe($$.WebSharper.Unchecked);C=$.Safe(i.Storage1);D=$.Safe($$.WebSharper.Json);E=$.Safe(D.Provider);F=$.Safe(E.Id);G=$.Safe(i.ListModel);H=$.Safe(f.Coupon);I=$.Safe(i.View1);J=$.Safe(H.Meetup);K=$.Safe(f.Utils);L=$.Safe($$.console);M=$.Safe($$.Date);N=$.Safe($$.WebSharper.Collections);O=$.Safe(N.MapModule);P=$.Safe(N.FSharpSet);Q=$.Safe(N.BalancedTree);R=$.Safe($$.WebSharper.Slice);S=$.Safe($$.WebSharper.Operators);return T=$.Safe($$.WebSharper.MatchFailureException);});$.OnLoad(function(){H.varInplayOnly();H.meetups();g.varConsole();g.varCommandsHistory();g.varCmd();g.renderRecord();g.op_SpliceUntyped();g["cmd-input"]();return;});}());
